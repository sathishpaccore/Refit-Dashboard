(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[32],{1449:function(z,E,b){function a(jc){return vg.call(this,jc)||this}function c(jc){this.$=jc}function e(jc){var zc=Ig.call(this)||this;zc.$=jc;zc.Tb();return zc}function f(jc,zc,Md,Ce,ae){var ud=Re.call(this)||this;ud.statusBarManager=null;ud.jZc=!1;ud.G$=null;ud.ICc=!1;ud.POd=null;ud.oya=null;ud.MEd=!1;ud.Ao=!1;ud.Tp=null;ud.Ree=null;ud.jga=null;ud.Kde=null;ud.sEa=null;ud.VLe=function(){ra.ULS.sendTraceTag(537154520,306,
50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");var Rb=ud.KOf(1);ra.ULS.sendTraceTag(537154519,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: {0}.",Rb)};ud.fTd=function(Rb,Ie){Ie?(ud.Tp=Ie.title,ud.Ree=Ie.qqc,ud.jga=Ie.buttonText,ud.Kde=Ie.vvf,ud.xE.eg(27,null),ra.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):ra.ULS.sendTraceTag(537154510,306,15,
"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};ud.a5f=function(Rb,Ie){var pa=Object(fc.a)(ea,Ie);pa?pa.z4f?ud.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)?(ra.ULS.sendTraceTag(537154508,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of {0}",pa.errorType),ud.xE.hCj(pa.title,pa.message,pa.buttonText,function(qb){pa.mZ&&(ud.xE.vC(52)&&ud.xE.removeEntry(52),pa.mZ(qb))})):1===pa.errorType?
(ra.ULS.sendTraceTag(537154507,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of File too large"),ud.xE.eg(47,null)):2===pa.errorType?ud.xE.eg(48,null):3===pa.errorType?ud.xE.eg(49,null):4===pa.errorType?ud.xE.eg(50,null):5===pa.errorType?ud.xE.iCj(pa.title,pa.message,pa.buttonText,function(qb){ud.xE.vC(51)&&ud.xE.removeEntry(51);pa.mZ(qb)}):ud.xE.eg(46,null):ra.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):
(ra.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),ud.xE.eg(46,null))};ud.uZd=function(Rb,Ie){ud.f7&&(ra.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),ud.f7.m0f(),ud.f7.D_f(),ud.f7.UKf(),ud.$.Pd&64&&(Ie.onSuccess&&ud.oya?ud.fLg():ud.f7.vag()));ud.ga.ra("SupportsOfficeClientCoauthoring")&&(Rb=ud.Br.Kn,ud.sEa=Rb.AppliedPolicyId,"null"===ud.labelId&&(ud.sEa=""),ud.ICc&&(Rb=Rb.PolicyLabelAssignmentMethod&&
xb.c(Rb.PolicyLabelAssignmentMethod)===xb.c("standard")?4:2,ud.applyPolicyLabel(ud.labelId,Rb,!0,ud.POd)));ud.ySe();ud.Qz()};ud.Pyf=function(){ud.MEd=!0;ud.ySe()};ud.BDf=function(Rb,Ie){ra.ULS.sendTraceTag(42322116,306,50,"PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = {0}, ApplyLabelFlag = {1}",Oa.AFrameworkApplication.protectedFile,Ie.aQ);ud.applyPolicyLabel(Ie.pqc,Ie.aQ,!1,null)};ud.jHi=function(Rb,Ie){ud.sEa=Ie.pqc;if(fd.a.lr(Rb.Errors)){var pa=
fd.a.Oaa(Rb.Errors,[2045508683]);0<pa.length&&(Rb.Errors=fd.a.$F(Rb.Errors,[2045508683],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),ud.$.ea.Hp(Rb.Errors));pa=fd.a.Oaa(Rb.Errors,[2046680228]);0<pa.length&&(4===Ie.aQ||1===Ie.aQ)&&(Rb.Errors=fd.a.$F(Rb.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),ud.$.ea.Hp(Rb.Errors));pa=Rb=null;for(var qb=Cl(ud.Br.Kn.SensitivityLabels),Sb=qb.next();!Sb.done;Sb=qb.next())Sb=Sb.value,Pd.a.equals(ud.labelId,
Sb.Id,!1)&&(Rb=Sb),Pd.a.equals(Ie.BYf,Sb.Id,!1)&&(pa=Sb);qb={};qb.ApplyLabelFlag=Ie.aQ;Rb?(qb.currentLabel="Set",qb.currentLabelEnabled=Rb.Enabled,qb.currentLabelName=Rb.Name?"Set":"NotSet",qb.currentLabelParentId=Rb.ParentId?"Set":"NotSet"):qb.currentLabel="NotSet";pa?(qb.serverLabel="Set",qb.serverLabelEnabled=pa.Enabled,qb.serverLabelName=pa.Name?"Set":"NotSet",qb.serverLabelParentId=pa.ParentId?"Set":"NotSet"):qb.serverLabel="NotSet";ra.ULS.sendTraceTag(541638850,306,15,"PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : {0}",
JSON.stringify(qb))}};ud.hPg=function(Rb,Ie){if(!ud.$.workbookContext.HasRoundTrippedHFPart)return!1;var pa=ud.Br.Kn;if(!pa)return ra.ULS.sendTraceTag(537154502,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;var qb=null;pa=Cl(pa.SensitivityLabels);for(var Sb=pa.next();!Sb.done;Sb=pa.next())Sb=Sb.value,Pd.a.equals(Sb.Id,Rb,!1)&&(qb=Sb);return qb&&ud.U6h(qb)?(ra.ULS.sendTraceTag(50341186,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),
ud.Szj(Ie),!0):!1};ud.ifi=function(){var Rb=!1;!ud.$.ya.IsNewWorkbook||ud.labelId&&ud.labelId.length||(Rb=!0);ra.ULS.sendTraceTag(537154501,306,50,"PolicyManagerWrapper.IsANewFile: is this a new file : {0}",Rb);return Rb};ud.Spf=function(Rb,Ie){1===Ie.ere?ud.$.isEditMode?(ra.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),ud.$.Ka.$b(new sd.a(-723527778,0,ud.$.fd,10,null))):ra.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):
(ud.oya=Ie.oya,ud.$.ea.g3(ud.tse),ud.$.Cfb(),ra.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),ud.$.Ka.$b(new sd.a(-8805455,0,ud.$.fd,10,null)))};ud.Qme=function(Rb,Ie){Ie?(Rb=!!(ud.$.Pd&64),ra.ULS.sendTraceTag(537154496,306,50,"AddMandatoryLabellingBusinessBar User has edit permission : {0}",Rb),Rb&&(ud.$.Cfb(),ud.xE.mBj(Ie.title,Ie.message,Ie.buttonText,function(pa){Ie.mZ(pa)}))):ra.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};
ud.aQf=function(){ud.xE.vC(40)&&ud.xE.removeEntry(40)};ud.Fbg=function(Rb,Ie){Ie.Zxj&&(ra.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),ge.TaskExtensions.Ba(Xe.GetServiceTaskFactory.Ua(ud.$.da,55,56,0),function(pa){pa.result.g3c()},ud.$.la,3))};ud.tse=function(){ud.oya&&ud.$.isEditMode?(ud.$.ea.Q0(ud.tse),ud.h4a()):ra.ULS.sendTraceTag(537154467,306,15,"ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty {0} , edit mode : {1}.",
!ud.oya,ud.$.isEditMode)};ud.QMj=function(){ud.$.isEditMode?(ud.$.ea.Q0(ud.QMj),ud.h4a()):ra.ULS.sendTraceTag(537154466,306,15,"TriggerDefaultLabelingOnModeChanged is not expected in View-mode. Mode.")};ud.ska=function(){var Rb=ud.$.ea.Rm;Rb&&!Pd.a.equals(Rb.AppliedPolicyLabelId,ud.labelId,!1)&&(ra.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),ra.ULS.shipAssertTag(537154463,306,ud.$.isEditMode,
"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),ud.ga.ra("SupportsOfficeClientCoauthoring")&&ud.$.isEditMode&&(ud.ICc=!0,ud.POd=Rb.AppliedPolicyLabelId),ud.sEa=Rb.AppliedPolicyLabelId,ud.h4a())};ud.ipd=function(){var Rb=!0;if(!ud.$.ea.amIAlone)for(var Ie=Cl(ud.$.ea.Qm),pa=Ie.next();!pa.done;pa=Ie.next())if(!pa.value.SupportsClientIsMipTrusted){Rb=!1;break}ra.ULS.sendTraceTag(537154462,306,50,
"PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : {0}",Rb);return Rb};ud.Vzf=function(){ra.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");ud.ICc=!0;ud.h4a()};ud.$=Ce;ud.Br=jc;ud.xE=Md;ud.ga=ae;ud.Br.Xoe(ud.fTd);ud.f7=zc;return ud}function m(jc){return ie.call(this,jc,m.jR(jc))||this}function n(jc,zc,Md,Ce,ae){var ud=ef.call(this)||this;ud.dqf=3;ud.augmentationLoopManager=null;ud.VA=null;ud.e_a=!1;ud.N$a=[];ud.Fkf=new kf.a(of.a.oK());
ud.YFd=0;ud.cGd=null;ud.K4b=function(Rb,Ie){Rb=Object(Ve.a)(new Sd.a,{parentPath:["session","doc","security"],items:[Object(Ve.a)(new te.a,{id:"clp",body:Object(Ve.a)(new y,{existingLabelPriority:Ie.existingLabelPriority,partialDocSITs:Ie.OAe,fullDocSITs:Ie.NAe})})]});ud.N$a.push(Rb);ud.tyb()};ud.Tcg=function(Rb,Ie){Rb=Object(Ve.a)(new rd.a,{parentPath:["session","doc","security"],items:[Object(Ve.a)(new te.a,{id:"clp",body:Object(Ve.a)(new y,{existingLabelPriority:Ie.existingLabelPriority})})]});
ud.N$a.push(Rb);ud.tyb()};ud.Ucg=function(Rb,Ie){Rb=Object(Ve.a)(new rd.a,{parentPath:["session","doc","security"],items:[Object(Ve.a)(new te.a,{id:"clp",body:Object(Ve.a)(new y,{partialDocSITs:Ie.OAe,fullDocSITs:Ie.NAe})})]});ud.N$a.push(Rb);ud.tyb()};ud.J6=function(){ra.ULS.sendTraceTag(537154588,306,50,"AutoPolicyManager::OnApplicationModeChanged - isEditMode:{0}.",ud.$.isEditMode);ud.$.isEditMode?vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?ud.tyb():
ud.iaf():(ud.businessBar.removeEntry(39),ud.businessBar.removeEntry(38),ud.xch())};ud.$mc=function(){ra.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");ud.lIe();ud.augmentationLoopManager=null};ud.tri=function(Rb,Ie){var pa,qb,Sb,$b,tc;ra.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===Ie.operationType)ra.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");
else{var ld=Rb=null,Vc=null;if(ud.Ynd()){var Se=Ie.pC;if(!Se){ra.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(pa=Se.automatic)||void 0===pa?0:pa.id)Rb=Se.automatic.id;if(null===(qb=Se.recommended)||void 0===qb?0:qb.id)ld=Se.recommended.id,Se.recommended.policyTip&&(Vc=Se.recommended.policyTip)}else{pa=Ie.pC;if(!pa){ra.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");
return}if(null===(Sb=null===(Se=pa.automatic)||void 0===Se?void 0:Se.sensitivityLabel)||void 0===Sb?0:Sb.id)Rb=pa.automatic.sensitivityLabel.id;if(null===(tc=null===($b=pa.recommended)||void 0===$b?void 0:$b.sensitivityLabel)||void 0===tc?0:tc.id)ld=pa.recommended.sensitivityLabel.id,pa.recommended.sensitivityLabel.policyTip&&(Vc=pa.recommended.sensitivityLabel.policyTip)}ud.applyPolicyLabel(Rb,ld,Vc,1)}};ud.mti=function(Rb,Ie){ra.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");
3===Ie.operationType?ra.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):(Rb=Ie.pC)?(Rb=Rb.classificationId,ud.applyPolicyLabel(Rb,Rb,null,2)):ra.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};ud.DPf=function(Rb,Ie){Ie?Ie.pAb&&ud.businessBar.vC(39)?(ud.businessBar.removeEntry(39),ra.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):
!Ie.pAb&&ud.businessBar.vC(38)&&(ud.businessBar.removeEntry(38),ra.ULS.sendTraceTag(537154561,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):ra.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};ud.L3f=function(Rb,Ie){Ie?Ie.pAb?(ud.businessBar.YBj(Ie.title,Ie.message,Ie.buttonText,function(pa){Ie.mZ(pa);ud.businessBar.vC(39)&&ud.businessBar.removeEntry(39)}),ra.ULS.sendTraceTag(537154531,
306,50,"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(ud.businessBar.Qzj(Ie.title,Ie.message,Ie.buttonText,function(pa){Ie.mZ(pa);ud.businessBar.vC(38)&&ud.businessBar.removeEntry(38)}),ra.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):ra.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};ud.LEd=
jc;ud.policyManager=zc;ud.$=Md;ud.ga=Ce;ud.businessBar=ae;ud.p$h();ud.B8i();ud.disposed=!1;return ud}function w(){var jc=Ue.call(this)||this;jc.classificationId=null;jc.H_=Object.assign(new ee.a,{T_:w.getTypeName(),B_:w.ye()});return jc}function h(){var jc=Dc.call(this)||this;jc.recommended=null;jc.automatic=null;jc.source=null;jc.H_=Object.assign(new ee.a,{T_:h.getTypeName(),B_:h.ye()});return jc}function y(){var jc=r.call(this)||this;jc.existingLabelPriority=null;jc.H_=Object.assign(new ee.a,{T_:y.getTypeName(),
B_:y.ye()});return jc}function r(){var jc=$f.call(this)||this;jc.partialDocSITs=null;jc.fullDocSITs=null;jc.H_=Object.assign(new ee.a,{T_:r.getTypeName(),B_:r.ye()});return jc}function x(){var jc=Le.call(this)||this;jc.recommended=null;jc.automatic=null;jc.source=null;jc.H_=Object.assign(new ee.a,{T_:x.getTypeName(),B_:x.ye()});return jc}function t(jc,zc,Md,Ce,ae,ud,Rb){Rb=jc.Na(1,void 0===Rb?null:Rb);Rb.tenantId=zc;return Ad.i(jc,"GetPolicyApplicationMethod",Rb,Md,Ce,ae,ud,4)}function u(jc,zc,Md,
Ce,ae,ud,Rb){Rb=jc.Na(1,void 0===Rb?null:Rb);Rb.tenantId=zc;return Ad.i(jc,"GetPolicyLabelId",Rb,Md,Ce,ae,ud,4)}function B(){this.EZa=this.annotationType=null;this.lMa=this.xF=!1}function v(){this.pqc=this.BYf=null;this.aQ=0}function C(){this.Y1=this.ora=this.tb=this.Xg=null}function A(jc,zc,Md,Ce,ae){Ce=void 0===Ce?0:Ce;ae=void 0===ae?null:ae;this.YHc=this.P6d=null;this.Ira=this.njb=this.pjb=0;this.T8="";this.mFa=this.QFc=this.$9d=this.Ipa=this.yNc=null;this.B$d=!1;this.XCa=null;this.BKc=0;this.CVb=
this.oFa=this.XDa=this.BVb=null;this.Za=new $a.a;this.YKb=this.zwb=this.jFa=null;this.nLc=!1;this.NBb=null;this.vb=jc;this.Wg=zc;this.Eh=Md;this.FUb=Ce;this.Kn=new fa;this.Pee=this.vb.Va("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.wP=ae;this.Uyb=jc.ra("WacApplyManualPolicyLabelIsEnabled");this.pgc=jc.ra("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=jc.ra("SupportsOfficeClientCoauthoring");this.Eni=!1;this.Msj=3E4;this.se=bb.a.instance;jc.ra("SupportsPolicies")&&
rb.a("MipSupportsPolicies");this.pgc&&this.supportsOfficeClientCoauthoring&&rb.a("MipSupportsOfficeClientCoauthoring")}function M(){}function T(jc,zc,Md,Ce,ae,ud,Rb,Ie,pa,qb,Sb,$b,tc,ld,Vc,Se,Ge,Af,jf,Ef,Xf){this.url=jc;this.qWj=zc;this.body=Md;this.headers=Ce;this.Odb=ae;this.priority=ud;this.state=Rb;this.Wgg=void 0===Ie?null:Ie;this.pL=void 0===pa?null:pa;this.wW=void 0===qb?!1:qb;this.W3i=void 0===Sb?null:Sb;this.yoj=void 0===$b?null:$b;this.name=void 0===tc?null:tc;this.VFb=void 0===ld?null:
ld;this.xcd=void 0===Vc?!1:Vc;this.jGf=void 0===Se?null:Se;this.H9b=void 0===Ge?null:Ge;this.Tfc=void 0===Af?null:Af;this.tcb=void 0===jf?null:jf;this.n8h=void 0===Ef?null:Ef;this.responseType=void 0===Xf?null:Xf}function R(jc){var zc=Jc.call(this)||this;zc.Zxj=jc;return zc}function Q(jc){var zc=Ed.call(this)||this;zc.eLg=jc;return zc}function ea(jc,zc,Md,Ce,ae,ud,Rb){Ce=void 0===Ce?null:Ce;ae=void 0===ae?null:ae;ud=void 0===ud?null:ud;Rb=void 0===Rb?null:Rb;var Ie=Fc.call(this)||this;Ie.errorType=
jc;Ie.eLg=zc;Ie.z4f=Md;Ie.title=Ce;Ie.message=ae;Ie.buttonText=ud;Ie.mZ=Rb;return Ie}function Z(jc,zc){var Md=Gc.call(this)||this;Md.pqc=jc;Md.aQ=zc;return Md}function ca(){return zb.call(this)||this}function I(jc,zc){var Md=hb.call(this)||this;Md.Lpb=jc;Md.pAb=zc;return Md}function H(jc,zc,Md,Ce){var ae=Ib.call(this)||this;ae.title=jc;ae.qqc=zc;ae.buttonText=Md;ae.vvf=Ce;return ae}function L(jc,zc){var Md=nb.call(this)||this;Md.oya=jc;Md.ere=zc;return Md}function U(jc){jc=void 0===jc?!1:jc;var zc=
Cb.call(this)||this;zc.onSuccess=jc;return zc}function fa(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelId=null;this.AreLabelsAvailable=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.DefaultLabelId="";this.SensitivityLabels=
[];this.MandatoryLabelingEnforced=!1;this.CustomUrl=""}function aa(){return tb.call(this)||this}function na(jc){var zc=Va.call(this)||this;zc.P_j=jc;return zc}function ha(jc,zc,Md){var Ce=ub.call(this)||this;Ce.OAe=jc;Ce.NAe=zc;Ce.existingLabelPriority=Md;return Ce}function ka(jc,zc,Md,Ce,ae){var ud=ua.call(this)||this;ud.Lpb=jc;ud.title=zc;ud.message=Md;ud.buttonText=Ce;ud.mZ=ae;return ud}function xa(jc,zc,Md,Ce,ae,ud){var Rb=ba.call(this)||this;Rb.Lpb=jc;Rb.title=zc;Rb.message=Md;Rb.buttonText=
Ce;Rb.mZ=ae;Rb.pAb=ud;return Rb}function va(jc,zc,Md,Ce){this.MMc=this.NMc=null;this.dMc=this.wMc=this.Vjb=this.Ybe=this.bIc=!1;this.OVa=this.Dfa=this.yga=this.Lpa=this.iUb=this.ew=this.L9=this.oh=null;this.XFc=0;this.B7d=this.tMc=this.hGc=null;this.La=jc;this.ef=zc;this.vb=Md;this.Xg=Ce;this.qXa={};this.Qee={};this.Zbe={};this.Uyb=Md.ra("WacApplyManualPolicyLabelIsEnabled");this.Xg.value.kpe(Object(Na.a)(this,this.vGd,"processAutoSensitivityLabel"));this.Xg.value.lWc(Object(Na.a)(this,this.vGd,"processAutoSensitivityLabel"));
this.Xg.value.MZb(Object(Na.a)(this,this.DUi,"onUpdateLabelInfo"));Oa.AFrameworkApplication.sa&&Oa.AFrameworkApplication.sa.uGg(Object(Na.a)(this,this.g8i,"refreshDocumentPolicyLabelsOnModeChange"));Md.ra("SupportsPolicies")&&Md.Va("AppliedPolicyId")&&(this.NMc=Md.Va("IrmPolicyTitle"),this.MMc=Md.Va("IrmPolicyDescription"));this.QPc=Md.ra("ProtectedFile");this.Ulg=this.vb.Cd("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6);this.Vlg=this.vb.Cd("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}
function Aa(jc,zc){var Md=eb.call(this,!1,!1,Aa.Hu)||this;Md.zWb=jc;Md.WD=zc;Md.jc=1;Md.Oe=Aa.id;Md.Bc(1,CommonUIStrings.l_DialogChange);Md.KI(1,!1);Md.iea(0);return Md}function qa(){}function wa(){this.Sjb=!!Oa.AFrameworkApplication.sa&&Oa.AFrameworkApplication.sa.Pa.wv}function Ta(jc,zc,Md){var Ce=lc.call(this,!1,!1,!0)||this;if(!jc||!Md)return ra.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs"),Ce;var ae={};ae=(ae.id="MandatoryLabellingDialog",ae);
Ce.iog=Md;Ce.mNc=zc;if(!Oa.AFrameworkApplication.ga.ra("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||Ce.mNc&&""!==Ce.mNc)zc={},zc=(zc.href=Ce.mNc,zc.target="_blank",zc),Md={},ae.learnMoreLink=(Md.type="AppLinkProps",Md.id="mandatoryLabellingLearnMoreLink",Md.text=CommonUIStrings.l_LearnMore,Md.handler=zc,Md.customTooltip=CommonUIStrings.L_LearnMoreTooltip,Md);zc={};jc=(zc.id="mandatoryLabellingFlyoutMenuSection",zc.controls=jc,zc);zc={};zc=(zc.sections=[],zc.shouldAutoOpen=!1,zc);Array.add(zc.sections,
jc);jc={};ae.labelFlyout=(jc.type="AppFlyoutAnchorProps",jc.id="mandatoryLabellingFyout",jc.label="Pick a label",jc.hideLabel=!1,jc.hideChevron=!1,jc.hideIcon=!0,jc.menuDefinition=zc,jc);jc={};jc=(jc.id="MandatoryLabellingDialog",jc.bodyControls=ae,jc);ae.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;ae.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;Ce.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(Na.a)(Ce,
Ce.nzi,"mandatoryLabellingDialogHandler"),jc);return Ce}function sb(jc,zc){var Md=pc.call(this,!1,!1,sb.Hu)||this;Md.Iqa=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];Md.NVb=null;Md.MVb=!1;Md.zWb=jc;Md.WD=zc;Md.gg=Md.ZQg();Md.jc=1;Md.Oe=sb.id;Md.Bc(1,CommonUIStrings.l_DialogChange);Md.KI(1,!1);Md.iea(0);return Md}function db(){}function kb(jc,zc){this.aQ=jc;this.displayName=zc}function ac(jc,
zc,Md){Md=void 0===Md?null:Md;this.id=jc.Id;Md||(Md="");this.j7i=Md;this.sensitivityLabel=jc}b.r(E);var ta=b(0),ra=b(14),Na=b(82),gb=b(1057),ob=b(201);Object(ta.a)(ac,"AutoPolicyLabelData",null,[]);Object(ta.a)(kb,"PolicyLabelRequestState",null,[]);var wb=b(149),Oa=b(4),sa=b(156),Fa=b(13),Wa=b(42),Db=b(29);Ck.Object.defineProperties(db,{ctd:{configurable:!0,enumerable:!0,get:function(){return db.Xqi}}});db.Xqi="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(ta.a)(db,"JustificationDialogHtml",null,[]);var pc=wb.a;Am(sb,pc);sb.prototype.WSd=function(){if(sb.Hu)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(Na.a)(this,this.GMf,"reactJustificationDialogHandler"),this.H2e(this.MVb));else{for(var jc={},zc=0;zc<this.Iqa.length;zc++)jc[sb.cHd+zc]=!1;jc[sb.oNb]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(Na.a)(this,this.Wqi,"justificationDialogHandler"),jc);this.$8i();Wa.a.addHandler($get(sb.oNb),
Fa.a.input,Object(Na.a)(this,this.kJj,"textAreaHandler"))}};sb.prototype.validate=function(){if(sb.Hu)return this.Vfg(this.NVb);var jc=$get(sb.oNb);return jc.disabled?!0:this.Vfg(jc.value)};sb.prototype.Vfg=function(jc){var zc=2>jc.length,Md=500<jc.length,Ce=RegExp("[{|}|;|\\\\]").test(jc);jc=""===Db.a.Dsc(jc);return!zc&&!Md&&!Ce&&!jc};sb.prototype.Wqi=function(jc,zc){var Md="";if(1===jc)for(var Ce=0;Ce<this.Iqa.length;Ce++)if(zc[sb.cHd+Ce]){Md=Ce===this.Iqa.length-1?zc[sb.oNb]:this.Iqa[Ce];break}this.WD(jc,
this.zWb,Md)};sb.prototype.GMf=function(jc){var zc="";1===jc&&this.NVb&&(zc=this.NVb);this.WD(jc,this.zWb,zc)};sb.prototype.zOi=function(jc){this.NVb=jc;jc=this.validate();this.MVb!==jc&&(this.MVb=jc,this.tOb(CommonUIStrings.l_SensitivityJustificationTitle,Object(Na.a)(this,this.GMf,"reactJustificationDialogHandler"),this.H2e(this.MVb)))};sb.prototype.H2e=function(jc){var zc={},Md={},Ce={},ae={};return ae.id=this.Oe,ae.bodyControls=(Md.choiceGroupProps={},Md.textAreaProps=(zc.placeholder=CommonUIStrings.l_SensitivityJustificationPlaceholder,
zc),Md),ae.actionButtonProps=(Ce.label=CommonUIStrings.l_DialogChange,Ce.disabled=!jc,Ce),ae.infoMessage=CommonUIStrings.l_SensitivityJustificationMessage,ae.justificationIrrelevantLabel=CommonUIStrings.l_SensitivityJustificationNoLongerApplies,ae.justificationIncorrectLabel=CommonUIStrings.l_SensitivityJustificationIncorrect,ae.justificationOtherLabel=CommonUIStrings.l_SensitivityJustificationOther,ae.onJustificationUpdated=Object(Na.a)(this,this.zOi,"onJustificationUpdated"),ae};sb.prototype.kJj=
function(jc){jc.target&&this.KI(1,this.validate())};sb.prototype.ZQg=function(){return wb.a.hp(sb.ctd,Oa.AFrameworkApplication.ZC,sa.getImageClass(sb.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.Iqa[0],this.Iqa[1],this.Iqa[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)};sb.prototype.$8i=function(){for(var jc=document.getElementsByName(sb.pti),zc=0;zc<jc.length;zc++)Wa.a.addHandler(jc[zc],Fa.a.focus,Object(Na.a)(this,this.oLf,"radioButtonFocusHandler")),Wa.a.addHandler(jc[zc],
Fa.a.click,Object(Na.a)(this,this.oLf,"radioButtonFocusHandler"))};sb.prototype.oLf=function(jc){if(jc=jc.target){jc.checked=!0;var zc=$get(sb.oNb);jc.id===sb.cHd+(this.Iqa.length-1)?(zc.disabled=!1,Sys.UI.DomElement.setVisible(zc,!0),zc.focus()):(zc.disabled=!0,jc.focus());this.KI(1,this.validate())}};Ck.Object.defineProperties(sb,{Hu:{configurable:!0,enumerable:!0,get:function(){return Oa.AFrameworkApplication.sa.Pa.wv&&Oa.AFrameworkApplication.sa.Pa.$qd}}});sb.ctd=db.ctd;sb.pti="ListRadioBox";
sb.cHd="radiobox";sb.oNb="txtJustification";sb.iconName="Info_32x32x32";sb.id="JustificationDialog";Object(ta.a)(sb,"JustificationDialog",wb.a,[]);var lc=wb.a;Am(Ta,lc);Ta.prototype.nzi=function(jc,zc){1===jc&&zc.selectedLabel&&(jc=zc.selectedLabel,""!==jc&&this.iog(jc))};Object(ta.a)(Ta,"MandatoryLabellingDialog",wb.a,[]);wa.prototype.m8g=function(jc,zc,Md){this.Sjb&&new Ta(jc,zc,Md)};Ck.Object.defineProperties(wa,{instance:{configurable:!0,enumerable:!0,get:function(){return wa.Ma||(wa.Ma=new wa)}}});
wa.Ma=null;Object(ta.a)(wa,"MandatoryLabellingDialogFactory",null,[739]);qa.mGj="sbProtectForm14";qa.oGj="SBStatusBarMarkAsReadOnly14";qa.Csi="Info_16x16x32";qa.xqb="QuickSearchCompletedToday_16x16x32";qa.CHd="CommonControlCheckboxCheck_16";qa.F$f="On";qa.visible="Visible";qa.nEh="ImageIsVisible";qa.nG="SourceControlId";qa.menuItemId="MenuItemId";qa.menu="Menu";qa.bXc="AppLockId";qa.value="Value";qa.Ci="LabelText";qa.alt="Alt";qa.F$e="Image16by16";qa.a6a="Image16by16Class";qa.lGj="SBProtectForm_16";
qa.nGj="SBStatusBarMarkAsReadOnly_16";qa.icon="Icon";qa.iconColor="IconColor";qa.customTooltip="CustomTooltip";qa.u6i="MipTagDynamicFillWithOutline_20";qa.v6i="MipTagLockDynamicFillWithOutline_20";qa.t6i="MipTagErrorOutline_20";qa.w6i="MipTagQuestionOutline_20";qa.JXd="transparent";Object(ta.a)(qa,"PolicyConstants",null,[]);var eb=wb.a;Am(Aa,eb);Aa.prototype.koa=function(){var jc={};jc=(jc.id="UserDefinedPermissions",jc);Aa.Hu&&this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,
Object(Na.a)(this,this.jVj,"userDefinedPermissionsDialogHandler"),jc)};Aa.prototype.jVj=function(jc){1!==jc&&this.WD(jc,this.zWb,"")};Ck.Object.defineProperties(Aa,{Hu:{configurable:!0,enumerable:!0,get:function(){return Oa.AFrameworkApplication.sa.Pa.wv&&Oa.AFrameworkApplication.sa.Pa.$qd}}});Aa.id="UserDefinedPermissionsDialog";Object(ta.a)(Aa,"UserDefinedPermissionsDialog",wb.a,[]);var ib=b(651),cc=b(392),Pa=b(322),nc=b(630),pb=b(100),rb=b(187),Ya=b(623),ec=b(621),yd=b(176),Ub=b(460),Ob=b(133),
Yb=b(91),xb=b(204),Sa=b(519),Tb=b(85),Cc=b(106),Fb=b(27),hc=b(55);va.prototype.Og=function(){this.La.fc(Fb.a.GFf,Cc.a.frame,Object(Na.a)(this,this.$Je,"documentLabelPaneHandler"));this.La.Ze(Fb.a.Xab,Cc.a.frame,Object(Na.a)(this,this.Xab,"queryPolicyLabel"),96);this.La.fc(Fb.a.KTa,Cc.a.frame,Object(Na.a)(this,this.KTa,"toggleSensitivity"));this.La.fc(Fb.a.Eza,Cc.a.frame,Object(Na.a)(this,this.Eza,"populateSensitivityFlyout"));this.La.fc(Fb.a.setSensitivity,Cc.a.frame,Object(Na.a)(this,this.setSensitivity,
"setSensitivity"));this.La.Ze(Fb.a.Yab,Cc.a.frame,Object(Na.a)(this,this.Yab,"querySensitivity"),96);this.La.fc(Fb.a.n7,Cc.a.frame,Object(Na.a)(this,this.n7,"querySensitivityToggleButton"));this.La.fc(Fb.a.m7,Cc.a.frame,Object(Na.a)(this,this.m7,"querySensitivitySubFlyout"));this.La.fc(Fb.a.koa,Cc.a.frame,Object(Na.a)(this,this.koa,"showUserDefinedPermissionsDialog"));this.IYa(Fb.a.KTa)||this.La.RRa(Fb.a.KTa,4);this.IYa(Fb.a.Eza)||this.La.RRa(Fb.a.Eza,4);this.IYa(Fb.a.setSensitivity)||this.La.RRa(Fb.a.setSensitivity,
4);this.IYa(Fb.a.n7)||this.La.RRa(Fb.a.n7,4);this.IYa(Fb.a.m7)||this.La.RRa(Fb.a.m7,4);this.IYa(Fb.a.koa)||this.La.RRa(Fb.a.koa,4);this.ef.updateCommandUI();Oa.AFrameworkApplication.ga&&Oa.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&yd.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&this.Xg.value.Ccj(Object(Na.a)(this,this.IOf,"registerActionsHandler"))};va.prototype.IOf=
function(){this.Og()};va.prototype.iOb=function(){this.La.LB(Fb.a.GFf,Cc.a.frame,Object(Na.a)(this,this.$Je,"documentLabelPaneHandler"));this.La.LB(Fb.a.Xab,Cc.a.frame,Object(Na.a)(this,this.Xab,"queryPolicyLabel"));this.La.LB(Fb.a.KTa,Cc.a.frame,Object(Na.a)(this,this.KTa,"toggleSensitivity"));this.La.LB(Fb.a.Eza,Cc.a.frame,Object(Na.a)(this,this.Eza,"populateSensitivityFlyout"));this.La.LB(Fb.a.setSensitivity,Cc.a.frame,Object(Na.a)(this,this.setSensitivity,"setSensitivity"));this.La.LB(Fb.a.Yab,
Cc.a.frame,Object(Na.a)(this,this.Yab,"querySensitivity"));this.La.LB(Fb.a.n7,Cc.a.frame,Object(Na.a)(this,this.n7,"querySensitivityToggleButton"));this.La.LB(Fb.a.m7,Cc.a.frame,Object(Na.a)(this,this.m7,"querySensitivitySubFlyout"));this.La.LB(Fb.a.koa,Cc.a.frame,Object(Na.a)(this,this.koa,"showUserDefinedPermissionsDialog"))};va.prototype.KTa=function(){return 32};va.prototype.XXe=function(jc){var zc="mandatoryLabelling_"+jc.Id;this.Zbe[zc]=jc.Id;var Md={};return Md.type="AppToggleButtonProps",
Md.id=zc,Md.label=jc.DisplayName,Md.hideLabel=!1,Md.customTooltip=jc.Tooltip,Md};va.prototype.ETh=function(){var jc=[],zc=this.L9,Md;for(Md in zc){var Ce=zc[Md],ae=this.ew[Md];if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",!1)){if(!ae||!ae.Enabled||ae.HasUserDefinedPermissions)continue}else if(!ae||!ae.Enabled)continue;if(Ce.count){var ud={};ud=(ud.sections=[],ud.shouldAutoOpen=!1,ud);var Rb={};Rb=(Rb.id="mandatoryLabelling_flyoutMenuSection_"+ae.Id,
Rb.controls=[],Rb);Ce=Cl(Ce);for(var Ie=Ce.next();!Ie.done;Ie=Ce.next()){Ie=this.ew[Ie.value];if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",!1)){if(!Ie||!Ie.Enabled||Ie.HasUserDefinedPermissions)continue}else if(!Ie||!Ie.Enabled)continue;Array.add(Rb.controls,this.XXe(Ie))}Array.add(ud.sections,Rb);Rb={};ae=(Rb.type="AppFlyoutAnchorProps",Rb.id="mandatoryLabelling_"+ae.Id,Rb.label=ae.DisplayName,Rb.hideLabel=!1,Rb.hideChevron=!1,Rb.hideIcon=!1,
Rb.menuDefinition=ud,Rb);Array.add(jc,ae)}else Array.add(jc,this.XXe(ae))}return jc};va.prototype.Eza=function(jc,zc,Md,Ce,ae){if(1===Md||!this.Xg.value.Bha(!0))return 32;ae.MenuItems=Object.assign(new Ya.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});Array.add(ae.MenuItems.MenuSectionList,this.Pc(!this.isReactRibbonEnabled()));this.oh.CustomUrl&&Array.add(ae.MenuItems.MenuSectionList,this.c8g(this.isReactRibbonEnabled()?this.oh.CustomUrl:Db.a.nf(this.oh.CustomUrl)));this.isReactRibbonEnabled()||
(ae.PopulationXML=Pa.s(ae.MenuItems));return 32};va.prototype.Yab=function(jc,zc,Md,Ce,ae){if(1===Md||!ae||!this.Uyb)return 32;this.oh=this.Xg.value.Kn;if(this.Xg.value.Bha(!0)&&(ae[qa.visible]=!0,rb.a("MipLabelsAvailable"),this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",!1)&&this.oh&&this.oh.AreLabelsAvailable&&(jc=Tb.a.instance.lc("Common.ISystemInitiatedFeedback")))){var ud=va.Gh(this.oh.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";
jc.execute(function(Rb){Rb.logActivity(ud,null)})}return 32};va.prototype.n7=function(jc,zc,Md,Ce,ae){if(1===Md||!ae)return 32;var ud,Rb;ae[qa.F$f]=!!(ud=ae[qa.menuItemId])&&!!(Rb=this.qXa[ud])&&Rb===this.oh.AppliedPolicyId;return 32};va.prototype.m7=function(jc,zc,Md,Ce,ae){if(1===Md||!ae)return 32;var ud,Rb,Ie;jc=!!(ud=ae[qa.nG])&&!!(Rb=this.qXa[ud])&&!!(Ie=this.L9[Rb])&&Ie.contains(this.oh.AppliedPolicyId);ae[qa.nEh]=jc;ae[qa.F$f]=jc;return 32};va.prototype.setSensitivity=function(jc,zc,Md,Ce,
ae){return 1!==Md&&ae?this.iSa(this.qXa[ae[qa.nG]],ae,2):32};va.prototype.Hgc=function(){return!!Oa.AFrameworkApplication.sa&&1===Oa.AFrameworkApplication.sa.mode};va.prototype.g8i=function(){this.dMc&&!this.Hgc()&&(this.dMc=!1,this.Xg.value.f8i())};va.prototype.vag=function(){this.oh.DefaultLabelId&&this.oh.MandatoryLabelingEnforced?this.bIc||this.Hgc()?this.oh.AppliedPolicyId?this.w9c(""):(this.Xg.value.Pmi(this.Xg.value.NBb)||this.Hgc())&&this.rMe():this.JZf():this.oh.DefaultLabelId?this.JZf():
this.oh.MandatoryLabelingEnforced&&(this.oh.AppliedPolicyId?this.w9c(""):this.rMe())};va.prototype.Jff=function(){return this.oh.MandatoryLabelingEnforced?this.oh&&this.oh.AreLabelsAvailable?this.vb.ra("TestOverrideIsReactDialogEnabled")||this.ef&&this.ef.Pa&&this.ef.Pa.wv?!0:(ra.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(ra.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),!1):(ra.ULS.sendTraceTag(539109063,
306,50,"Mandatory labelling not invoked b/c user did not have policy!"),!1)};va.prototype.rMe=function(){var jc=this;!this.Jff()||Oa.AFrameworkApplication.P5||this.Ybe||(this.Ybe=Oa.AFrameworkApplication.P5=!0,ra.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.Xg.value.HLf("",1),this.Xg.value.fVc(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,
function(){jc.lzi()}))};va.prototype.w9c=function(jc){this.Jff()&&Oa.AFrameworkApplication.P5&&(Oa.AFrameworkApplication.P5=!1,ra.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),this.Xg.value.CJd(),this.Xg.value.HLf(jc,2))};va.prototype.lzi=function(){wa.instance.m8g(this.ETh(),this.oh.CustomUrl,Object(Na.a)(this,this.mzi,"mandatoryLabellingDialogCallback"))};va.prototype.mzi=function(jc){this.w9c(this.Zbe[jc])};va.prototype.fue=function(){return this.vb.ra("CoAuthForProtectedFilesEnabled")&&
this.vb.ra("SupportsOfficeClientCoauthoring")&&this.vb.ra("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this.B7d&&this.$zb};va.prototype.iSa=function(jc,zc,Md){var Ce=this;this.Xg.value.b5i(Md);var ae=32,ud=!1,Rb=!0,Ie=2===Md||8===Md||16===Md,pa=jc===this.oh.AppliedPolicyId;if(this.hGc&&this.hGc(jc,Ie))ra.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",Md),this.ef.updateCommandUI();else if(zc&&qa.bXc in
zc&&this.Xg.value.Zrj(zc[qa.bXc]),jc)if(this.Xg.value.Thf()||this.fue()&&this.wMc)ra.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",Md),this.ef.updateCommandUI(),Ie&&this.D_b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.vb.ra("HasDocumentEditRights"))if(this.Xg.value.iVg(jc))if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",
!1)&&this.ew[jc]&&this.ew[jc].HasUserDefinedPermissions&&!pa)ra.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",Md),1!==Md&&4!==Md&&this.oJg();else if(Ie&&this.oh.MandatoryLabelingEnforced&&pa)ra.ULS.sendTraceTag(570972054,306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",Md),this.D_b(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);
else{if(Ie&&this.vb.ra("WacLabelingJustificationDialogIsEnabled")&&this.oh.RequiredDowngradeJustification&&(pa||this.ew[jc].RequiredDowngradeJustification)&&!this.iUb)return ra.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",Md),this.WSd(jc),ae;if(this.fue()&&!this.B7d())this.XFc<this.Ulg?(ra.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.XFc,Md),this.wMc=!0,this.XFc++,hc.Task.delay(this.Vlg).continueWith(function(){Ce.wMc=
!1;Ce.iSa(jc,zc,Md)})):(ra.ULS.sendTraceTag(577356771,306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",Md),ud=1!==Md,Rb=!1,ae=8);else{if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.WacBlockParentLabelSetLabel",!1)&&this.zli(jc)&&(ra.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",Md),1===Md||8===Md||4===Md))return ae;ra.ULS.sendTraceTag(570972056,
306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",Md);this.setPolicyLabel(pa?"":jc,this.iUb,"",Md);return ae}}else ra.ULS.sendTraceTag(42796169,306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",Md),this.ef.updateCommandUI(),Ie&&this.D_b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else ra.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",
Md),this.ef.updateCommandUI(),Ie&&this.D_b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);else ra.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",Md),this.ef.updateCommandUI(),ud=Ie,Rb=!1,ae=8;this.Xg.value.qHd(0,Md,ud,Rb);return ae};va.prototype.JZa=function(jc,zc,Md,Ce){Md=void 0===Md?null:Md;Ce=void 0===Ce?!1:Ce;pb.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",
0,"wordclpfc",null);this.vb.ra("SupportsOfficeClientCoauthoring")&&this.vb.ra("CoAuthForProtectedFilesIsEnabled")?(this.Vjb=!1,(this.oh=this.Xg.value.Kn)&&!this.oh.AppliedPolicyId?this.Vjb=!0:this.oh&&this.oh.PolicyLabelAssignmentMethod&&(this.Vjb=xb.c(this.oh.PolicyLabelAssignmentMethod)===xb.c("standard"))):this.Vjb=Ce;jc=va.Gh(jc)?null:this.ew[jc];(zc=va.Gh(zc)?null:this.ew[zc])?this.yga=new ac(zc,!0,Md):(this.Xg.value.Fda(29),this.Dfa=null);jc?this.Lpa=new ac(jc,!1):this.OVa=null;this.vGd(null,
null);return 32};va.prototype.gLg=function(jc){""!==this.oh.AppliedPolicyId?this.Xg.value.qHd(4,16,!0):this.iSa(jc,null,16)};va.prototype.D_f=function(){this.ew={};if(this.oh=this.Xg.value.Kn)for(var jc=Cl(this.oh.SensitivityLabels),zc=jc.next();!zc.done;zc=jc.next())zc=zc.value,this.ew[zc.Id]=zc};va.prototype.zli=function(jc){if(this.L9&&jc in this.L9){jc=Cl(this.L9[jc]);for(var zc=jc.next();!zc.done;zc=jc.next())if((zc=this.ew[zc.value])&&zc.Enabled)return!0}return!1};va.prototype.m0f=function(){this.L9=
{};if(this.oh=this.Xg.value.Kn){for(var jc=Cl(this.oh.SensitivityLabels),zc=jc.next();!zc.done;zc=jc.next())zc=zc.value,zc.ParentId||(this.L9[zc.Id]=new ob.a);jc=Cl(this.oh.SensitivityLabels);for(zc=jc.next();!zc.done;zc=jc.next())zc=zc.value,zc.ParentId&&zc.ParentId in this.L9&&this.L9[zc.ParentId].add(zc.Id)}};va.prototype.UKf=function(){if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)){this.oh=this.Xg.value.Kn;var jc=this.Uyb&&this.isReactRibbonEnabled()&&
this.Xg.value.Bha();va.WQa(jc)}else this.Uyb&&this.isReactRibbonEnabled()?(this.oh=this.Xg.value.Kn,this.Xg.value.Bha()?(va.WQa(!0),appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1))):va.WQa(!1)):va.WQa(!1)};va.prototype.D8i=function(jc){this.hGc=jc};va.prototype.v9i=function(jc){this.tMc=jc};va.prototype.JZf=function(){this.vb.ra("WacApplyDefaultPolicyLabelIsEnabled")&&(this.Hgc()?this.dMc=!0:this.bIc||(this.bIc=!0,(this.oh=this.Xg.value.Kn)&&this.oh.DefaultLabelId&&
!this.oh.AppliedPolicyId&&(ra.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this.oh.DefaultLabelId),this.iSa(this.oh.DefaultLabelId,null,1))))};va.prototype.vGd=function(){var jc=this;if(!this.Xg.value.Thf()){var zc=this.ew[this.Xg.value.Kn.AppliedPolicyId];this.Vjb&&this.Lpa&&this.OVa!==this.Lpa.id&&(!zc||zc.Order<this.Lpa.sensitivityLabel.Order)&&(zc=this.iSa(this.Lpa.id,{},4),32!==zc?ra.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+
zc):(this.OVa=this.Lpa.id,this.Dfa&&(zc=this.ew[this.Dfa])&&zc.Order<=this.Lpa.sensitivityLabel.Order&&(this.Xg.value.Fda(29),this.Dfa=null)));zc=this.ew[this.Xg.value.Kn.AppliedPolicyId];if(this.yga&&this.Dfa!==this.yga.id&&(!zc||zc.Order<this.yga.sensitivityLabel.Order)){var Md=this.yga.id;this.Xg.value.Fda(29);this.Xg.value.$Yb(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.Kgd(this.yga.sensitivityLabel))+" "+this.yga.j7i,CommonUIStrings.l_PolicyLabelRecommendationButton,
function(){jc.iSa(Md,{},8)});this.Dfa=this.yga.id}this.yga=this.Lpa=null}};va.prototype.setPolicyLabel=function(jc,zc,Md,Ce){Ce=void 0===Ce?2:Ce;this.iUb=zc;this.Xg.value.setPolicyLabel(jc);this.ef.updateCommandUI();zc=new kb(Ce,this.Kgd(this.ew[jc]));this.Xg.value.dQd(jc,this.iUb,zc)};va.prototype.j3g=function(jc,zc,Md){1===jc&&this.setPolicyLabel(zc,"",Md)};va.prototype.i3g=function(jc,zc,Md){1===jc?this.setPolicyLabel(zc===this.oh.AppliedPolicyId?"":zc,Md,""):this.ef.updateCommandUI()};va.prototype.WSd=
function(jc){(new sb(jc,Object(Na.a)(this,this.i3g,"continueToSetPolicyLabelFromJustificationDialog"))).WSd()};va.prototype.D_b=function(jc,zc){jc=void 0===jc?"":jc;zc=void 0===zc?"":zc;var Md=new Ob.StandardDialog;Md.rv=Oa.AFrameworkApplication.azb;Md.jc=0;Md.Bc(1,CommonUIStrings.l_DialogClose);Md.OX(jc,zc,null)};va.prototype.jPg=function(jc){1===jc&&this.Xg.value.f5i()};va.prototype.oJg=function(){var jc=new Ob.StandardDialog;jc.rv=Oa.AFrameworkApplication.azb;jc.jc=1;jc.Bc(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);
jc.Bc(0,CommonUIStrings.l_DialogClose);jc.OX(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(Na.a)(this,this.jPg,"blockUDPSetLabelHandler"))};va.prototype.isReactRibbonEnabled=function(){return!!this.ef&&!!this.ef.Pa&&this.ef.Pa.Oi};va.prototype.jic=function(){return this.ef&&this.ef.Pa?this.ef.Pa.jic:!1};va.prototype.$Je=function(){return 32};va.prototype.koa=function(jc,zc,Md,Ce,ae){jc=this.qXa[ae[qa.nG]];jc!==this.oh.AppliedPolicyId?
(new Aa(jc,Object(Na.a)(this,this.j3g,"continueToSetPolicyLabelFromUDPDialog"))).koa():this.iSa(jc,null,2);return 32};va.prototype.Xab=function(jc,zc,Md,Ce,ae){if(1===Md)return 32;this.oh=this.Xg.value.Kn;if(!this.oh||!ae)return 32;ae[qa.value]="";ae[qa.Ci]="";ae[qa.alt]=null;ae[qa.F$e]=null;ae[qa.a6a]=null;ae[qa.customTooltip]="";ae[qa.visible]=!1;ae[qa.iconColor]="";Md=zc=jc=ae[qa.icon]="";if(!this.oh.AreLabelsAvailable){if(!this.NMc)return 32;jc=this.NMc;Md=qa.JXd;this.MMc&&(zc=this.MMc)}else if(this.oh.AppliedPolicyId){Ce=
null;for(var ud=Cl(this.oh.SensitivityLabels),Rb=ud.next();!Rb.done;Rb=ud.next())if(Rb=Rb.value,Rb.Id.toLowerCase()===this.oh.AppliedPolicyId.toLowerCase()){Ce=Rb;break}Ce&&(jc=this.Kgd(Ce),zc=Ce.Tooltip,this.QPc=Oa.AFrameworkApplication.protectedFile=Ce.IsEndpointProtectionEnabled,Md=this.UYe(Ce))}this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(jc?(ae[qa.value]=jc,ae[qa.Ci]=jc,ae[qa.customTooltip]=zc,this.N_f(Md,this.QPc,ae)):this.vb.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.ClpUseOutlineImageForNoLabel")?
(ae[qa.iconColor]=qa.JXd,this.oh.MandatoryLabelingEnforced?(ae[qa.value]=ae[qa.Ci]=HeaderStrings.SelectASensitivityLabel,ae[qa.icon]=qa.t6i):(ae[qa.value]=ae[qa.Ci]=HeaderStrings.NoSensitivityLabel,ae[qa.icon]=qa.w6i)):(ae[qa.iconColor]="#000000",this.oh.MandatoryLabelingEnforced?(ae[qa.value]=ae[qa.Ci]=HeaderStrings.SelectASensitivityLabel,ae[qa.icon]="MipTagErrorDynamicColor_20"):(ae[qa.value]=ae[qa.Ci]=HeaderStrings.NoSensitivityLabel,ae[qa.icon]="MipTagQuestionDynamicColor_20")),ae[qa.visible]=
!0):jc&&(ae[qa.value]=jc,ae[qa.Ci]=jc,this.jic()?ae[qa.customTooltip]=zc:ae[qa.alt]=zc,this.N_f(Md,this.QPc,ae),ae[qa.visible]=!0);return 32};va.prototype.Kgd=function(jc){return jc?this.ew?jc.ParentId&&this.ew[jc.ParentId]?this.ew[jc.ParentId].DisplayName+"\\"+jc.DisplayName:jc.DisplayName:(ra.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),jc.DisplayName):""};va.prototype.N_f=function(jc,zc,Md){this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",
!1)?(Md[qa.icon]=this.k4e(zc),Md[qa.iconColor]=this.l4e(jc)):this.jic()?Md[qa.icon]=zc?qa.lGj:qa.nGj:(Md[qa.F$e]=Oa.AFrameworkApplication.ZC,Md[qa.a6a]=zc?sa.getImageClass(qa.mGj):sa.getImageClass(qa.oGj))};va.prototype.c8g=function(jc){var zc=this.dV("LearnMoreSection",!0);jc=Object.assign(new cc.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:jc,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:Oa.AFrameworkApplication.ZC,Image16by16Class:sa.getImageClass(qa.Csi),
Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});Array.add(zc.ControlList,jc);return zc};va.prototype.cGe=function(jc,zc,Md){Md=void 0===Md?!1:Md;var Ce="Toggle_"+jc.Id;Ce="Sensitivity_"+Ce;var ae=jc.DisplayName,ud=jc.Tooltip,Rb=jc.Id===this.oh.AppliedPolicyId,Ie=Md?Db.a.nf(Ce):Ce;this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(Rb=this.UYe(jc),zc=Object.assign(new Ub.a,{Id:Ie,ExternalId:Ie,LabelText:Md?Db.a.nf(ae):ae,Command:jc.HasUserDefinedPermissions&&
this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPLabelEnabled",!1)?"1809771611":"2935633379",MenuItemId:Ie,QueryCommand:"991261903",Visible:!0,Alt:Md?Db.a.nf(ud):ud,AriaLabel:Yb.a.n0b,IconColor:this.l4e(Rb),KeyTip:zc}),zc.ExternalImageId=this.k4e(jc.IsEndpointProtectionEnabled)):(Ie=Object.assign(new ib.a,{Id:Ie,ExternalId:Ie,LabelText:Md?Db.a.nf(ae):ae,Command:"2935633379",MenuItemId:Ie,QueryCommand:"991261903",CheckedImage:Oa.AFrameworkApplication.ZC,Visible:!0,Alt:Md?Db.a.nf(ud):
ud,IsChecked:Rb,AriaLabel:Yb.a.n0b,KeyTip:zc}),this.isReactRibbonEnabled()?(Ie.CheckedImageClass=sa.getImageClass(qa.CHd),Ie.ExternalImageId=qa.CHd):Ie.CheckedImageClass=sa.getImageClass(qa.xqb),zc=Ie);Ie=Ce;this.qXa[Ie]=jc.Id;this.Qee[jc.Id]=Ie;return zc};va.prototype.dV=function(jc,zc){zc=void 0===zc?!1:zc;return Object.assign(new ec.a,{Title:"",Id:jc,DisplayMode:qa.menu,ShowMenuSectionSeparator:zc,ControlsId:"Ctrl_"+jc,ControlList:[]})};va.prototype.bah=function(jc,zc,Md){jc=this.dV(jc+"Sub");
var Ce=1;zc=Cl(zc);for(var ae=zc.next();!ae.done;ae=zc.next())(ae=this.ew[ae.value])&&ae.Enabled&&(Array.add(jc.ControlList,this.cGe(ae,Ce.toString(),Md)),Ce++);return jc};va.prototype.Pc=function(jc){jc=void 0===jc?!1:jc;var zc=this.dV("SensitivitySection"),Md=1,Ce=this.L9,ae;for(ae in Ce){var ud=Ce[ae],Rb=this.ew[ae];if(Rb&&Rb.Enabled){if(ud.count){var Ie="Sensitivity_"+Rb.Name,pa=jc?Db.a.nf(Ie):Ie;pa=Object.assign(new nc.a,{Id:pa,ExternalId:pa,LabelText:jc?Db.a.nf(Rb.DisplayName):Rb.DisplayName,
Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new Ya.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:Yb.a.n0b,KeyTip:Md.toString()});this.isReactRibbonEnabled()?pa.ExternalImageId=qa.CHd:(pa.Image16by16=Oa.AFrameworkApplication.ZC,pa.Image16by16Class=sa.getImageClass(qa.xqb));Array.add(pa.Menu.MenuSectionList,this.bah(Ie,ud,jc));Array.add(zc.ControlList,pa);this.qXa[pa.Id]=Rb.Id;this.Qee[Rb.Id]=pa.Id}else Array.add(zc.ControlList,
this.cGe(Rb,Md.toString(),jc));Md++}}return zc};va.prototype.IYa=function(jc){return!!this.La.Y4(jc)&&!!this.La.Y4(jc).flags&&!!this.La.Y4(jc).flags.length};va.prototype.DUi=function(jc,zc){zc.onSuccess&&this.ew&&(jc=this.ew[this.Xg.value.Kn.AppliedPolicyId])&&(this.Dfa&&(zc=this.ew[this.Dfa])&&zc.Order<=jc.Order&&(this.Xg.value.Fda(29),this.Dfa=null),this.OVa&&this.OVa!==jc.Id&&(this.Xg.value.Fda(28),this.OVa=null))};va.prototype.k4e=function(jc){return jc?qa.v6i:qa.u6i};va.prototype.l4e=function(jc){return jc?
jc:qa.JXd};va.prototype.UYe=function(jc){if(jc.Color||!jc.ParentId)return jc.Color;var zc=this.ew[jc.ParentId];return zc?zc.Color:jc.Color};va.WQa=function(jc){Oa.AFrameworkApplication.ga&&Oa.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(jc?(Sa.a.yzd("ribbon","sensitivity"),Sa.a.uzd("ribbon","sensitivity")):Sa.a.xzd("ribbon","sensitivity"));Oa.AFrameworkApplication.ga&&Oa.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",
!1)&&yd.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!jc))};va.Gh=function(jc){return jc&&jc.length?!1:!0};Ck.Object.defineProperties(va.prototype,{$zb:{configurable:!0,enumerable:!0,get:function(){return Oa.AFrameworkApplication.$zb||!!this.tMc&&this.tMc()}}});Object(ta.a)(va,"PolicyActor",null,[719]);var cd=b(736),mb=b(615),$a=b(97),K;(function(jc){jc[jc.unknown=0]="unknown";jc[jc.boot=1]="boot";jc[jc.refresh=2]="refresh";jc[jc.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(K||
(K={}));Object(ta.b)("GetPolicyLabelsReason",K);var ba=Sys.EventArgs;Am(xa,ba);Object(ta.a)(xa,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);var ua=Sys.EventArgs;Am(ka,ua);Object(ta.a)(ka,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var La;(function(jc){jc[jc.none=0]="none";jc[jc.reasonDefaultLabel=1]="reasonDefaultLabel";jc[jc.reasonManual=2]="reasonManual";jc[jc.reasonAutomatic=4]="reasonAutomatic";jc[jc.reasonRecommended=8]="reasonRecommended";jc[jc.reasonMandatory=
16]="reasonMandatory"})(La||(La={}));Object(ta.b)("ApplyLabelFlags",La);var ub=Sys.EventArgs;Am(ha,ub);Object(ta.a)(ha,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);var Va=Sys.EventArgs;Am(na,Va);Object(ta.a)(na,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);var tb=Sys.EventArgs;Am(aa,tb);Object(ta.a)(aa,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);Object(ta.a)(fa,"GetPolicyLabelsData",null,[]);var Cb=Sys.EventArgs;Am(U,Cb);Object(ta.a)(U,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);var nb=
Sys.EventArgs;Am(L,nb);Object(ta.a)(L,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);var Ib=Sys.EventArgs;Am(H,Ib);Object(ta.a)(H,"PolicyTipEventArgs",Sys.EventArgs,[]);var hb=Sys.EventArgs;Am(I,hb);Object(ta.a)(I,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);var zb=Sys.EventArgs;Am(ca,zb);Object(ta.a)(ca,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Gc=Sys.EventArgs;Am(Z,Gc);Object(ta.a)(Z,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);var Fc=Sys.EventArgs;
Am(ea,Fc);Object(ta.a)(ea,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);var Ed=Sys.EventArgs;Am(Q,Ed);Object(ta.a)(Q,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);var Jc=Sys.EventArgs;Am(R,Jc);Object(ta.a)(R,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var Ca=b(108),bb=b(103),dc=b(41),Ac=b(80),nd=b(39);Object(ta.a)(T,"ClientRequest",null,[]);var qd=b(494),Gb=b(276);M.Kqj=function(jc,zc){if(!jc||!zc||jc.count!==zc.count)return!1;jc=Cl(jc);for(var Md=jc.next();!Md.done;Md=jc.next())if(!zc.contains(Md.value))return!1;
return!0};M.toArray=function(jc){if(!jc)return null;var zc=Array(jc.count),Md=0;jc=Cl(jc);for(var Ce=jc.next();!Ce.done;Ce=jc.next())zc[Md]=Ce.value,Md++;return zc};Object(ta.a)(M,"HashSetUtils",null,[]);var Oc=b(291),he=b(77),Wd=b(356);A.prototype.Xoe=function(jc){this.Za.addHandler("PolicyTipEvent",jc)};A.prototype.MZb=function(jc){this.Za.addHandler("LabelInfoUpdateEvent",jc)};A.prototype.Ccj=function(jc){this.Za.removeHandler("LabelInfoUpdateEvent",jc)};A.prototype.kpe=function(jc){this.Za.addHandler("SetPolicyLabelEventKey",
jc)};A.prototype.Rdj=function(jc){this.Za.removeHandler("SetPolicyLabelEventKey",jc)};A.prototype.lWc=function(jc){this.Za.addHandler("SetPolicyLabelFailureEventKey",jc)};A.prototype.Qdj=function(jc){this.Za.removeHandler("SetPolicyLabelFailureEventKey",jc)};A.prototype.IFg=function(jc){this.Za.addHandler("GetPolicyLabelEventKey",jc)};A.prototype.HFg=function(jc){this.Za.addHandler("GetPolicyLabelFailureEventKey",jc)};A.prototype.FFg=function(jc){this.Za.addHandler("GetAutoPolicyLabelEventKey",jc);
this.bod&&(ra.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.gHd(new na(0)))};A.prototype.icj=function(jc){this.Za.removeHandler("GetAutoPolicyLabelEventKey",jc)};A.prototype.dFg=function(jc){this.Za.addHandler("CreateAutoCLPSecurityNodesEventKey",jc)};A.prototype.Mbj=function(jc){this.Za.removeHandler("CreateAutoCLPSecurityNodesEventKey",jc)};A.prototype.XHg=function(jc){this.Za.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",
jc)};A.prototype.dej=function(jc){this.Za.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",jc)};A.prototype.YHg=function(jc){this.Za.addHandler("UpdateAutoCLPSITNodesEventKey",jc)};A.prototype.eej=function(jc){this.Za.removeHandler("UpdateAutoCLPSITNodesEventKey",jc)};A.prototype.Pne=function(jc){this.Za.addHandler("AddAutoPolicyBusinessBarEntryEventKey",jc)};A.prototype.bbj=function(jc){this.Za.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",jc)};A.prototype.$oe=function(jc){this.Za.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",
jc)};A.prototype.zdj=function(jc){this.Za.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",jc)};A.prototype.Qne=function(jc){this.Za.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",jc)};A.prototype.dbj=function(jc){this.Za.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",jc)};A.prototype.ape=function(jc){this.Za.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",jc)};A.prototype.Adj=function(jc){this.Za.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",
jc)};A.prototype.pGg=function(jc){this.Za.addHandler("MandatoryLabellingAppHandlerEventKey",jc)};A.prototype.Ncj=function(jc){this.Za.removeHandler("MandatoryLabellingAppHandlerEventKey",jc)};A.prototype.UHg=function(jc){this.Za.addHandler("UDPLabelingAppHandlerEventKey",jc)};A.prototype.bej=function(jc){this.Za.removeHandler("UDPLabelingAppHandlerEventKey",jc)};A.prototype.EXg=function(){return Oa.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsClpBlockedByAppSpecificScenarioEnabled",
!1)?this.$9d?this.$9d():!1:!1};A.prototype.z8i=function(jc){this.QFc=jc};A.prototype.Iw=function(){return(new Date).getTime()};A.prototype.rbc=function(){this.Eh&&(this.BVb=this.Eh.Hc("WebServiceCall","Call Get Policy Endpoint On Server"));var jc=Oc.a.Dia(1,1);this.vb.ra("SendHostAttributionInfoForPolicyLabelEnabled")?(jc=new T(this.H4a("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,jc),this.Wg.send(jc).HId(Object(Na.a)(this,
this.Uwf,"onDataLossPolicySuccessCallback"),Object(Na.a)(this,this.Twf,"onDataLossPolicyFailureCallback"))):this.Wg.hm(this.H4a("datalosspolicy"),1,null,null,!0,2,Object(Na.a)(this,this.Uwf,"onDataLossPolicySuccessCallback"),Object(Na.a)(this,this.Twf,"onDataLossPolicyFailureCallback"),null);this.pjb++;ra.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.Pee,this.pjb)};A.prototype.f8i=function(){this.Oed(this.T8,2,this.Ipa)};
A.prototype.Oed=function(jc,zc,Md,Ce){zc=void 0===zc?0:zc;Md=void 0===Md?null:Md;Ce=void 0===Ce?!1:Ce;pb.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.Zed(void 0,zc));this.zwb=this.Iw();var ae=this.q4c(zc);this.qbc(jc,ae,Md,Ce,zc);this.bLd(!0)};A.prototype.Uwf=function(jc){this.THf();var zc=this.gYd(jc);jc=zc.data;zc.returnValue&&(ra.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this.pjb=0,this.Eh&&(this.CVb=this.Eh.Hc("Task","Parse and Handle Get Policy Response")),
this.DXi(jc),this.CVb&&(this.CVb.stop(),this.CVb=null))};A.prototype.Twf=function(jc){this.THf();this.pjb<=this.FUb?this.rbc():(ra.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",jc?jc.data?jc.data.gRa:null:null),this.pjb=0)};A.prototype.Thf=function(){return 0<this.Ira};A.prototype.setPolicyLabel=function(jc){this.Kn.AppliedPolicyId=jc};A.prototype.dQd=function(jc,zc,Md){Md=void 0===Md?null:Md;var Ce=this.H7g(Md);this.Lsj(jc,zc,Ce,Md)};
A.prototype.DDf=function(jc){this.oFa&&(this.oFa.stop(),this.oFa=null);var zc=this.v3e(jc);var Md=zc.MXf;zc=zc.s0f;var Ce=jc.data.state,ae=Ce?Ce.aQ:2,ud=this.gYd(jc);jc=ud.data;ud.returnValue?(ra.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",ae),this.Ira=0,this.WXi(jc,Md,zc,Ce)):this.EMd(ae)};A.prototype.b5i=function(jc){pb.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.Zed(jc));this.YKb=this.Iw();ra.ULS.sendTraceTag(575947405,
306,50,"Raising set policy label triggered event.");this.Za.raiseEvent("SetPolicyLabelTriggeredEventKey",new Q(jc))};A.prototype.TEi=function(){this.pgc&&this.supportsOfficeClientCoauthoring&&this.ani&&this.jFa.fea(12,null,!0)};A.prototype.CDf=function(jc){this.oFa&&(this.oFa.stop(),this.oFa=null);var zc=this.v3e(jc);var Md=zc.MXf;zc=zc.s0f;this.Ira<=this.FUb?this.dQd(Md,zc):(Md=(Md=jc.data.state)?Md.aQ:2,ra.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",
jc?jc.data?jc.data.gRa:null:null,Md),this.NBb="WACServerConnectionFailed",this.Ira=0,this.EMd(Md))};A.prototype.Pmi=function(jc){if(jc&&("LabelNotSupported"===jc||"LabelErrorRetryLater"===jc||"CoherencyFailure"===jc||"LabelIdNotFound"===jc||"LabelDisabled"===jc))return ra.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",jc),!0;ra.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",jc);return!1};A.prototype.iVg=function(jc){if(!jc)return!1;for(var zc=null,Md=null,Ce=
Cl(this.Kn.SensitivityLabels),ae=Ce.next();!ae.done;ae=Ce.next())ae=ae.value,ae.Id===jc&&(zc=ae),ae.Id===this.T8&&(Md=ae);if(!zc)return!1;if(this.pgc&&this.supportsOfficeClientCoauthoring){if(this.QFc&&this.QFc()||this.ipd)return!0}else if(Oa.AFrameworkApplication.oz&&Oa.AFrameworkApplication.oz.nvb||this.Ipa&&this.Ipa())return!0;return zc.IsEndpointProtectionEnabled===(!!Md&&Md.IsEndpointProtectionEnabled)};A.prototype.$Yb=function(jc,zc,Md,Ce,ae){28===jc?this.qLf(new xa(jc,zc,Md,Ce,ae,!1)):this.qLf(new xa(jc,
zc,Md,Ce,ae,!0))};A.prototype.Fda=function(jc){28===jc?this.SLf(new I(jc,!1)):this.SLf(new I(jc,!0))};A.prototype.k4i=function(jc,zc,Md){ra.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");this.Za.raiseEvent("CreateAutoCLPSecurityNodesEventKey",new ha(jc,zc,Md))};A.prototype.g5i=function(jc){ra.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");this.Za.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new ha(null,null,jc))};A.prototype.h5i=
function(jc,zc){ra.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.Za.raiseEvent("UpdateAutoCLPSITNodesEventKey",new ha(jc,zc,null))};A.prototype.HLf=function(jc,zc){ra.ULS.sendTraceTag(572650527,306,50,"Raising a mandatory labelling"+(1===zc?"Reading":"Edit")+" switch event.");this.Za.raiseEvent("MandatoryLabellingAppHandlerEventKey",new L(jc,zc))};A.prototype.fVc=function(jc,zc,Md,Ce,ae){37===jc&&this.a4i(new ka(37,zc,Md,Ce,ae))};A.prototype.CJd=function(){this.V4i(new ca)};
A.prototype.f5i=function(){ra.ULS.sendTraceTag(540608322,306,50,"Raising a UDP labeling event.");this.Za.raiseEvent("UDPLabelingAppHandlerEventKey",new R(!0))};A.prototype.Bha=function(jc){jc=void 0===jc?!1:jc;var zc=!!this.Kn&&this.Kn.AreLabelsAvailable&&!!this.Kn.SensitivityLabels&&0<this.Kn.SensitivityLabels.length&&Gb.a.any(this.Kn.SensitivityLabels,function(Md){return!!Md&&Md.Enabled});zc||jc||va.WQa(!1);return zc};A.prototype.Ryf=function(jc){this.XDa&&(this.XDa.stop(),this.XDa=null);this.bLd(!1);
var zc=this.gYd(jc);var Md=zc.data;zc.returnValue?(ra.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this.njb=0,Md=this.MXi(Md),jc=this.q2e(jc.data),pb.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.yac(void 0,jc,this.zwb)),this.zwb=null,jc=new na(jc),this.w4i(jc),this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?Md&&this.Kwj()?this.bod?this.TQj():(this.K4b(),this.gHd(jc),this.nLc=!0):Md||this.zrc():!this.bod&&Md&&this.vb.ra("WacApplyManualPolicyLabelIsEnabled")&&
this.Ese()?(this.gHd(jc),this.nLc=!0):Md||this.zrc()):this.zrc()};A.prototype.Kwj=function(){if(!this.vb.ra("WacApplyManualPolicyLabelIsEnabled"))return ra.ULS.sendTraceTag(539877667,306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.Ese())return!1;if(""===this.T8)return ra.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),!0;if(this.XCa===this.BKc)return ra.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),
!1;ra.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");return!0};A.prototype.K4b=function(){this.Vcg();ra.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.mFa.count,this.XCa);var jc=M.toArray(this.mFa);this.k4i(jc,jc,this.XCa)};A.prototype.TQj=function(){var jc=this.mFa;this.Vcg();M.Kqj(jc,this.mFa)||(ra.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",
0<this.mFa.count),jc=M.toArray(this.mFa),this.h5i(jc,jc));this.B$d&&(ra.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",this.XCa),this.g5i(this.XCa))};A.prototype.Vcg=function(){for(var jc=new cd.a(mb.a.Pk()),zc=Cl(this.Kn.SensitivityLabels),Md=zc.next();!Md.done;Md=zc.next())if((Md=Md.value)&&Md.AutoLabelingSensitiveTypeIds&&0<Md.AutoLabelingSensitiveTypeIds.length){Md=Cl(Md.AutoLabelingSensitiveTypeIds);for(var Ce=Md.next();!Ce.done;Ce=Md.next())(Ce=
Ce.value)&&jc.add(Ce)}this.mFa=jc};A.prototype.Qyf=function(jc){var zc=this.q2e(jc.data);pb.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.yac(void 0,zc,this.zwb));this.zwb=null;this.XDa&&(this.XDa.stop(),this.XDa=null);if(this.njb<=this.FUb){if(this.vb.ra("SendHostAttributionInfoForPolicyLabelEnabled")){var Md=jc.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in Md&&Md[Oc.a.yNd]&&"HostAttributionInfo.ScenarioTypeParamName"in Md&&Md[Oc.a.zNd]){jc.data.request.get_headers();
jc.data.request.get_headers();jc=this.q4c(zc);this.qbc(this.T8,jc,this.Ipa,void 0,zc);return}}this.Oed(this.T8,zc,this.Ipa)}else ra.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",jc?jc.data?jc.data.gRa:null:null),this.zrc(),this.njb=0,this.bLd(!1)};A.prototype.q2e=function(jc){return jc.state?jc.state:0};A.prototype.H4a=function(jc,zc){zc=void 0===zc?!1:zc;var Md=String.format("{0}{1}?action={2}&{3}",this.vb.Va("PolicyHandlerWebServiceBase")||Oa.AFrameworkApplication.sa.Pa.LW,
this.Pee,jc,Oa.AFrameworkApplication.oj);"setpolicylabel"===jc&&Oa.AFrameworkApplication.oz&&Oa.AFrameworkApplication.oz.mef&&(Md=Ac.a.Gl(Md,"sl","1"));zc&&(Md=Ac.a.Gl(Md,"cbd","1"));return Md};A.prototype.v3e=function(jc){var zc;var Md=zc=null;jc&&jc.data&&jc.data.request&&jc.data.request.get_headers()&&(Md=jc.data.request.get_headers()[qd.a.NXf],zc=jc.data.request.get_headers()[qd.a.t0f]);return{MXf:Md,s0f:zc}};A.prototype.gYd=function(jc){jc=jc?jc.data?jc.data.me:null:null;return jc&&jc.length&&
!this.Bni(jc)?{returnValue:!0,data:jc}:(ra.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,data:jc})};A.prototype.DXi=function(jc){try{var zc=dc.b(jc)}catch(Md){ra.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(zc)if(zc.IsPolicyTipAvailable)switch(zc.IsPolicyTipAvailable.toLowerCase()){case "false":ra.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");
break;case "true":ra.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.YHc=zc.NavigateUrl;this.KBj(zc.GeneralText,Object(Na.a)(this,this.QJi,"onDataLossPolicyOverrideButtonClick"));break;default:ra.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",zc.IsPolicyTipAvailable)}else ra.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");
else ra.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")};A.prototype.WXi=function(jc,zc,Md,Ce){var ae=this,ud=Ce?Ce.aQ:2,Rb=0,Ie="",pa;if(function(){var Sb=dc.d(jc);pa=Sb.ev;return Sb}().returnValue)if(pa){Ie="Success";var qb=this.q4c(3);if(pa.IsSuccessful){pb.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.yac(ud,void 0,this.YKb));this.NBb=this.YKb=null;ra.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",
ud);2===ud&&this.Fda(29);this.Ktj(zc,ud);this.TEi();this.Fda(28);Ce&&4===ud&&this.$Yb(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,Ce.displayName),CommonUIStrings.l_DialogOk,function(){});rb.a("MipAppliedLabels",void 0,void 0,[Object.assign(new he.a,{name:"SetPolicyLabelApplyFlag",string:La[ud]})]);this.qbc(zc,qb,this.Ipa,void 0,3);return}ra.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",
ud,pa.FailureReason);this.NBb=pa.FailureReason;"FileTooLarge"===pa.FailureReason?Rb=1:"LabelNotSupported"===pa.FailureReason?Rb=2:"LabelDisabled"===pa.FailureReason?Rb=3:"MinorVersionLimitExceeded"===pa.FailureReason&&(Rb=5);this.Eni&&0<=pa.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(Ce=new Ca.a(2,1,this.Msj,function(){ra.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",ae.Ira);ae.Ira<=ae.FUb&&ae.dQd(zc,
Md)}),this.se.Yg(Ce));this.pgc&&this.supportsOfficeClientCoauthoring&&this.qbc(this.Kn.AppliedPolicyId,qb,this.Ipa,!0,3)}else Ie="setPolicyLabelData null.",ra.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",ud);else Ie="TryDeserialize failed.",ra.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",ud);this.EMd(ud,Rb);ud=this.yac(ud,void 0,this.YKb);this.YKb=
null;ud.extendedProperties.set("SetPolicyLabelDataFailureReason",this.NBb);ud.extendedProperties.set("SetPolicyLabelDataParseStatus",Ie.toString());pb.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,ud)};A.prototype.EMd=function(jc,zc){zc=void 0===zc?0:zc;this.setPolicyLabel(this.T8);this.FLf(new U);this.qHd(zc,jc,2===jc||8===jc||16===jc,!1)};A.prototype.Ktj=function(jc,zc){this.setPolicyLabel(this.T8=jc);if(""===jc)Oa.AFrameworkApplication.protectedFile=!1,Oa.AFrameworkApplication.enableMacrosForProtectedFile=
!1;else for(var Md=Cl(this.Kn.SensitivityLabels),Ce=Md.next();!Ce.done;Ce=Md.next())if(Ce=Ce.value,Ce.Id===jc){Oa.AFrameworkApplication.protectedFile=Ce.IsEndpointProtectionEnabled;break}this.a5i(new Z(jc,zc))};A.prototype.JSj=function(){for(var jc=Cl(this.Kn.SensitivityLabels),zc=jc.next();!zc.done;zc=jc.next())(zc=zc.value)&&zc.Enabled&&(zc.Id===this.T8&&(this.B$d=this.XCa!==zc.Order,this.XCa=zc.Order),zc.Order>this.BKc&&(this.BKc=zc.Order))};A.prototype.MXi=function(jc){var zc=dc.d(jc);jc=zc.ev;
if(!zc.returnValue)return ra.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!jc)return ra.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),!1;if(!jc.AreLabelsAvailable)return!1;this.Kn=jc;this.T8=jc.AppliedPolicyId;this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.JSj();this.Bha()&&ra.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");
this.FLf(new U(!0));return!0};A.prototype.Ese=function(){if(!this.Bha())return ra.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(var jc=Cl(this.Kn.SensitivityLabels),zc=jc.next();!zc.done;zc=jc.next())if((zc=zc.value)&&zc.AutoLabelingSensitiveTypeIds&&0<zc.AutoLabelingSensitiveTypeIds.length)return!0;ra.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1};
A.prototype.FLf=function(jc){ra.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.Za.raiseEvent("LabelInfoUpdateEvent",jc)};A.prototype.w4i=function(jc){ra.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.Za.raiseEvent("GetPolicyLabelEventKey",jc)};A.prototype.zrc=function(){va.WQa(!1);this.Za.raiseEvent("GetPolicyLabelFailureEventKey",new aa)};A.prototype.gHd=function(jc){var zc=this;this.wP&&this.wP.execute(function(Md){Md=[Md.isFeatureEnabled("MsoClpSpTwo",
!0),Md.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(Md).then(function(Ce){Gb.a.any(Ce,function(ae){return ae})&&(ra.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),zc.Za.raiseEvent("GetAutoPolicyLabelEventKey",jc),rb.a("MipAutoClassificationEnabled"));return null})})};A.prototype.Zed=function(jc,zc){jc=void 0===jc?null:jc;zc=void 0===zc?null:zc;var Md=new Map;Md.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=jc&&Md.set("ApplyLabelFlags",La[jc]);
null!=zc&&Md.set("GetPolicyLabelsReason",K[zc]);return Md};A.prototype.yac=function(jc,zc,Md){jc=void 0===jc?null:jc;zc=void 0===zc?null:zc;Md=void 0===Md?null:Md;var Ce=new Wd.a;Ce.extendedProperties=this.Zed(jc,zc);null!=Md&&(Ce.durationMs=this.Iw()-Md);return Ce};A.prototype.a5i=function(jc){ra.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.Za.raiseEvent("SetPolicyLabelEventKey",jc)};A.prototype.qLf=function(jc){ra.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");
jc&&jc.pAb&&rb.a("MipRecommendations");this.Za.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",jc)};A.prototype.SLf=function(jc){ra.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.Za.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",jc)};A.prototype.a4i=function(jc){ra.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");this.Za.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",jc)};A.prototype.V4i=
function(jc){ra.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");this.Za.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",jc)};A.prototype.KBj=function(jc,zc){zc=void 0===zc?null:zc;ra.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.Za.raiseEvent("PolicyTipEvent",new H(CommonUIStrings.l_PolicyBusinessBarTitle,jc,CommonUIStrings.l_PolicyOverrideButton,zc))};A.prototype.qHd=function(jc,zc,Md,Ce){var ae=this;ra.ULS.sendTraceTag(42074656,
306,void 0===Ce||Ce?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",zc);if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)){Ce=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;var ud=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,Rb=null,Ie=null;switch(jc){case 1:Ce=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;ud=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;
break;case 2:Ce=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;ud=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 3:Ce=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;ud=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;break;case 4:Ce=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;ud=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;
break;case 5:Ce=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,ud=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,Rb=CommonUIStrings.l_LearnMore,Ie=function(){ae.u0f()}}jc=new ea(jc,zc,Md,Ce,ud,Rb,Ie)}else jc=5===jc?new ea(jc,zc,Md,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,CommonUIStrings.l_LearnMore,
function(){ae.u0f()}):new ea(jc,zc,Md);this.Za.raiseEvent("SetPolicyLabelFailureEventKey",jc)};A.prototype.Zrj=function(jc){this.yNc=jc};A.prototype.QJi=function(){this.YHc?(ra.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),nd.a.MV(this.YHc)):ra.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")};A.prototype.Bni=function(jc){if(!jc.startsWith("<")||-1===jc.indexOf("Error")&&-1===jc.indexOf("Unavailable"))return!1;ra.ULS.sendTraceTag(25565189,
306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");return!0};A.prototype.THf=function(){this.BVb&&(this.BVb.stop(),this.BVb=null)};A.prototype.dJh=function(jc){if(!jc)return"manual";switch(jc.aQ){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";default:return"manual"}};A.prototype.kKh=function(jc){if(!jc)return"privileged";
jc=jc.aQ;var zc="privileged";if(4===jc||1===jc)zc="standard";return zc};A.prototype.qbc=function(jc,zc,Md,Ce,ae){Md=void 0===Md?null:Md;Ce=void 0===Ce?!1:Ce;ae=void 0===ae?0:ae;this.vb.ra("WacLabelingGetPolicyLabelsIsEnabled")&&(this.T8=jc,this.Ipa=Md,this.Eh&&(this.XDa=this.Eh.Hc("WebServiceCall","Call Get Policy Endpoint On Server")),Md={},Md[qd.a.WKg]=jc,this.vb.ra("SendHostAttributionInfoForPolicyLabelEnabled")?(jc=new T(this.H4a("getpolicylabels",Ce),1,null,Md,!0,2,ae,void 0,void 0,void 0,void 0,
void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,zc),this.Wg.send(jc).HId(Object(Na.a)(this,this.Ryf,"onGetPolicyLabelsSuccessCallback"),Object(Na.a)(this,this.Qyf,"onGetPolicyLabelsFailureCallback"))):this.Wg.hm(this.H4a("getpolicylabels",Ce),1,null,Md,!0,2,Object(Na.a)(this,this.Ryf,"onGetPolicyLabelsSuccessCallback"),Object(Na.a)(this,this.Qyf,"onGetPolicyLabelsFailureCallback"),ae,void 0,void 0,void 0,void 0,"22"),this.njb++,ra.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",
this.njb))};A.prototype.Lsj=function(jc,zc,Md,Ce){Ce=void 0===Ce?null:Ce;if(this.Uyb){this.Eh&&(this.oFa=this.Eh.Hc("WebServiceCall","Call Set Policy Endpoint On Server"));var ae={};ae[qd.a.NXf]=jc;zc&&(ae[qd.a.t0f]=encodeURIComponent(zc));this.yNc&&(ae[qd.a.oKg]=this.yNc);Ce?(ae[qd.a.q0f]=this.dJh(Ce),ae[qd.a.r0f]=this.kKh(Ce)):(ae[qd.a.q0f]="manual",ae[qd.a.r0f]="privileged");this.supportsOfficeClientCoauthoring&&this.Kn&&(ae[qd.a.HZi]=this.Kn.PolicyLabelVersionToken);this.vb.ra("SendHostAttributionInfoForPolicyLabelEnabled")?
(jc=new T(this.H4a("setpolicylabel",!0),1,null,ae,!0,2,Ce,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Md),this.Wg.send(jc).HId(Object(Na.a)(this,this.DDf,"onSetPolicyLabelSuccessCallback"),Object(Na.a)(this,this.CDf,"onSetPolicyLabelFailureCallback"))):this.Wg.hm(this.H4a("setpolicylabel",!0),1,null,ae,!0,2,Object(Na.a)(this,this.DDf,"onSetPolicyLabelSuccessCallback"),Object(Na.a)(this,this.CDf,"onSetPolicyLabelFailureCallback"),Ce,void 0,void 0,void 0,void 0,
"32");this.Ira++;ra.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.Ira)}else ra.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")};A.prototype.u0f=function(){var jc=new Ob.StandardDialog,zc=this.vb.Va("BreadcrumbFolderUrl");zc?(jc.jc=11,jc.Bc(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),jc.Bc(2,CommonUIStrings.l_DialogOk)):(jc.jc=
0,jc.Bc(1,CommonUIStrings.l_DialogOk));jc.Kme(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");jc.naj();jc.OX(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,function(Md){1===Md&&zc&&nd.a.rf(zc,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})};A.prototype.q4c=function(jc){switch(jc){case 1:return Oc.a.Dia(1,
1);case 2:return Oc.a.Dia(7,1);case 3:return Oc.a.Dia(8,1);default:return Oc.a.Dia(7,0)}};A.prototype.H7g=function(jc){jc=void 0===jc?null:jc;if(!jc)return Oc.a.Dia(8,0);switch(jc.aQ){case 1:case 16:return Oc.a.Dia(1,1);case 4:case 2:case 8:return Oc.a.Dia(8,1);default:return Oc.a.Dia(8,0)}};A.prototype.bLd=function(jc){this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)&&appChrome.api.setAsyncRequestStatus("sensitivity",jc)};Ck.Object.defineProperties(A.prototype,
{bod:{configurable:!0,enumerable:!0,get:function(){return this.nLc}},ipd:{configurable:!0,enumerable:!0,get:function(){if(!this.P6d)return!1;for(var jc=Cl(this.P6d.N_j()),zc=jc.next();!zc.done;zc=jc.next())if(zc=zc.value,!zc.Capabilities||!zc.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}},ani:{configurable:!0,enumerable:!0,get:function(){return!!this.jFa}}});Object(ta.a)(A,"PolicyManager",null,[587]);var rc=b(140),gd=b(255);C.prototype.init=function(){var jc=this;Oa.AFrameworkApplication.ga.ra("ShouldInitCommonPolicyPackage")&&
(Oa.AFrameworkApplication.ga.ra("IsDataLossPreventionEnabledForUser")&&Oa.AFrameworkApplication.sa&&(this.Xg=this.tb.resolve("Common.App.Policy.Contracts.IPolicyManager"),this.Xg.Xoe(Object(Na.a)(this,this.fTd,"showPolicyBusinessBar")),ra.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),rc.a.get_instance().Lk(6,function(){jc.Xg.rbc()})),Oa.AFrameworkApplication.ga.ra("WacLabelingPoliciesIsEnabled")&&Oa.AFrameworkApplication.ga.ra("SupportsPolicies")?rc.a.get_instance().Lk(6,
Object(Na.a)(this,this.$Gi,"onAfterRibbonBehaviorAttached")):va.WQa(!1))};C.prototype.dispose=function(){};C.prototype.fi=function(jc){jc.register(587,"Common.App.Policy.Contracts.IPolicyManager").Ic().Oc(function(){return new A(Oa.AFrameworkApplication.ga,Oa.AFrameworkApplication.Jd,Oa.AFrameworkApplication.sa.MD,Oa.AFrameworkApplication.ga.Cd("MaxGetPolicyRetries",1),jc.lc("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),Oa.AFrameworkApplication.sa.Pa.Sj)});jc.register(va,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").Ic().Oc(function(){return new va(Oa.AFrameworkApplication.Ib,
Oa.AFrameworkApplication.sa,Oa.AFrameworkApplication.ga,jc.iMd("Common.App.Policy.Contracts.IPolicyManager"))});this.tb=jc};C.prototype.$Gi=function(){this.Y1=this.tb.Lh("CommonUI.BusinessBar");this.Xg||(this.Xg=this.tb.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.ora=this.tb.resolve("Common.App.Policy.PolicyActor");Oa.AFrameworkApplication.ga&&Oa.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&yd.a("isSharedUxGateEnabled")&&
appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?this.Xg.MZb(Object(Na.a)(this.ora,this.ora.IOf,"registerActionsHandler")):this.ora.Og();this.Xg.MZb(Object(Na.a)(this,this.uZd,"updateLabelInfo"));Oa.AFrameworkApplication.ga.ra("WacApplyManualPolicyLabelIsEnabled")&&(this.Xg.lWc(Object(Na.a)(this,this.w5h,"handleSetPolicyLabelFailure")),this.Xg.Pne(Object(Na.a)(this,this.$Yb,"addAutoPolicyBusinessBarEntry")),this.Xg.$oe(Object(Na.a)(this,this.Fda,"removeAutoPolicyBusinessBarEntry")),
this.Xg.Qne(Object(Na.a)(this,this.fVc,"addMandatoryLabellingBusinessBarEntry")),this.Xg.ape(Object(Na.a)(this,this.CJd,"removeMandatoryLabellingBusinessBarEntry")))};C.prototype.uZd=function(){this.ora.m0f();this.ora.D_f();this.ora.UKf();var jc=this.Xg.EXg();Oa.AFrameworkApplication.ga.ra("HasDocumentEditRights")&&!jc?this.ora.vag():ra.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",Oa.AFrameworkApplication.ga.ra("HasDocumentEditRights"),
jc);Oa.AFrameworkApplication.sa.updateCommandUI()};C.prototype.fTd=function(jc,zc){this.o2e(zc.title,zc.qqc,38,zc.vvf,zc.buttonText);ra.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")};C.prototype.w5h=function(jc,zc){if(zc.z4f){jc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;var Md=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,Ce=null,ae=null;Oa.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",
!1)?(jc=zc.title,Md=zc.message,Ce=zc.buttonText,ae=zc.mZ):1===zc.errorType?(jc=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle,Md=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage):2===zc.errorType?(jc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle,Md=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage):Oa.AFrameworkApplication.ga.ra("ClpLabelDisabledErrorCodeIsEnabled")&&3===zc.errorType?
(jc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle,Md=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage):4===zc.errorType?(jc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle,Md=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage):5===zc.errorType&&(jc=zc.title,Md=zc.message,Ce=zc.buttonText,ae=zc.mZ);this.o2e(jc,Md,21,null,null,ae,Ce);ra.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user.")}};
C.prototype.Fda=function(){};C.prototype.$Yb=function(jc,zc){this.Y1&&(this.Xg.Fda(zc.Lpb),jc=new gb.a(zc.title,zc.message,null),jc.id=zc.Lpb,jc.closeable=!0,jc.image=3,jc.addButton(zc.buttonText,zc.mZ,zc.buttonText,!0),this.Y1.oE(jc,!1))};C.prototype.fVc=function(jc,zc){this.Y1&&(jc=new gb.a(zc.title,zc.message,null),jc.id=zc.Lpb,jc.closeable=!1,jc.image=3,jc.addButton(zc.buttonText,zc.mZ,zc.buttonText,!1),this.Y1.oE(jc,!1))};C.prototype.CJd=function(){};C.prototype.o2e=function(jc,zc,Md,Ce,ae,ud,
Rb){Ce=void 0===Ce?null:Ce;ae=void 0===ae?null:ae;ud=void 0===ud?null:ud;Rb=void 0===Rb?null:Rb;jc=new gb.a(jc,zc,null);jc.id=Md;jc.closeable=!0;Ce&&jc.fCg(ae,Ce);ud&&jc.addButton(Rb,ud,Rb)};C.main=function(){gd.a.instance.hj(new C)};Ck.Object.defineProperties(C.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.Policy"}}});Object(ta.a)(C,"PackageManager",null,[4,5]);var kd=b(11),Qc=b(614),de=b(226),Xe=b(51),ge=b(36),fc=b(83),dd=b(38),oc=b(327),Zb=b(387),Sc=b(175),sd=
b(95),fd=b(30),qc=b(293),vb=b(1),Pd=b(22),Tc=b(292);Object(ta.a)(v,"ApplyPolicyContextParameters",null,[]);var Ve=b(7),kf=b(903),of=b(625),vf=b(47),ne=b(44);Object(ta.a)(B,"AnnotationActivationOptions",null,[]);var Ad=b(84),Xd=b(931),ee=b(908),Le=Xd.a;Am(x,Le);x.getTypeName=function(){return"AugLoop_SecurityClp_LabellingAnnotation"};x.ye=function(){return["AugLoop_Core_Annotation"]};Object(ta.a)(x,"LabellingAnnotation",Xd.a,[]);var Jf=b(932),$f=Jf.a;Am(r,$f);r.getTypeName=function(){return"AugLoop_SecurityShared_SecurityShared"};
r.ye=function(){return[]};Object(ta.a)(r,"SecurityShared",Jf.a,[]);Am(y,r);y.getTypeName=function(){return"AugLoop_SecurityShared_CLP"};y.ye=function(){return["AugLoop_SecurityShared_SecurityShared"]};Object(ta.a)(y,"CLP",r,[]);var Dc=Xd.a;Am(h,Dc);h.getTypeName=function(){return"AugLoop_Automatic_Clp_LabellingAnnotation"};h.ye=function(){return["AugLoop_Core_Annotation"]};Object(ta.a)(h,"LabellingAnnotation",Xd.a,[]);var Sd=b(1188),te=b(1080),rd=b(1190),Ue=Xd.a;Am(w,Ue);w.getTypeName=function(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"};
w.ye=function(){return["AugLoop_Core_Annotation"]};Object(ta.a)(w,"LinkedDataTypeAnnotation",Xd.a,[]);var ef=dd.a;Am(n,ef);n.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.heh(),this.lIe(),this.LEd=this.policyManager=this.augmentationLoopManager=null,ef.prototype.dispose.call(this))};n.prototype.JZa=function(jc,zc,Md,Ce,ae){ae=void 0===ae?!1:ae;ra.ULS.sendTraceTag(537154642,306,50,"AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource {0} with AutoLabelPresent: {1}, RecommendedLabelPresent: {2}, isStandard: {3}.",
Ce,!!jc,!!zc,ae);this.sc?this.LEd&&(this.jVg(zc,Ce)?(this.cGd=zc,this.YFd=Ce,this.Fkf.ia(Ce,zc)):zc=this.cGd,jc=this.LEd.JZa(jc,zc,Md,ae),ra.ULS.sendTraceTag(537154640,306,50,"AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned {0}.",jc)):ra.ULS.sendTraceTag(537154641,306,15,"AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.ea.sc)};n.prototype.jVg=function(jc,zc){if(!this.policyManager.Bha())return ra.ULS.sendTraceTag(537154639,
306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),!1;var Md=this.policyManager.Kn;var Ce=this.Fkf.Nc(this.YFd).value;var ae=null,ud=null,Rb=null;Md=Cl(Md.SensitivityLabels);for(var Ie=Md.next();!Ie.done;Ie=Md.next())Ie=Ie.value,Ie.Id===jc&&(ae=Ie),Ie.Id===Ce&&(ud=Ie),Ie.Id===this.cGd&&(Rb=Ie);return ud&&ud.Id===jc?(ra.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),
!1):this.businessBar.vC(39)&&this.YFd!==zc&&Rb&&(!ae||Rb.Order>=ae.Order)?(ra.ULS.sendTraceTag(537154637,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),!1):!0};n.prototype.Ynd=function(){return vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)};n.prototype.B8i=function(){this.policyManager.Pne(this.L3f);this.policyManager.$oe(this.DPf);this.$.ea.g3(this.J6);
this.Ynd()&&(this.policyManager.dFg(this.K4b),this.policyManager.XHg(this.Tcg),this.policyManager.YHg(this.Ucg))};n.prototype.heh=function(){this.businessBar.removeEntry(39);this.businessBar.removeEntry(38);this.policyManager.bbj(this.L3f);this.policyManager.zdj(this.DPf);this.$.ea.Q0(this.J6);vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&(this.policyManager.Mbj(this.K4b),this.policyManager.dej(this.Tcg),this.policyManager.eej(this.Ucg))};n.prototype.p$h=
function(){this.VA=new kf.a(of.a.oK());var jc=this.Ynd()?x.getTypeName():h.getTypeName();this.VA.add(1,Object(Ve.a)(new B,{annotationType:jc,EZa:this.tri,xF:!1,lMa:!1}));this.VA.add(2,Object(Ve.a)(new B,{annotationType:w.getTypeName(),EZa:this.mti,xF:!1,lMa:!1}))};n.prototype.Y7f=function(){for(var jc=Cl(this.N$a),zc=jc.next();!zc.done;zc=jc.next())this.augmentationLoopManager.submitOperation(zc.value);this.N$a=[]};n.prototype.w8i=function(jc){if(!this.VA.xb(jc))return ra.ULS.sendTraceTag(537154636,
306,15,"AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource {0}.",jc),!1;if(this.VA.oa(jc).xF)return ra.ULS.sendTraceTag(537154635,306,15,"AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource {0}.",jc),!0;this.VA.oa(jc).xF=!0;ra.ULS.sendTraceTag(537154634,306,50,"AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource {0}.",jc);if(!this.$.isEditMode)return ra.ULS.sendTraceTag(537154633,
306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.tyb():this.iaf();return!0};n.prototype.iaf=function(){for(var jc=this,zc=!1,Md=Cl(this.VA),Ce=Md.next();!Ce.done&&!(zc=Ce.value.value.xF||zc);Ce=Md.next());zc?this.augmentationLoopManager?(ra.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),
this.zYb()):this.e_a?ra.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):(this.e_a=!0,zc=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,ra.ULS.sendTraceTag(537154629,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in {0} milliseconds.",zc),vf.a.instance.create(function(){jc.r$h()},zc,ne.a.Yte,!0,!0)):ra.ULS.sendTraceTag(537154632,
306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")};n.prototype.tyb=function(){var jc=this,zc=0<this.N$a.length;if(!zc)for(var Md=Cl(this.VA),Ce=Md.next();!Ce.done&&!(zc=Ce.value.value.xF||zc);Ce=Md.next());zc?this.augmentationLoopManager?(ra.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.zYb(),this.Y7f()):this.e_a?ra.ULS.sendTraceTag(537154626,306,50,
"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):(this.e_a=!0,zc=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,ra.ULS.sendTraceTag(537154625,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in {0} milliseconds.",zc),vf.a.instance.create(function(){jc.s$h()},zc,ne.a.Yte,!0,!0)):ra.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")};
n.prototype.s$h=function(){var jc=this;ge.TaskExtensions.Ba(Xe.GetServiceTaskFactory.Ua(this.$.da,328,327,1),function(zc){jc.augmentationLoopManager=zc.result;jc.e_a=!1;jc.augmentationLoopManager?(ra.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),jc.augmentationLoopManager.RUc(jc.$mc),jc.$.isEditMode?(jc.zYb(),jc.Y7f()):ra.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):
ra.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.la,3)};n.prototype.r$h=function(){var jc=this;ge.TaskExtensions.Ba(Xe.GetServiceTaskFactory.Ua(this.$.da,328,327,1),function(zc){jc.augmentationLoopManager=zc.result;jc.e_a=!1;jc.augmentationLoopManager?(ra.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),jc.augmentationLoopManager.RUc(jc.$mc),jc.$.isEditMode?
jc.zYb():ra.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):ra.ULS.sendTraceTag(537154593,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.la,3)};n.prototype.lIe=function(){for(var jc=Cl(this.VA),zc=jc.next();!zc.done;zc=jc.next())zc=zc.value,zc.value.xF&&this.geh(zc.key)};n.prototype.geh=function(jc){this.VA.oa(jc).lMa&&this.iHe(jc);this.VA.oa(jc).xF=!1;ra.ULS.sendTraceTag(537154591,
306,50,"AutoPolicyManager::DeregisterAnnotation completed for LabellingSource {0}.",jc)};n.prototype.zYb=function(){for(var jc=Cl(this.VA),zc=jc.next();!zc.done;zc=jc.next())zc=zc.value,zc.value.xF&&!zc.value.lMa&&this.activateAnnotation(zc.key)};n.prototype.activateAnnotation=function(jc){this.augmentationLoopManager.activateAnnotation(this.VA.oa(jc).annotationType);this.augmentationLoopManager.CJ(this.VA.oa(jc).annotationType,this.VA.oa(jc).EZa);this.VA.oa(jc).lMa=!0;ra.ULS.sendTraceTag(537154590,
306,50,"AutoPolicyManager::ActivateAnnotation completed for LabellingSource {0}.",jc)};n.prototype.xch=function(){for(var jc=Cl(this.VA),zc=jc.next();!zc.done;zc=jc.next())zc=zc.value,zc.value.lMa&&this.iHe(zc.key)};n.prototype.iHe=function(jc){this.augmentationLoopManager.hAa(this.VA.oa(jc).annotationType,this.VA.oa(jc).EZa);this.VA.oa(jc).lMa=!1;ra.ULS.sendTraceTag(537154589,306,50,"AutoPolicyManager::DeactivateAnnotation completed for LabellingSource {0}.",jc)};n.prototype.applyPolicyLabel=function(jc,
zc,Md,Ce){var ae=this;if(this.ga.ra("SupportsOfficeClientCoauthoring"))ra.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),this.JZa(jc,zc,Md,Ce);else{ra.ULS.sendTraceTag(537154578,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");var ud=function(Rb){ae.JZa(jc,zc,Md,Ce,0===Rb||1===Rb||4===Rb)};this.Qgd(ud,function(){ud(2)},this.dqf)}};n.prototype.kYc=function(jc,zc){var Md=this.ebg(jc);
jc=Md.sensitivityLabel;var Ce=Md.IGa;if(!Md.returnValue)return ra.ULS.sendTraceTag(537154577,306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(Ce&&Ce.Order>=jc.Order)return ra.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1;this.applyPolicyLabel(jc.Id,jc.Id,null,zc);return!0};n.prototype.lYc=function(jc,zc){var Md=this;zc=!1;var Ce=null,ae=null;if(!function(){var Ie=Md.ebg(jc);Ce=Ie.sensitivityLabel;
ae=Ie.IGa;return Ie}().returnValue)return ra.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),{returnValue:!1,JMa:zc};if(ae&&ae.ParentId&&Ce.ParentId&&ae.ParentId===Ce.ParentId)return ra.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,JMa:zc};if(ae&&ae.Order>=Ce.Order)return ra.ULS.sendTraceTag(537154573,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),
{returnValue:!1,JMa:zc};if(this.ga.ra("SupportsOfficeClientCoauthoring")){ra.ULS.sendTraceTag(537154572,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled.");var ud=this.policyManager.Kn;ud=!ud.AppliedPolicyId||!ud.PolicyLabelAssignmentMethod||xb.c(ud.PolicyLabelAssignmentMethod)===xb.c("standard");this.zse(Ce.Id,ud)}else{ra.ULS.sendTraceTag(537154571,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");
var Rb=function(Ie){Md.zse(Ce.Id,0===Ie||1===Ie||4===Ie)};this.Qgd(Rb,function(){Rb(2)},this.dqf)}return{returnValue:!0,JMa:zc}};n.prototype.Qgd=function(jc,zc,Md,Ce){var ae=this;Ce=void 0===Ce?0:Ce;if(this.sc){var ud=this.$.na.va.hc();t(this.$.na.va,this.$.ya.DocumentHostInfo.TenantId,function(Rb){ae.SVh(Rb,jc)},function(){ae.RVh(jc,zc,Md,Ce)},null,null,ud)}else ra.ULS.sendTraceTag(537154570,306,15,"AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: {0}, IsSessionActive: {1}.",
this.disposed,this.$.ea.sc)};n.prototype.SVh=function(jc,zc){ra.ULS.sendTraceTag(537154569,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.sc?!jc||qc.a(jc)?ra.ULS.sendTraceTag(537154567,306,15,jc?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):zc(jc.Result):ra.ULS.sendTraceTag(537154568,306,50,"AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: {0}, IsSessionActive: {1}.",
this.disposed,this.$.ea.sc)};n.prototype.RVh=function(jc,zc,Md,Ce){ra.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");this.sc?Ce>=Md?(ra.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),zc()):this.Qgd(jc,zc,Md,Ce+1):ra.ULS.sendTraceTag(537154565,306,50,"AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: {0}, IsSessionActive: {1}.",
this.disposed,this.$.ea.sc)};n.prototype.zse=function(jc,zc){zc?this.JZa(jc,null,null,3,!0):this.JZa(null,jc,null,3,!1)};n.prototype.ebg=function(jc){var zc;var Md=zc=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:zc,IGa:Md};if(!this.policyManager.Bha())return ra.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:zc,IGa:Md};var Ce=this.policyManager.Kn;if(!Ce)return ra.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),
{returnValue:!1,sensitivityLabel:zc,IGa:Md};if(Gb.a.Gh(Ce.SensitivityLabels))return ra.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),{returnValue:!1,sensitivityLabel:zc,IGa:Md};var ae=Ce.AppliedPolicyId;jc=Cl(jc);for(var ud=jc.next();!ud.done;ud=jc.next()){ud=ud.value;for(var Rb=Cl(Ce.SensitivityLabels),Ie=Rb.next();!Ie.done;Ie=Rb.next())Ie=Ie.value,Ie.Id===ud&&(!zc||zc.Order<Ie.Order)&&(zc=Ie),Ie.Id===
ae&&(Md=Ie)}return zc?{returnValue:!0,sensitivityLabel:zc,IGa:Md}:(ra.ULS.sendTraceTag(537154526,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),{returnValue:!1,sensitivityLabel:zc,IGa:Md})};Ck.Object.defineProperties(n.prototype,{sc:{configurable:!0,enumerable:!0,get:function(){return!this.disposed&&this.$.ea.sc}}});Object(ta.a)(n,"AutoPolicyManager",dd.a,[2]);var pe=b(158),Ne=b(12),gg=b(15),ie=pe.ErrorDialog;Am(m,ie);m.prototype.um=function(){var jc=this;ie.prototype.um.call(this);
if(this.error.Appearance&1&&this.$.Pd&2){var zc=this.getButton(0);Ne.DOMElementExtensions.vPd(zc.get_element(),gg.a.instance.fa(1282));this.YP(function(){0===jc.returnValue&&jc.$.Pd&2&&(ra.ULS.sendTraceTag(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),ge.TaskExtensions.Ba(Xe.GetServiceTaskFactory.Ua(jc.$.da,55,56,0),function(Md){Md.result.g3c()},jc.$.la,3))})}};m.jR=function(jc){return jc.Pd&2?fd.a.gd(3,1,0,1925,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):
fd.a.gd(1,1,0,1926,0,-313914360,"SensitivityLabelBlockApplyLabel")};Object(ta.a)(m,"BlockSenitivityLabelActionDialog",pe.ErrorDialog,[]);var Re=dd.a;Am(f,Re);f.prototype.initialize=function(){var jc=this;this.ga.ra("SupportsPolicies")?(this.sEa=this.ga.Va("AppliedPolicyId"),this.f7.Og(),this.$.da.$a(29,function(zc){jc.statusBarManager=zc;zc.EJ(jc)}),this.Qz(),Pd.a.Gh(this.ga.Va("HostUserId"))||this.IZi(),this.f7.D8i(this.hPg),this.f7.v9i(this.ifi),this.Br.z8i(this.ipd),this.Ao=vb.EwaSettings.getBooleanFeatureGate(oc.a.fQa,
!1)):vb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&yd.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!0));!Pd.a.Gh(this.ga.Va("HostUserId"))&&vb.EwaSettings.ma(170)&&this.$.ea.Zg.get(45)&&(ra.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.UOh())};f.prototype.Aq=function(jc){this.addHandler("LabelInfoChangedKey",jc)};f.prototype.Xq=function(jc){this.removeHandler("LabelInfoChangedKey",
jc)};f.prototype.xn=function(){return!0};f.prototype.fs=function(jc,zc){if("QueryPolicyLabel"!==jc)return!1;if(this.ySa())return zc.Visible=!1,!0;zc.Visible=!0;return 32===Oa.AFrameworkApplication.Ib.Be(Fb.a.Xab,2,zc)};f.prototype.dispose=function(){this.statusBarManager&&(this.statusBarManager.ZF(this),this.statusBarManager=null);this.f7.iOb();this.jZc=!1;this.Br.Qdj(this.a5f);this.Br.Rdj(this.BDf);this.$.ea.Gv(this.ska);if(this.ga.ra("SupportsOfficeClientCoauthoring")){var jc=this.$.da.Aa(292);
jc&&jc.Dcj(this.Vzf)}this.Br.dbj(this.Qme);this.Br.Adj(this.aQf);this.Br.Ncj(this.Spf);this.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",!1)&&this.Br.bej(this.Fbg);vb.EwaSettings.ma(292)&&this.Br.icj(this.VLe);this.G$&&(this.G$.dispose(),this.G$=null);Re.prototype.dispose.call(this)};f.prototype.kYc=function(jc,zc){if(!this.ga.ra("SupportsPolicies"))return ra.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),
!1;if(!this.MEd)return ra.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(Gb.a.Gh(jc))return!1;this.G$||this.rmd();return this.G$.kYc(jc,zc)};f.prototype.Qz=function(){this.raiseEvent("LabelInfoChangedKey")};f.prototype.UOh=function(){var jc=this;vb.EwaSettings.isChangeGateEnabled("OfficeVSO:6000793_RibbonDisplayedDependencyInDataLossPolicyCall")?rc.a.get_instance().Lk(10,function(){jc.Br.rbc()}):this.Br.rbc()};f.prototype.IZi=function(){var jc=
this;rc.a.get_instance().Lk(10,function(){jc.Br.MZb(jc.uZd);jc.Br.IFg(jc.Pyf);jc.Br.HFg(jc.Pyf);jc.Br.lWc(jc.a5f);jc.Br.kpe(jc.BDf);jc.$.ea.Ot(jc.ska);jc.Br.Qne(jc.Qme);jc.Br.ape(jc.aQf);jc.Br.pGg(jc.Spf);jc.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",!1)&&jc.Br.UHg(jc.Fbg);if(jc.ga.ra("SupportsOfficeClientCoauthoring")){var zc=jc.$.da.Aa(292);zc&&zc.gGg(jc.Vzf)}vb.EwaSettings.ma(292)&&(ra.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler"),
jc.Br.FFg(jc.VLe));jc.CAh()});this.$.qdb("sensitivity",!0)};f.prototype.CAh=function(){this.ga.ra("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.h4a():this.dKh(this.$.ya.DocumentHostInfo.TenantId)};f.prototype.rmd=function(){this.G$=new n(this.f7,this.Br,this.$,this.ga,this.xE)};f.prototype.KOf=function(jc){if(!this.ga.ra("SupportsPolicies"))return ra.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),
!1;this.G$||this.rmd();return this.G$.w8i(jc)};f.prototype.lYc=function(jc,zc){if(vb.EwaSettings.isChangeGateEnabled("OfficeVSO:5697254_ApplyPowerBiLabel")){if(!this.ga.ra("SupportsPolicies"))return ra.ULS.sendTraceTag(537154517,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,JMa:!1};if(!this.MEd)return ra.ULS.sendTraceTag(537154516,306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),
{returnValue:!1,JMa:!0};this.G$||this.rmd();return this.G$.lYc(jc,zc)}ra.ULS.sendTraceTag(537154515,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when BRS ApplyPowerBiLabel is disabled.");return{returnValue:!1,JMa:!1}};f.prototype.dKh=function(jc){var zc=this;ra.ULS.sendTraceTag(537154514,306,50,"PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length {0}",jc.length);var Md=this.$.na.va.hc();u(this.$.na.va,jc,function(Ce){zc.nHj(Ce)},null,null,null,
Md)};f.prototype.nHj=function(jc){ra.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");jc&&!qc.a(jc)&&(this.sEa=jc.Result);this.h4a();this.labelId?ra.ULS.sendTraceTag(537154512,306,50,"PolicyManagerWrapper: Fetched LabelId length from custom.xml is {0}",this.labelId.length):ra.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")};f.prototype.h4a=function(){this.Br.Oed(this.labelId,void 0,void 0,!1)};f.prototype.ySe=
function(){if(!this.jZc){this.$.Bf();this.jZc=!0;this.xE.a7e();var jc={};jc.hasLabel=!!this.labelId&&0<this.labelId.length;jc.isProtectedFile=this.ga.ra("ProtectedFile");jc.SupportsPolicies=this.ga.ra("SupportsPolicies");jc.AreLabelsAvailableForDisplay=this.Br.Bha();jc.SupportsOfficeClientCoauthoring=this.ga.ra("SupportsOfficeClientCoauthoring");jc.IsAnonymousUser=this.ga.ra("IsAnonymousUser");ra.ULS.sendTraceTag(51238051,306,50,"CLPUsage : {0}",JSON.stringify(jc))}};f.prototype.fLg=function(){this.f7.gLg(this.oya);
this.oya=null};f.prototype.U6h=function(jc){jc=Cl(jc.LabelActions);for(var zc=jc.next();!zc.done;zc=jc.next())if(Pd.a.equals(zc.value.Name,"ApplyWatermark",!1))return!0;return!1};f.prototype.Szj=function(jc){jc?(new m(this.$)).kf():ra.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")};f.prototype.applyPolicyLabel=function(jc,zc,Md,Ce){var ae=this,ud=dc.c(this.Br.Kn);if(void 0===jc||null===
jc)jc="";var Rb=new v;Rb.pqc=jc;Rb.BYf=Ce;Rb.aQ=zc;var Ie=this.$.na.va;Zb.a(this.$.userOperationManager,function(pa,qb,Sb){qb=jc;var $b=ae.$.ya.DocumentHostInfo.TenantId;pa=Tc.b.call(null,ae.jHi,pa);var tc=Ie.Na(41,null);tc.labelsInfoJson=ud;tc.appliedLabelId=qb;tc.tenantId=$b;tc.applyLabelFlag=zc;tc.skipApplyOutcomes=Md;return Ad.i(Ie,"ApplyPolicyLabel",tc,pa,null,Sb,Rb,0)},function(pa){return new Sc.a(222,0,pa)},null);this.ICc=!1;this.POd=null};f.prototype.ySa=function(){var jc=this.$.da.Aa(478);
return this.Ao&&jc?jc.Ao():!1};Ck.Object.defineProperties(f.prototype,{title:{configurable:!0,enumerable:!0,get:function(){return this.Tp}},qqc:{configurable:!0,enumerable:!0,get:function(){return this.Ree}},linkText:{configurable:!0,enumerable:!0,get:function(){return this.jga}},XOi:{configurable:!0,enumerable:!0,get:function(){return this.Kde}},labelId:{configurable:!0,enumerable:!0,get:function(){return this.sEa}}});Object(ta.a)(f,"PolicyManagerWrapper",dd.a,[543,373,729]);var Ig=de.a;Am(e,Ig);
e.prototype.create=function(){var jc=this,zc=Xe.GetServiceTaskFactory.Ua(this.$.da,5,4,this.ub),Md=Oa.AFrameworkApplication.Jd,Ce=Oa.AFrameworkApplication.ga;ge.TaskExtensions.Ba(zc,function(){try{var ae=new Qc.a(function(){return new A(Ce,Md,Oa.AFrameworkApplication.sa.MD,jc.$.ya.MaxGetPolicyRetries,Tb.a.instance.lc("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))}),ud=new Qc.a(function(){return new va(Oa.AFrameworkApplication.Ib,Oa.AFrameworkApplication.sa,Oa.AFrameworkApplication.ga,
ae)}),Rb=jc.$.da.Aa(274);Rb||(Rb=new f(ae.value,ud.value,zc.result,jc.$,Oa.AFrameworkApplication.ga),Rb.initialize());jc.Eb(Rb)}catch(Ie){throw ra.ULS.sendTraceTag(537154525,306,10,"PolicyManager was not created successfully [Exception: {0}]",Ie.toString()),Ie;}},this.la,3)};e.ka=function(jc){jc.da.Ga(275,new e(jc))};Object(ta.a)(e,"PolicyManagerFactory",de.a,[]);var Lf=b(904),qf=b(186);c.prototype.$c=function(){return!1};c.prototype.executeCommand=function(jc,zc,Md){switch(zc.command){case Fb.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||
(Md[qa.bXc]=this.$.workbookContext.ExclusiveLockId),jc=Oa.AFrameworkApplication.Ib.Be(Fb.a.setSensitivity,2,Md),hc.Task.Ra(32===jc);case Fb.a.m7:return jc=Oa.AFrameworkApplication.Ib.Be(Fb.a.m7,2,Md),hc.Task.Ra(32===jc);case Fb.a.n7:return jc=Oa.AFrameworkApplication.Ib.Be(Fb.a.n7,2,Md),hc.Task.Ra(32===jc);default:return qf.a(zc.command)}};c.prototype.Kc=function(jc,zc){switch(zc.command){case Fb.a.setSensitivity:case Fb.a.m7:case Fb.a.n7:return!0;default:return!1}};c.prototype.jd=function(jc,zc,
Md){switch(zc){case "PopulateSensitivityFlyout":return 32===Oa.AFrameworkApplication.Ib.Be(Fb.a.Eza,2,Md);default:return!1}};Object(ta.a)(c,"SensitivityCommandHandler",null,[424]);var vg=Lf.a;Am(a,vg);a.prototype.Nd=function(){this.Dd([new c(this.$)])};a.ka=function(jc){Lf.a.he(316,new a(jc))};Object(ta.a)(a,"SensitivityCommandHandlerFactory",Lf.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.Policy.Contracts");Type.registerNamespace("Common.App.Policy");C.main();(function(){kd.a.Fa(function(jc){e.ka(jc);
a.ka(jc)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.policy.js.map/f9d978a4a54baadeae12d801404d2fdf/EwaDS.policy.js.map