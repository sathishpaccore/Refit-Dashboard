(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[15],{1002:function(z,E,b){function a(){}b.d(E,"a",function(){return a});z=b(0);a.abs="Abs";a.rel="Rel";Object(z.a)(a,"PositionBaseType",null,[])},1013:function(z,E,b){function a(T){this.calcManager=T}function c(){return y.call(this)||this}function e(){this.yvc=this.firstRow=null;return this}function f(){return y.call(this)||this}function m(){this.right=this.left=this.bottom=this.top=null;return this}function n(){return y.call(this)||
this}function w(){this.xvc=this.firstColumn=null;return this}function h(){var T=y.call(this)||this;T.$hc=!1;return T}function y(){this.end=this.start=0;this.Dv=null}function r(){this.column=this.row=null;return this}function x(){}b.r(E);z=b(0);var t=b(7),u=b(14);Object(z.a)(x,"Reference",null,[]);Am(r,x);Object(z.a)(r,"CellReference",x,[]);y.prototype.$Kg=function(T,R){for(var Q=0;Q<this.Dv.length;Q++){var ea=this.Y_b(T,this.Dv[Q]);R+=ea;Q<this.Dv.length-1&&(R+=":")}return R};Object(z.a)(y,"IReferenceSequence",
null,[]);var B=b(25),v=b(1002);Am(h,y);h.prototype.hcc=function(){var T=b(1013).RelativeAndAbsoluteReferencesManager,R=this.Dv[0];return T.Jsf(R.row.kind===v.a.abs,R.column.kind===v.a.abs)};h.prototype.Y_b=function(T,R){R=B.Range.hd(R.row.index+1,R.column.index+1);return this.$hc?R.sbc(1===T||3===T,1===T||2===T):R.N4a(1===T||3===T,1===T||2===T,!0,!0)};Object(z.a)(h,"CellReferenceSequence",y,[]);Am(w,x);Object(z.a)(w,"ColumnReference",x,[]);Am(n,y);n.prototype.hcc=function(){var T=this.Dv[0];return b(1013).RelativeAndAbsoluteReferencesManager.irf(T.firstColumn,
T.xvc).kind===v.a.abs?2:3};n.prototype.Y_b=function(T,R){return B.Range.Zub(R.firstColumn.index+1,R.xvc.index+1).N4a(1===T||3===T,!0,1===T||3===T,!0)};Object(z.a)(n,"ColumnReferenceSequence",y,[]);Am(m,x);Object(z.a)(m,"RangeReference",x,[]);Am(f,y);f.prototype.hcc=function(){var T=b(1013).RelativeAndAbsoluteReferencesManager,R=this.Dv[0];return T.Jsf(R.top.kind===v.a.abs,R.left.kind===v.a.abs)};f.prototype.Y_b=function(T,R){R=new B.Range(R.top.index+1,R.left.index+1,R.bottom.index+1,R.right.index+
1,!1,!1);var Q=1===T||3===T;T=1===T||2===T;return R.N4a(Q,T,Q,T)};Object(z.a)(f,"RangeReferenceSequence",y,[]);Am(e,x);Object(z.a)(e,"RowReference",x,[]);Am(c,y);c.prototype.hcc=function(){var T=this.Dv[0];return b(1013).RelativeAndAbsoluteReferencesManager.irf(T.firstRow,T.yvc).kind===v.a.abs?0:1};c.prototype.Y_b=function(T,R){return B.Range.eac(R.firstRow.index+1,R.yvc.index+1).N4a(!0,1===T||2===T,!0,1===T||2===T)};Object(z.a)(c,"RowReferenceSequence",y,[]);var C=b(1199),A=b(1200),M=b(205);b.d(E,
"RelativeAndAbsoluteReferencesManager",function(){return a});a.prototype.A1a=function(T,R,Q){var ea=R;var Z=Q;if(!T||!M.e(T))return{returnValue:T,Qyd:ea,Pyd:Z};var ca=this.calcManager.aTe(T);if(!ca)return u.ULS.sendTraceTag(524039641,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),{returnValue:null,Qyd:ea,Pyd:Z};ca=this.GYh(ca,T,R,Q);for(var I=0,H="",L=0,U=0;U<ca.length;U++)if(this.gKe(ca[U],R,Q)){I=ca[U].hcc();
ea=ca[U].start;break}for(;U<ca.length&&this.gKe(ca[U],R,Q);U++)H+=T.substring(L,ca[U].start),H=ca[U].$Kg(I,H),L=ca[U].end;L&&(Z=H.length);H+=T.substring(L,T.length);return{returnValue:H,Qyd:ea,Pyd:Z}};a.prototype.GYh=function(T,R,Q,ea){for(var Z=[],ca=0;ca<T.length;ca++){var I=T[ca];if(I.kind===C.a.range)if(I=I.ref,I.type===A.a.cell){var H=I;I=Object(t.a)(new h,{start:I.span.start,end:I.span.end,Dv:[Object(t.a)(new r,{column:H.col,row:H.row})],$hc:this.calcManager.l2b(I.span.end,R)});Z.push(I)}else if(I.type===
A.a.range)this.hKe(I.topLeftSpan,Q,ea)&&this.hKe(I.bottomRightSpan,Q,ea)?(H=new m,I.top.index<=I.bottom.index?(H.top=I.top,H.bottom=I.bottom):(H.bottom=I.top,H.top=I.bottom),I.left.index<=I.right.index?(H.left=I.left,H.right=I.right):(H.right=I.left,H.left=I.right),I=Object(t.a)(new f,{start:I.topLeftSpan.start,end:I.bottomRightSpan.end,Dv:[H]}),Z.push(I)):(H=Object(t.a)(new h,{start:I.topLeftSpan.start,end:I.topLeftSpan.end,Dv:[Object(t.a)(new r,{column:I.left,row:I.top})],$hc:this.calcManager.l2b(I.topLeftSpan.end,
R)}),I=Object(t.a)(new h,{start:I.bottomRightSpan.start,end:I.bottomRightSpan.end,Dv:[Object(t.a)(new r,{column:I.right,row:I.bottom})],$hc:this.calcManager.l2b(I.topLeftSpan.end,R)}),Z.push(H),Z.push(I));else if(I.type===A.a.column){H=I;for(I=Object(t.a)(new n,{start:I.span.start,end:I.span.end,Dv:[Object(t.a)(new w,{firstColumn:H.startIndex,xvc:H.endIndex})]});I.end<R.length-1&&":"===R.charAt(I.end)&&ca<T.length-1;)if(H=T[ca+1].ref,H.type===A.a.column&&H.span.start===I.end+1){var L=H;I.Dv.push(Object(t.a)(new w,
{firstColumn:L.startIndex,xvc:L.endIndex}));I.end=H.span.end;ca++}else break;Z.push(I)}else if(I.type===A.a.row){H=I;for(I=Object(t.a)(new c,{start:I.span.start,end:I.span.end,Dv:[Object(t.a)(new e,{firstRow:H.startIndex,yvc:H.endIndex})]});I.end<R.length-1&&":"===R.charAt(I.end)&&ca<T.length-1;)if(H=T[ca+1].ref,H.type===A.a.row&&H.span.start===I.end+1)L=H,I.Dv.push(Object(t.a)(new e,{firstRow:L.startIndex,yvc:L.endIndex})),I.end=H.span.end,ca++;else break;Z.push(I)}}return Z};a.prototype.gKe=function(T,
R,Q){return!(T.start>Q||R>T.end)};a.prototype.hKe=function(T,R,Q){return!(T.start>Q||R>T.end)};a.irf=function(T,R){return T.index<=R.index?T:R};a.Jsf=function(T,R){return R||T?R&&T?2:!R&&T?3:0:1};Object(z.a)(a,"RelativeAndAbsoluteReferencesManager",null,[784])},1140:function(z,E,b){function a(B){var v=this;this.$=B;(this.Nl=this.$.da.Aa(268))||e.ULS.shipAssertTag(537170070,0,!1,"CalcHelper constructor - IInstantaneousSupportInformationManager is not available");var C=r.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")?
y.a.current.np(53):y.a.current.np(56);this.logger=new h.a;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.sca=new c(B,this.Nl);excelOnlineCalc.config.initCalc(this.logger,this.Nl?function(A){return v.Nl.isFeatureEnabled(A)}:function(){return!1},C);this.ong=excelOnlineCalc.config.calcConfig(this.sca.localeInfo)}function c(B,v){B=b(1140).CalcHelper;v&&(v.Ge||e.ULS.shipAssertTag(537169942,0,!1,"LocaleHolder constructor - locale information is not available"));
this.Isg=B.ZEe(v,B.MEe(v.Hja));this.Jsg=excelOnlineCalc.calc.localeInfoFromData(this.localeData)}b.r(E);z=b(0);var e=b(14),f=b(276),m;(function(B){B[B.paren=0]="paren";B[B.lead=1]="lead";B[B.intern=2]="intern";B[B.trail=3]="trail";B[B.undefined=4]="undefined"})(m||(m={}));Object(z.b)("CurrencyFormatOption",m);var n;(function(B){B[B.none=-1]="none";B[B.mdy=0]="mdy";B[B.dmy=1]="dmy";B[B.ymd=2]="ymd";B[B.myd=3]="myd";B[B.dym=4]="dym";B[B.ydm=5]="ydm"})(n||(n={}));Object(z.b)("DateOrderOption",n);var w=
b(9);c.prototype.formatNumber=function(B){return this.localeInfo.formatNumber(B)};Ck.Object.defineProperties(c.prototype,{localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.Jsg}},localeData:{configurable:!0,enumerable:!0,get:function(){return this.Isg}}});Object(z.a)(c,"LocaleHolder",null,[]);var h=b(1197),y=b(54),r=b(1),x=b(22),t=b(15),u=b(204);b.d(E,"CalcHelper",function(){return a});a.prototype.sbh=function(){if(r.EwaSettings.isChangeGateEnabled("OfficeVSO:4986015_LetAutocompleteTelemetry")){if(!this.$.xa)return e.ULS.shipAssertTag(537170069,
0,!1,"CalcHelper.CurrentSheetIndex() - this.ewaControl.Sheets is null"),0;var B=this.$.xa.qa;return B?B.index:(e.ULS.shipAssertTag(537170068,0,!1,"CalcHelper.CurrentSheetIndex() - sheet is null"),0)}return this.$.xa.qa.index};a.prototype.createParser=function(){var B={};B.config=this.config;return excelOnlineCalc.parse.createParser(B)};a.prototype.createNumberFormatter=function(){var B=this,v=excelOnlineCalc.numfmt.createFormatGlobals(this.config,function(C,A){return excelOnlineCalc.calc.getTime(B.config,
C,A,"Estimation")});return excelOnlineCalc.numfmt.createNumberFormatter(v)};a.prototype.G$g=function(B,v,C,A){if(!A)return{range:{row:v,col:C},sheet:{document:this.documentLoc,index:B}};v=excelOnlineCalc.location.gridCell(v,C);B=excelOnlineCalc.location.sheetIndex(this.documentLoc,B);return excelOnlineCalc.location.sheetGridCell(B,v)};a.prototype.Smh=function(B,v){var C=excelOnlineCalc.calc.getEvalResultKind(B);switch(C){case 4:return{returnValue:B?this.sca.localeInfo.trueName:this.sca.localeInfo.falseName,
kind:C};case 1:return{returnValue:r.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.hBc(this.sca.formatNumber(B),v):this.sca.formatNumber(B),kind:C};case 2:return{returnValue:r.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.hBc(B.toString(),v):B.toString(),kind:C};case 128:return{returnValue:"",kind:C};case 8:switch(B.type){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:return{returnValue:this.sca.localeInfo.errorNames[B.type],
kind:C};default:return{returnValue:a.unknownError,kind:C}}case 32:return{returnValue:r.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.hBc(this.X$g(B,v),v):"##UNSUPPORTED: ARRAY",kind:C};default:return{returnValue:t.a.instance.fa(2164),kind:C}}};a.prototype.hBc=function(B,v){return B.length<=v?B:B.substring(0,v-3)+"..."};a.prototype.X$g=function(B,v){for(var C=this.sca.localeInfo.leftBrace,A=0;A<B.rows;++A){for(var M=0;M<B.cols;++M)C+=B.opers[A][M],M<
B.cols-1&&(C+=this.sca.localeInfo.columnSeparator);A<B.rows-1&&(C+=this.sca.localeInfo.rowSeparator)}return this.hBc(C,v-1)+this.sca.localeInfo.rightBrace};a.ZEe=function(B,v){v=void 0===v?null:v;var C=a.U4b(),A=B.Ge.TrueValueString,M=B.Ge.FalseValueString,T=B.Ge.DecimalSeparator.toString(),R=B.Ge.ListSeparator.toString(),Q=B.Ge.ColumnSeparator.toString(),ea=B.Ge.RowSeparator.toString(),Z=B.Ge.ThousandsDataArray,ca=B.Ge.ThousandSeparator.toString(),I=B.Ge.Lcid,H=B.Ge.Country,L=B.Ge.DigitsNumber,U=
B.Ge.ExpSeparatedBySpace,fa=B.Ge.FractionSeparator.toString(),aa=B.Ge.PercentSeparatedBySpace,na=x.a.JVg(Enum.toString(m,B.Ge.CurrencyFormat)),ha=B.Ge.CurrencySymbolLead,ka=B.Ge.CurrencySeparatedBySpace,xa=B.Ge.CurrencySymbolString,va=B.Ge.DigitsCurrency,Aa=-1===B.Ge.DateOrder?"MDY":u.c(Enum.toString(n,B.Ge.DateOrder)),qa=B.Ge.DateSeparator.toString(),wa=B.Ge.DateAlternativeSeparator.toString(),Ta=B.Ge.Year4Digits,sb=B.Ge.Month2Digits,db=B.Ge.Day2Digits,kb=B.Ge.LongDateFormat,ac=B.Ge.TimeSeparator.toString(),
ta=r.EwaSettings.isChangeGateEnabled("OfficeVSO:6195588_fixGetValueOrDefaultDullscriptBug")?B.Ge.TimeAltSeparator:null==B.Ge.TimeAltSeparator?null:B.Ge.TimeAltSeparator.toString(),ra=B.Ge.Hour2Digits,Na=B.Ge.Use24HourClock,gb=B.Ge.AmPmSeparatedBySpace,ob=[B.Ge.AmString,B.Ge.PmString],wb=B.Ge.DayNameShortArray,Oa=B.Ge.DayNameLongArray,sa=B.Ge.MonthNameShortArray,Fa=B.Ge.MonthNameLongArray,Wa=B.Ge.PictureSpecialArray,Db=f.a.map(("\x00"+B.Ge.PictureSingleString).split(""),function(Ya){return"\x00"===
Ya?null:Ya}),pc=B.Ge.PictureColorArray,lc=B.Ge.PictureDbnumArray,eb=B.Ge.RowLetter.toString(),ib=B.Ge.ColumnLetter.toString(),cc=B.Ge.LeftBrace.toString(),Pa=B.Ge.RightBrace.toString(),nc=B.Ge.LeftBracket.toString(),pb=B.Ge.RightBracket.toString(),rb=a.AZh(B.Ge);return excelOnlineCalc.calc.localeData(v,C,A,M,eb,ib,cc,Pa,nc,pb,T,R,Q,ea,Z,ca,I,H,L,U,fa,aa,na,ha,ka,xa,va,Aa,qa,wa,Ta,sb,db,kb,ac,ta,ra,Na,gb,ob,wb,Oa,sa,Fa,Wa,Db,pc,lc,rb,B.Ge.SysDateFormatString,B.Ge.SysTimeFormatString)};a.MEe=function(B){var v=
[];if(!B)return v;B=Cl(B);for(var C=B.next();!C.done;C=B.next()){C=C.value;var A=null;C.IsDynamicUdf||(A=excelOnlineCalc.calc.worksheetFunctionName(C.FunctionIndexInServer,C.NameUI));A&&v.push(A)}return v};a.U4b=function(){for(var B=[],v=Object.keys(w.a.errorNames),C=0;C<v.length;C++){var A=excelOnlineCalc.calc.errorTypeName(C+1,v[C]);A&&B.push(A)}return B};a.AZh=function(B){var v=Array(6);v[1]="#"+B.AllStructRefString;v[3]="#"+B.HeadersStructRefString;v[2]="#"+B.DataStructRefString;v[4]="#"+B.TotalsStructRefString;
v[5]="#"+B.ThisRowStructRefString;return v};Ck.Object.defineProperties(a.prototype,{config:{configurable:!0,enumerable:!0,get:function(){return this.ong}}});a.unknownError="##ERR##";Object(z.a)(a,"CalcHelper",null,[])},1199:function(z,E,b){function a(){}b.d(E,"a",function(){return a});z=b(0);a.tti="literal";a.operator="operator";a.func="function";a.namedRange="namedRange";a.range="range";a.qlf="letName";a.all="*";a.dVd="structRefRange";Object(z.a)(a,"TraverseFormulaInterestTypes",null,[])},1200:function(z,
E,b){function a(){}b.d(E,"a",function(){return a});z=b(0);a.cell="cell";a.range="range";a.row="row";a.column="col";Object(z.a)(a,"TraverseFormulaRefTypes",null,[])},1454:function(z,E,b){function a(K){var ba=$a.call(this)||this;ba.$=K;ba.Tb();return ba}function c(K){var ba=cd.call(this)||this;ba.$=K;ba.Tb();return ba}function e(K,ba){var ua=this;this.colors="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");
this.e6a=this.F8f=!1;this.gEb=function(){ua.e6a=!1};this.Rc=K;this.gridView=sb.g(K);this.calcManager=ba;this.Cki=Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:5041666_ImplementLogRecorderOnEwaJS");this.ucf=Aa.EwaSettings.ma(700);this.gridView.rc.To(this.gEb)}function f(K,ba,ua,La){this.rJj=K;this.K9f=ba;this.cic=void 0===La?!1:La;ua?(this.t7a=ua.IsRangeRef,this.Qwa=ua.IsAbsoluteFirstRow,this.Pwa=ua.IsAbsoluteFirstColumn,this.jMa=ua.IsAbsoluteSecondRow,this.iMa=ua.IsAbsoluteSecondColumn):Q.ULS.shipAssertTag(524039642,
0,!1,"MarqueeMetadata.Ctor: parseResultItem is null")}function m(K){var ba=Yb.call(this)||this;ba.$=K;ba.Tb();return ba}function n(K){var ba=this;this.Il=null;this.Tgg=!1;this.kMd=this.instantaneousSupportInformationManager=this.eGb=null;this.Itf={};this.Ktf={};this.Hzd=new Map;this.jde=null;this.$nc=function(ua){Q.ULS.sendTraceTag(537170005,0,50,"CalcManager.OnLocaleInformationAvailable() called");ua.mKd(ba.$nc);ua.Hja.length?ba.Gnc(ua,Sys.EventArgs.Empty):(Q.ULS.sendTraceTag(537170004,0,50,"CalcManager.OnLocaleInformationAvailable() - waiting for functions information"),
ua.roe(ba.Gnc))};this.Gnc=function(ua){Q.ULS.sendTraceTag(537170003,0,50,"CalcManager.OnFunctionsInfoReady called");ua.dKd(ba.Gnc);ba.fOj(ua)};this.onContentReady=function(){ba.Il&&(ba.instantaneousSupportInformationManager&&ba.instantaneousSupportInformationManager.pnd||Ya.Task.delay(0).CWCT(function(){ba.Il.Efb(1)},null,0,ec.a.current))};this.qvf=function(ua,La){ba.Il&&(ba.instantaneousSupportInformationManager&&ba.instantaneousSupportInformationManager.pnd||ba.Il.fGe(La.nd.block))};Q.ULS.sendTraceTag(537170067,
0,50,"Creating CalcManager");this.Qcf=!1;this.wb=K;this.cw=sb.g(K);this.FGc=null;this.gridView.Nt(this.onContentReady);this.gridView.Ea.HVc(this.qvf);this.$.da.$a(268,function(ua){ua.Ge?(Q.ULS.sendTraceTag(537170066,0,50,"CalcManager.ctor: LocaleInformation already available..."),ba.$nc(ua,Sys.EventArgs.Empty)):(Q.ULS.sendTraceTag(537170065,0,50,"CalcManager.ctor: waiting for LocaleInformation..."),ua.Loe(ba.$nc))})}function w(){}function h(){}function y(){this.iMa=this.jMa=this.Pwa=this.Qwa=this.t7a=
!1}function r(K){var ba=this;this.Urc=null;this.Iud=this.$Hd=this.hFb=!1;this.$Fd=0;this.QFd=this.SFd=this.TFd=this.RFd=-1;this.trueName="TRUE";this.falseName="FALSE";this.instantaneousSupportInformationManager=this.Ym=this.errorTypeNames=null;this.kq=this.currentStateId=-1;this.Ota="";this.saa=null;this.fBf=function(){ba.setNumberFormats()};this.zd=function(){Q.ULS.sendTraceTag(537170081,0,50,"CalcAsyncEngine.OnWorkbookOpened() called");ba.$e=new kb.a;ba.kq=-1;ba.currentStateId=-1;ba.Ota="";ba.gsb=
null;ba.$Hd=!1;ba.Ym&&ba.clearCache()};this.b6f=(this.Rc=K)?K.ya.CalcWebWorkerSmokeTestPingIntervalMS:this.b6f;this.$e=new kb.a;this.gsb=null;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.Rc.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.Roa();this.vji=Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.GetSheetInternalIndex",!1)}function x(K){this.K4d=null;this.init(K)}function t(){}function u(K){this.V7=K;this.z6=new ob.a(wb.a.Pk());this.jmc=!1}function B(K){this.qfg=
K;this.Nhe=[];this.Ncg=[];this.O_a={};this.nRd=new Map}function v(K,ba,ua,La,ub){this.type=K;this.fullName=ba;this.range=ua;this.sheetId=La;this.attributes=ub;this.JE=null}function C(K,ba){this.wwe=K;this.sheetName=ba;this.Yvc=!1}function A(K){var ba=ta.call(this)||this;ba.$=K;ba.Tb();return ba}function M(K,ba){var ua=ac.call(this)||this;ua.LNa=H.a.Re;ua.f_c=null;ua.Ejc=!1;ua.mgb=!1;ua.vuf=function(La,ub){var Va;(La=sb.g(ua.$))&&(ub=null!==(Va=null===ub||void 0===ub?void 0:ub.cell)&&void 0!==Va?Va:
La.mc(null))&&ua.rfb(ub.cell.Ck,!0)};ua.PLi=function(La){ua.isActive()&&(va.a.lr(La.Errors)||!La.Result?Q.ULS.sendTraceTag(537155726,0,50,"GetCategoryFromServer failed, ignoring - server errors: {0}",La.Errors?La.Errors.join(","):"None"):(La=La.Result,Q.ULS.sendTraceTag(537155725,0,50,"Updating number format category cache, format index = {0}, category = {1}",La.Index,La.Category),ua.osj(La.Index,La.Category),ua.raiseEvent(M.f0c,new U.a(La.Index,La.Category),ua)))};ua.refresh=function(){Q.ULS.sendTraceTag(537155722,
0,50,"InstantaneousSupportInformationManager.Refresh: start refresh");ua.Z1b();if(ua.isActive()&&ua.ea.wc.allowEdits){if(ua.mgb||ua.yn&&!(ua.ea.OBb>ua.LNa))ua.EDc();else{Q.ULS.sendTraceTag(537155721,0,50,"InstantaneousSupportInformationManager.Refresh: getting instantaneous support information.");var La=ua.$.na.va;var ub=ua.yn?ua.yn.Digest:"",Va=ua.xMi,tb=ua.wMi,Cb=La.Na(1,null);Cb.previousResponseDigest=ub;La=aa.i(La,"GetInstantaneousSupportInformation",Cb,Va,tb,null,null,132);ua.Vfd=La}Q.ULS.sendTraceTag(537155720,
0,50,"InstantaneousSupportInformationManager.Refresh: getting functions info.");ua.I_e()}};ua.Jyf=function(La){Q.ULS.sendTraceTag(537155716,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListFailed failed, status = {0}, HTTP status = {1}.",La.data.status,La.data.httpStatus);ua.IKa=null};ua.q0=function(){ua.mgb=!1;ua.ea.bG(ua.q0);ua.ARa(ua.Ejc?M.zRd:M.ezd)};ua.qd=function(La,ub){Q.ULS.sendTraceTag(537155715,0,50,"InstantaneousSupportInformationManager.OnSessionIdChanged called");fa.a(ub)&&
ua.ARa(M.zRd)};ua.If=function(){Q.ULS.sendTraceTag(537155714,0,50,"InstantaneousSupportInformationManager.OnWorkbookMetadataChanged called");3!==ua.$.workbookContext.CalcMode&&ua.qzd(0===ua.$.workbookContext.CalcMode)};ua.zd=function(){Q.ULS.sendTraceTag(537155713,0,50,"InstantaneousSupportInformationManager.OnWorkbookOpened called");ua.ARa(M.zRd);Aa.EwaSettings.ma(302)&&3!==ua.$.workbookContext.CalcMode&&ua.qzd(0===ua.$.workbookContext.CalcMode)};ua.pMi=function(La,ub,Va){Q.ULS.sendTraceTag(537155712,
0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess called.");ua.IKa=null;ua.isActive()?La.StateId===H.a.Re?(Q.ULS.sendTraceTag(537155682,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: no session, waiting for session."),ua.EDc()):!La.Result||ua.xY&&ua.xY.length?ua.ARa(M.ezd):ua.pCf(La,ub,Va):Q.ULS.sendTraceTag(537155683,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: manager is inactive, skipping.")};ua.pCf=function(La){ua.xY=La.Result;
Q.ULS.sendTraceTag(537155681,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess refreshing functions info list, returned {0} functions.",ua.xY?ua.xY.length:-1);La=!1;if(ua.xY){for(var ub=Cl(ua.xY),Va=ub.next();!Va.done;Va=ub.next())if(Va=Va.value)ua.CWe[Va.NameUI.toLocaleUpperCase()]=Va.FunctionIndex.toString(),Va.NameUI!==Va.NameDataStrings&&(ua.CWe[Va.NameDataStrings.toLocaleUpperCase()]=Va.FunctionIndex.toString(),La=!0),ua.tGh.ia(Va.FunctionIndex,Va.NameUI);ua.raiseEvent(M.bdd,
Sys.EventArgs.Empty,ua)}La&&Q.ULS.sendTraceTag(537155680,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess NameDataStrings functions names were used.")};ua.xMi=function(La){if(ua.isActive())if(Q.ULS.shipAssertTag(537155679,0,!!ua.$,"null ewaControl"),ua.Ejc=!1,ua.LNa=La.StateId,ua.LNa===H.a.Re)ua.Ejc=!0,ua.EDc();else{if(La.Result){var ub=ua.yn;ua.yn=La.Result;Q.ULS.sendTraceTag(537155678,0,50,"InstantaneousSupportInformation updated, new result digest: {0}.",ua.yn.Digest);La=[];
if(ub)La=M.UTh(ub.NumberFormats,ua.yn.NumberFormats);else for(ub=0;ub<ua.yn.NumberFormats.length;ub++)ua.Jmc.ia(ub,ua.yn.NumberFormats[ub].NumberFormatCategory);ub=Cl(La);for(var Va=ub.next();!Va.done;Va=ub.next())Va=Va.value,ua.Jmc.ia(Va,ua.yn.NumberFormats[Va].NumberFormatCategory);ua.raiseEvent(M.Mzd,new R(La),ua);Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesInRangePicker",!1)&&ua.raiseEvent(M.pmf)}ua.ARa(M.ezd)}};ua.wMi=function(La){ua.isActive()&&(10===La.data.status?
Q.ULS.sendTraceTag(537155677,0,50,"Instantaneous support information request cancelled."):(Q.ULS.sendTraceTag(21311555,0,10,"Failed to update instantaneous support information, status = {0}, HTTP status = {1}.",La.data.status,La.data.httpStatus),ua.Ejc=!0,ua.EDc()))};Q.ULS.sendTraceTag(537155737,0,50,"InstantaneousSupportInformationManager ctor start");ua.ea=K;ua.$=ba;ua.GHb=null;ua.Vfd=null;ua.IKa=null;ua.yn=null;ua.Jmc=new kb.a;ua.xvb=new kb.a;ua.xY=[];ua.tGh=new kb.a;ua.CWe={};ua.ea.gk(ua.qd);
ua.$.tl(ua.zd);sb.g(ua.$).ha.hsa(ua.vuf);Aa.EwaSettings.ma(302)&&ua.ea.Ot(ua.If);ua.ARa(M.L$e);Q.ULS.sendTraceTag(537155736,0,50,"InstantaneousSupportInformationManager ctor end");return ua}function T(K){this.data=K}function R(K){var ba=na.call(this)||this;ba.o0j=K;return ba}b.r(E);z=b(11);E=b(0);var Q=b(14),ea=b(226),Z=b(90),ca=b(4),I=b(201),H=b(9),L=b(38),U=b(1087),fa=b(229),aa=b(84),na=Sys.EventArgs;Am(R,na);Object(E.a)(R,"NumberFormatsUpdatedEventArgs",Sys.EventArgs,[]);var ha=b(47),ka=b(44),
xa=b(35),va=b(30),Aa=b(1),qa=b(709),wa=b(22),Ta=b(292),sb=b(21),db=b(205);Object(E.a)(T,"NumberFormatDataHolder",null,[]);var kb=b(170),ac=L.a;Am(M,ac);M.prototype.Loe=function(K){this.addHandler(M.Mzd,K)};M.prototype.mKd=function(K){this.removeHandler(M.Mzd,K)};M.prototype.JEg=function(K){this.addHandler(M.f0c,K)};M.prototype.sbj=function(K){this.removeHandler(M.f0c,K)};M.prototype.roe=function(K){this.addHandler(M.bdd,K)};M.prototype.dKd=function(K){this.removeHandler(M.bdd,K)};M.prototype.mGg=
function(K){this.addHandler(M.pmf,K)};M.prototype.rfb=function(K,ba){var ua=this.Jmc.Nc(K,0);var La=ua.value;ua=ua.returnValue;!ua&&0<K&&this.$&&(Q.ULS.sendTraceTag(537155735,0,50,"InstantaneousSupportInformationManager.TryGetNumberFormatCategory: failed to get category from numberFormatIndexToCategoryCache {0}",K),this.JLh(K),ba&&(La=this.ILh(K),ua=!0),qa.a(K,this.$.xG)&&(La=6));return{returnValue:ua,category:La}};M.prototype.gji=function(K){var ba=this.rfb(K,!0);var ua=ba.category;if(ba.returnValue)return 6===
ua;Q.ULS.sendTraceTag(537155733,0,50,"InstantaneousSupportInformationManager.IsFormatInPercentageCategory: failed to get category from format index {0}",K);return!1};M.prototype.SEh=function(K){Q.ULS.sendTraceTag(537155730,0,50,"InstantaneousSupportInformationManager.ForceRefreshFunctionInfo: Forcing refresh of functions");this.IKa=aa.x(this.$.na.va,{FilterType:0},Ta.b(this.pCf,K),this.Jyf,null,null,null)};M.prototype.UVe=function(){this.ARa(M.L$e)};M.prototype.qzd=function(K){this.f_c=K};M.prototype.JLh=
function(K){if(this.xvb&&this.$){var ba=this.xvb.Nc(K);var ua=ba.value;if(!ba.returnValue||ua.isCompleted){Q.ULS.sendTraceTag(537155728,0,50,"Getting number format category for format index: {0}",K);ua=this.$.na.va;ba=this.PLi;var La=ua.Na(1,null);La.ifmt=K;(ua=aa.i(ua,"GetNumberFormatCategory",La,ba,null,null,null,4))&&this.xvb.ia(K,ua)}}else Q.ULS.sendTraceTag(537155729,0,15,"GetCategoryFromServerAsync called on disposed InstantaneousSupportInformationManager instance, skipping")};M.prototype.ILh=
function(K){return 1<=K&&8>=K?1:9<=K&&12>=K?2:13===K||14===K?6:15===K?8:17===K|18===K?7:19===K?4:16===K||20<=K&&29>=K||31===K?11:30===K?9:32<=K&&35>=K?3:0};M.prototype.isActive=function(){var K=void 0===this.ea||null===this.ea,ba=!K&&this.ea.sc;Q.ULS.sendTraceTag(537155727,0,50,"InstantaneousSupportInformationManager.IsActive: instantaneous support information manager active:{0} - sessionStateManager IsNullOrUndefined: {1}",ba,K);return ba};M.prototype.osj=function(K,ba){this.Jmc.ia(K,ba)};M.prototype.dispose=
function(){Z.a.Ha(this.GHb);this.GHb=null;this.Z1b();for(var K=Cl(this.xvb),ba=K.next();!ba.done;ba=K.next())(ba=ba.value.value)&&!ba.isCompleted&&ca.AFrameworkApplication.Jd.Fu(ba.Qt);this.xvb=null;this.ea&&(this.ea.Fk(this.qd),this.mgb&&this.ea.bG(this.q0),this.mgb=!1,this.ea.Gv(this.If));this.ea=null;this.$&&sb.g(this.$)&&sb.g(this.$).ha&&(sb.g(this.$).ha.iAa(this.vuf),this.$.Ul(this.zd));this.$=null;ac.prototype.dispose.call(this)};M.prototype.isFeatureEnabled=function(K){try{switch(K){case "LocaleLongDateFormat":return Aa.EwaSettings.ma(197);
case "GetLocaleDayNames":return Aa.EwaSettings.ma(198);case "CalculateTextWidthIgnoreLetterSpacing":return Aa.EwaSettings.ma(284);case "OfficeVSO:3657744_CalcFixForDateFormat":return Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:3657744_CalcFixForDateFormat");case "OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero":return Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero");case "CalcAutocompleteExperiment":return Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",
!1);case "CalcNewFunctions":return Aa.EwaSettings.ma(247);case "CalcContractChecks":return Aa.EwaSettings.ma(248);case "CalcSupportDynamicArrays":return Aa.EwaSettings.ma(249);case "CalcFormatCalculations":return Aa.EwaSettings.ma(250);case "CalcFormulaCacheAPIChanges":return Aa.EwaSettings.ma(251);case "CalcStrictFormulaChecking":return Aa.EwaSettings.ma(252);case "CalcSupportRowReference":return Aa.EwaSettings.ma(263);case "CalcParserUsesPledges":return Aa.EwaSettings.ma(307);case "CalcWebWorker":return!0;
case "CalcWebWorkerTest":return Aa.EwaSettings.ma(306);case "CalcLookupFunctions":return Aa.EwaSettings.ma(308);case "CalcLogStopWatch":return Aa.EwaSettings.ma(372);case "CalcPreventSpillingHack":return Aa.EwaSettings.ma(253);case "CalcDynamicArrayOperators":return Aa.EwaSettings.ma(103);case "CalcDotOperator":return Aa.EwaSettings.ma(592);case "CalcLetFunction":return Aa.EwaSettings.ma(711);default:return K.startsWith("OfficeVSO:")?Aa.EwaSettings.isChangeGateEnabled(K):!1}}catch(ba){return Q.ULS.sendTraceTag(537155724,
0,15,"InstantaneousSupportInformation.IsFeatureEnabled({0}): feature parsing failed, returning false. Exception: {1}.",K,ba.toString()),!1}};M.prototype.ARa=function(K){this.isActive()&&this.ea.wc.allowEdits?(Z.a.Ha(this.GHb),this.GHb=null,this.GHb=ha.a.instance.create(this.refresh,K,ka.a.Fdi)):Q.ULS.sendTraceTag(537155723,0,50,"InstantaneousSupportInformationManager.ScheduleRefresh: won't schedule refresh. Edit permission: AllowEdits {0}, IsEditMode {1}",void 0!==this.ea&&null!==this.ea&&void 0!==
this.ea.wc&&null!==this.ea.wc?this.ea.wc.allowEdits:!1,void 0===this.ea||null===this.ea?!1:this.$.ea.isEditMode)};M.prototype.I_e=function(){Q.ULS.sendTraceTag(537155719,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync called.");this.IKa?Q.ULS.sendTraceTag(537155718,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync already running, skipping."):this.isActive()?this.xY&&this.xY.length||(this.IKa=aa.x(this.$.na.va,{FilterType:0},this.pMi,this.Jyf,null,null,null)):Q.ULS.sendTraceTag(537155717,
0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync session is not yet active, skipping.")};M.prototype.EDc=function(){this.mgb||(this.mgb=!0,this.ea.VG(this.q0))};M.prototype.Z1b=function(){this.Fu(this.Vfd);this.Fu(this.IKa);this.IKa=this.Vfd=null};M.prototype.Fu=function(K){K&&!K.isCompleted&&this.$.na.va.qfb(K.Qt)};M.UTh=function(K,ba){if(!K||!K.length)return[];if(!ba||!ba.length){ba=Array(K.length);for(var ua=0;ua<K.length;++ua)ba[ua]=K[ua].IfmtIndex;return ba}var La=new kb.a;
K=Cl(K);for(ua=K.next();!ua.done;ua=K.next())ua=ua.value,La.ia(ua.IfmtIndex,new T(ua));K=new I.a;ua={};ba=Cl(ba);for(var ub=ba.next();!ub.done;ua={Jgb:ua.Jgb,eQb:ua.eQb},ub=ba.next())ua.Jgb=ub.value,ua.eQb=void 0,function(Va){return function(){var tb=La.Nc(Va.Jgb.IfmtIndex);Va.eQb=tb.value;return tb}}(ua)().returnValue&&ua.eQb.data.FormatString===ua.Jgb.FormatString||K.add(ua.Jgb.IfmtIndex);return K.toArray()};Ck.Object.defineProperties(M.prototype,{Ge:{configurable:!0,enumerable:!0,get:function(){return this.yn?
this.yn.LocaleInformation:null}},Kca:{configurable:!0,enumerable:!0,get:function(){return this.yn?this.yn.NumberFormats:[]}},Hja:{configurable:!0,enumerable:!0,get:function(){this.xY&&this.xY.length||this.I_e();return this.xY}},Bdi:{configurable:!0,enumerable:!0,get:function(){return this.yn&&void 0!==this.yn.InstantaneousCalcWebWorkerPrecisionSamplingRate&&null!==this.yn.InstantaneousCalcWebWorkerPrecisionSamplingRate?this.yn.InstantaneousCalcWebWorkerPrecisionSamplingRate:M.Zch}},Edi:{configurable:!0,
enumerable:!0,get:function(){return this.yn&&void 0!==this.yn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate&&null!==this.yn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate?this.yn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate:M.cdh}},Ddi:{configurable:!0,enumerable:!0,get:function(){return this.yn&&void 0!==this.yn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate&&null!==this.yn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate?this.yn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate:
M.bdh}},Cdi:{configurable:!0,enumerable:!0,get:function(){return this.yn&&void 0!==this.yn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate&&null!==this.yn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate?this.yn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate:M.adh}},Abf:{configurable:!0,enumerable:!0,get:function(){return this.yn?this.yn.InstantaneousCalcWebWorkerRenderingTimeLimitInMs:M.$ch}},pnd:{configurable:!0,enumerable:!0,get:function(){return null!==this.f_c?this.f_c:
this.yn?this.yn.InstantaneousCalcManualMode:!1}}});M.Mzd="isim0";M.f0c="isim1";M.bdd="isim2";M.pmf="isim3";M.L$e=100;M.zRd=1E3;M.ezd=3E5;M.Zch=.001;M.cdh=.1;M.bdh=.2;M.adh=.001;M.$ch=50;Object(E.a)(M,"InstantaneousSupportInformationManager",L.a,[772,2]);var ta=ea.a;Am(A,ta);A.prototype.create=function(){this.$&&(Q.ULS.sendTraceTag(537155672,0,50,"InstantaneousSupportInformationManagerFactory.Create: Start loading script"),this.Eb(this.$.da.Aa(268)||new M(this.$.ea,this.$)))};A.ka=function(K){if(!K)throw Error.argumentNull("ewaControl");
K.da.Ga(246,new A(K))};Object(E.a)(A,"InstantaneousSupportInformationManagerFactory",ea.a,[]);var ra=b(82),Na=b(112),gb=b(83);Object(E.a)(C,"CalcBlockInformation",null,[]);Object(E.a)(v,"CalcNamedObject",null,[]);B.prototype.J0f=function(K,ba){this.Nhe[K]=ba;this.qfg&&ba.V7&&this.nRd.set(ba.V7.sheetName,K)};B.prototype.getSheetIndex=function(K){if(this.qfg){if(this.nRd.has(K))return this.nRd.get(K)}else for(var ba=1;ba<this.Kj.length;ba++)if(wa.a.equals(this.Kj[ba].V7.sheetName,K,!1))return ba;return-1};
Ck.Object.defineProperties(B.prototype,{Kj:{configurable:!0,enumerable:!0,get:function(){return this.Nhe}}});Object(E.a)(B,"GridCache",null,[]);var ob=b(893),wb=b(615);Object(E.a)(u,"SheetInformation",null,[]);var Oa=b(1140),sa;(function(K){K[K.initialization=0]="initialization";K[K.contentReady=1]="contentReady";K[K.cellEdit=2]="cellEdit"})(sa||(sa={}));Object(E.b)("UpdateDataTrigger",sa);var Fa=b(63);t.local="Local";t.HJj="Thread";Object(E.a)(t,"RecalcServiceCreateMode",null,[]);var Wa=b(45),Db=
b(37),pc=b(166);x.prototype.init=function(K){this.K4d=new kb.a;if(void 0!==K&&null!==K&&void 0!==K.HeadersList&&null!==K.HeadersList&&0<K.HeadersList.length){K=Cl(K.HeadersList);for(var ba=K.next();!ba.done;ba=K.next())ba=ba.value,this.Z$.ia(ba.Index,ba.Name)}};Ck.Object.defineProperties(x.prototype,{Z$:{configurable:!0,enumerable:!0,get:function(){return this.K4d}}});Object(E.a)(x,"ColHeadersListData",null,[]);var lc=b(99);b(204);var eb=b(256);r.prototype.dispose=function(){this.instantaneousSupportInformationManager&&
this.instantaneousSupportInformationManager.mKd(this.fBf);this.Rc&&this.Rc.Ul(this.zd);this.close()};r.prototype.Efb=function(K){if(!this.Ym)return!1;if(!this.instantaneousSupportInformationManager&&(this.instantaneousSupportInformationManager=this.Rc.da.Aa(268),!this.instantaneousSupportInformationManager))return Q.ULS.sendTraceTag(537170198,0,50,"CalcAsyncEngine.UpdateData Failed to get instantaneousSupportInformationManager"),!1;2!==K&&(this.currentStateId=this.Rc.ea.OBb,this.currentStateId===
H.a.Re&&(this.currentStateId=this.Rc.ea.af));if(1===K&&this.currentStateId<this.kq)return Q.ULS.sendTraceTag(537170197,0,50,"CalcAsyncEngine::UpdateData() currentStateId:{0} < lastUpdatedStateId:{1} - ignoring update",this.currentStateId,this.kq),!1;this.oqj();0!==K&&this.$Hd||(this.Euj(),this.Irj(),this.usj(),this.setNumberFormats(),this.instantaneousSupportInformationManager.Loe(this.fBf),this.Rc.tl(this.zd),this.$Hd=!0);this.l7i();var ba=!1;0===K&&(ba=this.rbi());if(0!==K||ba)this.Qtj()?(this.tuj(K),
this.suj(),this.kq=this.currentStateId,this.rYg()):Q.ULS.sendTraceTag(537170196,0,15,"CalcAsyncEngine::UpdateData() for StateId:{0} failed - no Sheets information",this.currentStateId);2!==K&&this.resumeRecalc();return!0};r.prototype.evalFormula=function(K){if(!this.Ym)return Q.ULS.sendTraceTag(537170195,0,15,"CalcAsyncEngine.EvalFormula: recalc engine is null"),Promise.resolve({});K=this.Ym.evalFormula(this.Rc.ea.af,K,Fa.d(this.Rc.xa.qa));this.resumeRecalc();return K};r.prototype.evalFormulaRange=
function(K,ba,ua){if(!this.Ym)return Q.ULS.sendTraceTag(537170194,0,15,"CalcAsyncEngine.EvalFormulaRange: recalc engine is null"),Promise.reject(null);Q.ULS.shipAssertTag(537170193,0,ba.isSingle,"CalcAsyncEngine.EvalFormulaRange: originCell Range must be a single cell.");ua=Wa.j(ua);ba=Wa.o(ba,this.Rc);ba=excelOnlineCalc.calc.cellLocation(ba.FirstRow,ba.FirstColumn);ua=r.eV("EvalFormulaRange",Fa.d(this.Rc.xa.qa),ua.FirstRow,ua.FirstColumn,ua.LastRow,ua.LastColumn);Q.ULS.sendTraceTag(537170190,0,50,
"CalcAsyncEngine.EvalFormulaRange: calling calc.ts's EvalFormulaRange API for state ID {0}",this.kq);K=this.Ym.evalFormulaRange(this.kq,K,ba,ua,null);K.then(function(La){if(excelOnlineCalc.util.isSuccess(La)){var ub=[];La=Cl(La.value);for(var Va=La.next();!Va.done;Va=La.next())Va=Va.value,excelOnlineCalc.util.isSuccess(Va.value)||(Va=Va.value.reason.kind.toString(),Array.contains(ub,Va)||ub.push(Va));Q.ULS.sendTraceTag(537170191,0,50,"CalcAsyncEngine.EvalFormulaRange - Evaluation of range complete. FailureReasons: {0}",
ub.length?Sys.Serialization.JavaScriptSerializer.serialize(ub):"None")}else Q.ULS.sendTraceTag(537170192,0,15,"CalcAsyncEngine.EvalFormulaRange: Calc.EvalFormulaRange returned a failed object. failure reason: {0}",La.reason.kind)}).catch(function(La){Q.ULS.sendTraceTag(537170189,0,10,"CalcAsyncEngine.EvalFormulaRange - promise rejected: {0}",Sys.Serialization.JavaScriptSerializer.serialize(La));return Promise.reject(La)});this.resumeRecalc();return K};r.prototype.fUg=function(K,ba,ua,La){La=void 0===
La?null:La;if(this.Ym&&K){var ub=Fa.d(this.Rc.xa.qa),Va=K.cell.vK-1,tb=K.cell.uK-1,Cb=Va,nb=tb,Ib=null;La&&(Ib=excelOnlineCalc.calc.cellLocation(Va,tb),Va=La.top-1,tb=La.left-1,Cb=La.bottom-1,nb=La.right-1);if(K.cell.fu)if(La=K.cell.fu.cZc,La===H.a.Re)Q.ULS.sendTraceTag(537170187,0,15,"CalcAsyncEngine::CalculateFormula() BlockRevision unknown for block:{0}",K.cell.fu.ae);else if(La<this.kq)Q.ULS.sendTraceTag(537170185,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}",
Va,tb,La,this.kq);else if(La<this.currentStateId)Q.ULS.sendTraceTag(537170184,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}",Va,tb,La,this.currentStateId);else if(this.hFb||(this.Ym.setOnRecalcResults(ua),this.hFb=!0),this.Acg()&&!this.Efb(2))Q.ULS.sendTraceTag(537170183,0,15,"CalcAsyncEngine.CalculateFormula: UpdateData failed");else{nb=r.eV("CalculateFormula.cell",ub,Va,tb,Cb,nb);ua=[];var hb=sb.g(this.Rc);Cb=hb.Hh;sb.g(this.Rc).rb.dj&&
(Cb=hb.Tf(1).Hh,Cb.Nna(1,1),Cb.Nna(3,1));hb=null;Cb?hb=r.eV("CalculateFormula.viewport",ub,Cb.top-1,Cb.left-1,Cb.bottom-1,Cb.right-1):Q.ULS.sendTraceTag(537170182,0,50,"CalcAsyncEngine::CalculateFormula() viewportRange is null, calc will use entire sheet...");ba=excelOnlineCalc.calc.inferredRangeFormulaEdit(nb,ba,Ib,hb);ua.push(ba);K=Cb?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",ub,Va,tb,wa.a.K_b(K.cell.text),
La,Cb.top-1,Cb.left-1,Cb.bottom-1,Cb.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",ub,Va,tb,wa.a.K_b(K.cell.text),La,"","","","");Q.ULS.sendTraceTag(537170181,0,50,K);this.Ym.editRangeFormulas(La,ua);this.resumeRecalc()}else Q.ULS.sendTraceTag(537170186,0,15,"CalcAsyncEngine::CalculateFormula() GridBlockModelProxy is null cell:({0},{1})",K.cell.vK,K.cell.uK)}else Q.ULS.sendTraceTag(537170188,0,15,"CalcAsyncEngine::CalculateFormula() recalc engine is null:{0}, modifiedCell is null:{1}",
!this.Ym,!K)};r.prototype.dUg=function(K,ba,ua,La){La=void 0===La?null:La;var ub=Fa.d(this.Rc.xa.qa),Va=K.cell.vK-1,tb=K.cell.uK-1,Cb=Va,nb=tb,Ib=null;La&&(Ib=excelOnlineCalc.calc.cellLocation(Va,tb),Va=La.top-1,tb=La.left-1,Cb=La.bottom-1,nb=La.right-1);ua=this.C_d(K,ua,"SetCell");0>ua||(nb=r.eV("CalculateFormula.cell",ub,Va,tb,Cb,nb),Cb=[],La=this.vid(ub),ba=excelOnlineCalc.calc.inferredRangeFormulaEdit(nb,ba,Ib,La),Cb.push(ba),K=(ba=this.Z4e())?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",
ub,Va,tb,wa.a.K_b(K.cell.text),ua,ba.top-1,ba.left-1,ba.bottom-1,ba.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",ub,Va,tb,wa.a.K_b(K.cell.text),ua,"","","",""),Q.ULS.sendTraceTag(537170180,0,50,K),this.Ym.editRangeFormulas(ua,Cb),this.resumeRecalc())};r.prototype.Jtb=function(K,ba,ua,La){if(!this.Ym)return Q.ULS.sendTraceTag(537170179,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone recalc engine is null"),
Promise.reject("RecalcService is null");if(!ua||!ba)return Q.ULS.sendTraceTag(524120779,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone inputs are null. originCell null: "+!ua+", outputColumnRange null: "+!ba),Promise.reject("CalcAsyncEngine::EvalFormulaRangeOnClone: null inputs");Q.ULS.shipAssertTag(537170178,0,ua.isSingle,"CalcAsyncEngine::EvalFormulaRangeOnClone originCell must be a single cell.");var ub=Fa.d(this.Rc.xa.qa),Va=this.vid(ub),tb=null;if(K){tb=[];K=Cl(K);for(var Cb=K.next();!Cb.done;Cb=
K.next())if(Cb=Cb.value,Cb.column!==ua.left){var nb=Cb.row-1;var Ib=Cb.column-1;nb=r.eV("EvalFormulaRangeOnClone.cell",ub,nb,Ib,nb,Ib);Ib=Cb.text;tb.push(excelOnlineCalc.calc.rangeWrite(nb,excelOnlineCalc.calc.valueCellData(Ib,Ib,Cb.Ck,null)))}}ua=excelOnlineCalc.calc.cellLocation(ua.top-1,ua.left-1);ba=r.eV("EvalFormulaRangeOnClone.outputColumnRange",ub,ba.top-1,ba.left-1,ba.bottom-1,ba.right-1);La=[excelOnlineCalc.calc.cellFormulaRangeFormulaEdit(ba,La,ua,Va)];tb=this.Ym.evalOnClonedModel(tb,La);
this.resumeRecalc();return tb};r.prototype.fGe=function(K){var ba=null;try{if(K)if(this.Ota=sb.g(this.Rc).Ea.uva(K),this.currentStateId=K.rTa,this.currentStateId<this.kq||this.currentStateId===H.a.Re)Q.ULS.sendTraceTag(537170176,0,50,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() hash:{0} blockRevision:{1} < lastUpdatedStateId:{2}",this.Ota,this.currentStateId,this.kq);else{if(this.wbi(),!this.gPg()){var ua=String.format("CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() Block Hash:{0} StateId:{1}",
this.Ota,this.currentStateId);ba=this.Rc.Ob.Hc("ModelUpdate",ua);this.gsb=this.Mwb(K.qa.sheetName);if(!this.gsb){var La=!!(this.Rc.Pd&32);Q.ULS.sendTraceTag(537170147,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel SheetName not found. Number of existing sheets {0}, scratchPad:{1}, sheetNameLength:{2} Hash:{3}",this.$e.xb(this.currentStateId)&&this.$e.oa(this.currentStateId).Kj?this.$e.oa(this.currentStateId).Kj.length:0,La,K.qa.sheetName?K.qa.sheetName.length:-1,K.qa.hash)}else if(sb.g(this.Rc).Ea.tm.b2a(K.ae)){var ub=
K.Ff;if(ub){var Va=ub.getCalcBlockModel();if(!Va)Q.ULS.sendTraceTag(537170145,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model for block");else if(this.ZOg(Va)){this.$e.oa(this.currentStateId).O_a[this.Ota]=new C(Va,K.qa.sheetName);var tb=K.ze;tb?this.tCg(tb.NamedObjects):Q.ULS.sendTraceTag(537170144,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel GetGridBlockContentResponse is null")}}else Q.ULS.sendTraceTag(537170146,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model accessor for block:{0}",
this.Ota)}}}else Q.ULS.shipAssertTag(537170177,0,!1,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() blockCacheItem is null")}finally{ba&&ba.stop()}};r.prototype.V4a=function(K){if(!this.$e.oa(this.currentStateId).Kj||!this.$e.oa(this.currentStateId).Kj[0])return null;var ba=this.$e.oa(this.currentStateId).Kj[0].z6;if(!ba||!ba.xb(K.name))return null;ba=ba.oa(K.name);if(!ba||!ba.JE)return null;K=new I.a;ba=Cl(ba.JE.Z$);for(var ua=ba.next();!ua.done;ua=ba.next())K.add(ua.value.value);return K};
r.prototype.getNameLoc=function(K,ba){return this.Ehc()?this.$e.oa(this.currentStateId).Kj[0].z6.xb(ba)?(K=excelOnlineCalc.location.nameLoc(K,ba),excelOnlineCalc.util.success(K)):excelOnlineCalc.util.success(null):(K=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(K))};r.prototype.getContainingTable=function(K){if(!this.Ehc())return K=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(K);var ba=K.range.col,ua=K.range.row,La=this.$e.oa(this.currentStateId).Kj[0].z6,
ub=null;La=Cl(La);for(var Va=La.next();!Va.done;Va=La.next())if(Va=Va.value.value,2===Va.type&&wa.a.equals(K.sheet.index.toString(),Va.sheetId,!0)){var tb=Va.range;ba>=tb.left-1&&ba<=tb.right-1&&ua<=tb.bottom-1&&ua>=tb.top-1&&(ub=excelOnlineCalc.location.nameScope(this.documentLoc,Va.sheetId),ub=excelOnlineCalc.location.nameLoc(ub,Va.fullName))}return ub?excelOnlineCalc.util.success(ub):excelOnlineCalc.util.success(null)};r.prototype.getStructRefColumn=function(K,ba){if(!this.Ehc()){var ua=excelOnlineCalc.util.unavailable([2]);
return excelOnlineCalc.util.failure(ua)}ua=K.name;var La=this.$e.oa(this.currentStateId).Kj[0].z6;if(La.xb(ua)){La=La.oa(ua);var ub=La.range;if(2!==La.type)return excelOnlineCalc.util.failure(this.w4c(5));var Va=La.JE?La.JE.Z$:null;if(!Va)return excelOnlineCalc.util.success(null);for(var tb=Cl(Va),Cb=tb.next();!Cb.done;Cb=tb.next())if(Cb=Cb.value,wa.a.equals(Cb.value,ba,!0))return K=excelOnlineCalc.location.documentLoc(K.scope.document.path,K.scope.document.name),K=excelOnlineCalc.location.sheetIndex(K,
La.sheetId),ub=excelOnlineCalc.location.gridRange(ub.top-1,Cb.key,ub.bottom-ub.top+1,1),ub=excelOnlineCalc.location.sheetGridRange(K,ub),ua=excelOnlineCalc.location.structRefColumnLoc(ua,ub,!!(La.attributes&16),!!(La.attributes&8)),excelOnlineCalc.util.success(ua);return ub.right-ub.left+1!==Va.count?(ua=excelOnlineCalc.util.unavailable([17,K,ba]),excelOnlineCalc.util.failure(ua)):excelOnlineCalc.util.failure(this.w4c(0))}return excelOnlineCalc.util.success(null)};r.prototype.getStructRefSpecialRef=
function(K,ba){if(!this.Ehc())return ba=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ba);var ua=this.$e.oa(this.currentStateId).Kj[0].z6;if(ua.xb(K.name)){var La=ua.oa(K.name);if(2!==La.type)return excelOnlineCalc.util.failure(this.w4c(5));ua=!!(La.attributes&16);var ub=!!(La.attributes&8),Va=ua?1:0,tb=ub?1:0;K=excelOnlineCalc.location.documentLoc(K.scope.document.path,K.scope.document.name);K=excelOnlineCalc.location.sheetIndex(K,La.sheetId);La=La.range;var Cb={};if(1===ba)Cb=
excelOnlineCalc.location.gridRange(La.top-Va-1,La.left-1,La.bottom+tb-La.top+Va+1,La.right-La.left+1);else if(2===ba)Cb=excelOnlineCalc.location.gridRange(La.top-1,La.left-1,La.bottom-La.top+1,La.right-La.left+1);else if(3===ba)if(ua)Cb=excelOnlineCalc.location.gridRange(La.top-2,La.left-1,1,La.right-La.left+1);else return excelOnlineCalc.util.success(null);else if(4===ba)if(ub)Cb=excelOnlineCalc.location.gridRange(La.bottom,La.left-1,1,La.right-La.left+1);else return excelOnlineCalc.util.success(null);
ba=excelOnlineCalc.location.sheetGridRange(K,Cb);return excelOnlineCalc.util.success(ba)}return excelOnlineCalc.util.success(null)};r.prototype.getDocumentLoc=function(K,ba){if((wa.a.equals(K,this.documentLoc.path,!0)||!K)&&wa.a.equals(ba,this.documentLoc.name,!0))return excelOnlineCalc.util.success(this.documentLoc);K=excelOnlineCalc.util.unavailable([0,excelOnlineCalc.location.documentLoc(K,ba)]);return excelOnlineCalc.util.failure(K)};r.prototype.getSheetIndex=function(K,ba){if(!this.$e.xb(this.currentStateId)||
!this.$e.oa(this.currentStateId).Kj)return ba=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ba);K=this.$e.oa(this.currentStateId).Kj;for(var ua=1;ua<K.length;ua++)if(wa.a.equals(K[ua].V7.sheetName,ba,!0))return excelOnlineCalc.util.success(K[ua].V7.sheetId);return excelOnlineCalc.util.success(null)};r.prototype.getSheetName=function(K,ba){if(!this.$e.xb(this.currentStateId)||!this.$e.oa(this.currentStateId).Kj)return ba=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ba);
K=this.$e.oa(this.currentStateId).Kj;for(var ua=1;ua<K.length;ua++)if(wa.a.equals(K[ua].V7.sheetId,ba,!0))return excelOnlineCalc.util.success(K[ua].V7.sheetName);return excelOnlineCalc.util.success(null)};r.prototype.getUserDefinedFuncLoc=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetUserDefinedFuncLoc not implemented in main thread"])};r.prototype.getSheetRangeIndexes=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetSheetRangeIndexes not implemented in main thread"])};
r.prototype.eUg=function(K,ba,ua){var La=sb.g(this.Rc),ub=La.mc(ba);ub=this.C_d(ub,null,"CopyPaste");ua=this.C_d(La.mc(K),ua,"CopyPaste");if(0>ub||0>ua||ub!==ua)Q.ULS.sendTraceTag(537170143,0,15,"CalcAsyncEngine::CalculateFormulaForCopyPaste(). Revision not valid. sourceRevision:{0}, targetRevision:{1}.",ua,ub);else{ua=[];La=Fa.d(this.Rc.xa.qa);var Va=this.vid(La);K=r.eV("CalculateFormulaForCopyPaste.srcRange",La,K.top-1,K.left-1,K.bottom-1,K.right-1);ba=r.eV("CalculateFormulaForCopyPaste.targetRange",
La,ba.top-1,ba.left-1,ba.bottom-1,ba.right-1);ba=excelOnlineCalc.calc.copyPasteRangePasteEdit(ba,K,Va);ua.push(ba);ba=Va?String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",La,ub,Va.row,Va.column,Va.lastRow,Va.lastColumn):String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",La,ub,"","","","");Q.ULS.sendTraceTag(537170142,0,50,ba);this.Ym.editRangePaste(ub,ua);
this.resumeRecalc()}};r.prototype.vid=function(K){var ba=this.Z4e(),ua=null;ba?ua=r.eV("GetViewport.viewport",K,ba.top-1,ba.left-1,ba.bottom-1,ba.right-1):Q.ULS.sendTraceTag(537170141,0,50,"CalcAsyncEngine::GetViewport() viewportRange is null, calc will use entire sheet...");return ua};r.prototype.Z4e=function(){var K=sb.g(this.Rc),ba=K.Hh;if(sb.g(this.Rc).rb.dj){ba=K.Tf(1).Hh;if(Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:5497152_JSCrash_At_CalcAsyncEngine_GetViewportRange")&&!ba)return Q.ULS.sendTraceTag(537170140,
0,15,"CalcAsyncEngine::GetViewportRange viewportRange is null."),null;ba.Nna(1,1);ba.Nna(3,1)}return ba};r.prototype.C_d=function(K,ba,ua){if(!this.Ym||!K)return Q.ULS.sendTraceTag(537170139,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() recalc engine is null:{0}, modifiedCell is null:{1}, operation:{2}",!this.Ym,!K,ua),-1;var La=K.cell.vK-1,ub=K.cell.uK-1;if(K.cell.fu){var Va=K.cell.fu.cZc;if(Va===H.a.Re)return Q.ULS.sendTraceTag(537170138,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() BlockRevision unknown for block:{0}, operation:{1}",
K.cell.fu.ae,ua),-1}else return Q.ULS.sendTraceTag(537170137,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() GridBlockModelProxy is null cell:({0},{1}), operation:{2}",K.cell.vK,K.cell.uK,ua),-1;if(Va<this.kq)return Q.ULS.sendTraceTag(537170136,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}, operation:{4}",La,ub,Va,this.kq,ua),-1;if(Va<this.currentStateId)return Q.ULS.sendTraceTag(537170135,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}, operation:{4}",
La,ub,Va,this.currentStateId,ua),-1;ba&&!this.hFb&&(this.Ym.setOnRecalcResults(ba),this.hFb=!0);return this.Acg()&&!this.Efb(2)?(Q.ULS.sendTraceTag(537170134,0,15,"CalcAsyncEngine.ValidateCalculateFormulaInit: UpdateData failed. operation:{0}",ua),-1):Va};r.prototype.getFormulaBarText=function(K,ba,ua){return ba&&ba.startsWith("'")?ba:K.cell.formulaBarText||ua.toString()};r.prototype.N9g=function(K,ba,ua){var La=null;if(this.dxe()&&this.$e.oa(this.kq).O_a){var ub=this.$e.oa(this.kq).O_a[K];if(null===
ub||void 0===ub?0:ub.Yvc)La=ub.wwe}ua=this.fgi(La,ba,ua);ba=this.U0g(La,ba,ua);Q.ULS.sendTraceTag(50671754,0,50,"CalcAsyncEngine::CreateRangeUpdateCommands() completed for Block Hash:{0} StateId:{1} number of formulas {2}",K,this.currentStateId,ba)};r.prototype.fgi=function(K,ba,ua){var La=!1,ub=r.tYe(ba);if(K){var Va=r.tYe(K);wa.a.equals(Va,ub,!1)&&(La=!0)}La?this.VCg(K,this.kq,ua):this.XCg(ba,ua);return La};r.prototype.dxe=function(){var K=!1;this.Ym&&-1!==this.kq&&(K=this.Ym.stateIdAvailable(this.kq));
return K&&this.$e.xb(this.kq)&&this.kq<this.currentStateId};r.prototype.U0g=function(K,ba,ua){var La=0;var ub,Va;for(ba.reset();ub=ba.getNextCell();)db.e(ub.formula)&&La++,(Va=ua?K.getCell(ub.row,ub.col):null)?this.Q0g(ba,ub,Va):this.WCg(ba,ub);if(ua)for(K.reset();Va=K.getNextCell();)(ub=ba.getCell(Va.row,Va.col))||this.gne(K,Va);return La};r.prototype.usj=function(){this.Ym.setOnUpdateRequest(function(){})};r.prototype.tsj=function(){var K=this;this.Ym.setOnUnresponsive(function(ba,ua,La,ub){K.zUi(ba,
ua,La,ub)})};r.prototype.zUi=function(K,ba,ua,La){Q.ULS.sendTraceTag(537170126,0,15,"CalcAsyncEngine.onUnresponsive: worker thread was unresponsive. timeout:{0}, waitTime:{1}, timeoutCount:{2}, hasBeenClosed:{3}.",K,ba,ua,La);La&&(this.thj(),this.Roa())};r.prototype.thj=function(){this.zd(null,null);this.Iud=this.hFb=!1;this.$Fd=0;this.QFd=this.SFd=this.TFd=this.RFd=-1};r.prototype.close=function(){this.Ym.close()};r.prototype.clearCache=function(){this.Ym.clearCache()};r.prototype.resumeRecalc=function(){this.Ym.resumeRecalc()};
r.prototype.Irj=function(){this.Ym.setA1ReferenceStyle(!0)};r.prototype.l7i=function(){if(this.instantaneousSupportInformationManager){var K=this.instantaneousSupportInformationManager.Bdi,ba=this.instantaneousSupportInformationManager.Edi,ua=this.instantaneousSupportInformationManager.Ddi,La=this.instantaneousSupportInformationManager.Cdi,ub=!1;K!==this.RFd&&(ub=!0,this.RFd=K);ba!==this.TFd&&(ub=!0,this.TFd=ba);ua!==this.SFd&&(ub=!0,this.SFd=ua);La!==this.QFd&&(ub=!0,this.QFd=La);var Va=[];Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSExceLintExperimentIsEnabled",
!1)&&(ub=excelOnlineCalc.calc.runExperiment("ExceLintExperiment",null),Va.push(ub),ub=!0);Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UnitExperiment",!1)&&(ub=excelOnlineCalc.calc.runExperiment("UnitExperiment",null),Va.push(ub),ub=!0);Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1)&&(ub=excelOnlineCalc.calc.runExperiment("AutocompleteExperiment",null),Va.push(ub),ub=!0);ub&&(K=excelOnlineCalc.calc.recalcServiceConfig(null,K,
null,ba,null,null,null,ua,Va,La),this.Ym.reconfigure(K))}};r.prototype.tuj=function(K){var ba=this,ua=null;if(this.$e.xb(this.currentStateId))try{this.saa=[];var La=String.format("CalcAsyncEngine::SetUpdatedRanges() StateId:{0} UpdateTriggerData:{1}",this.currentStateId,sa[K]);ua=this.Rc.Ob.Hc("ModelUpdate",La);Na.a.forEach(this.$e.oa(this.currentStateId).O_a,function(ub,Va){Va.Yvc||(ba.N9g(ub,Va.wwe,Va.sheetName),Va.Yvc=!0)},null);this.Ym.updateRanges(this.currentStateId,this.saa)}finally{ua&&ua.stop()}else Q.ULS.sendTraceTag(537170122,
0,15,"CalcAsyncEngine::SetUpdatedRanges StateId:{0} does not exist in GridCache",this.currentStateId)};r.prototype.suj=function(){var K=[],ba=this.dxe(),ua=ba&&this.$e.oa(this.kq).Kj&&this.$e.oa(this.kq).Kj[0]&&this.$e.oa(this.kq).Kj[0].jmc?this.$e.oa(this.kq).Kj[0].z6:null;this.SBe(ua,this.$e.oa(this.currentStateId).Kj[0].z6,null,this.kq,K);this.$e.oa(this.currentStateId).Kj[0].jmc=!0;for(var La=1;La<this.$e.oa(this.currentStateId).Kj.length;La++)ua=-1,ba&&this.$e.oa(this.kq).Kj&&(ua=this.xhd(this.$e.oa(this.currentStateId).Kj[La].V7.sheetName,
this.kq)),ua=-1!==ua&&this.$e.oa(this.kq).Kj[ua].jmc?this.$e.oa(this.kq).Kj[ua].z6:null,this.SBe(ua,this.$e.oa(this.currentStateId).Kj[La].z6,this.$e.oa(this.currentStateId).Kj[La].V7.sheetId,this.kq,K),this.$e.oa(this.currentStateId).Kj[La].jmc=!0;this.Ym.updateNamedObjects(this.currentStateId,K)};r.prototype.SBe=function(K,ba,ua,La,ub){if(void 0!==ua&&null!==ua){var Va=excelOnlineCalc.calc.undefinedNamesWrite(ua);ub.push(Va)}if(K){var tb=!1,Cb=[];Va=[];if(ba)for(var nb=Cl(ba),Ib=nb.next();!Ib.done;Ib=
nb.next()){Ib=Ib.value;var hb=Ib.value;if(K.xb(Ib.key)){var zb=K.oa(Ib.key);r.jEi(zb,hb)?tb=!0:(zb=excelOnlineCalc.calc.namedObject(Ib.key,null),Cb.push(zb),r.gVc(Ib.key,hb,Va))}else r.gVc(Ib.key,hb,Va)}K=Cl(K);for(Ib=K.next();!Ib.done;Ib=K.next())nb=Ib.value,ba&&ba.xb(nb.key)||(nb=excelOnlineCalc.calc.namedObject(nb.key,null),Cb.push(nb));tb&&(ba=excelOnlineCalc.calc.namedObjectsPromote(ua,La),ub.push(ba));0<Cb.length&&(ba=excelOnlineCalc.calc.namedObjectsWrite(ua,Cb),ub.push(ba));0<Va.length&&(ua=
excelOnlineCalc.calc.namedObjectsWrite(ua,Va),ub.push(ua))}else if(ba){Va=[];ba=Cl(ba);for(La=ba.next();!La.done;La=ba.next())La=La.value,r.gVc(La.key,La.value,Va);0<Va.length&&(ua=excelOnlineCalc.calc.namedObjectsWrite(ua,Va),ub.push(ua))}};r.prototype.gPg=function(){return this.$e.oa(this.currentStateId).O_a[this.Ota]?(Q.ULS.sendTraceTag(537170121,0,50,"CalcAsyncEngine::BlockPreviouslyHandled Block Hash:{0} StateId:{1} previously handled",this.Ota,this.currentStateId),!0):!1};r.prototype.ZOg=function(K){return 1===
K.getColumnNumbers().length&&K.getColumnNumbers()[0]===r.$wd+1?!1:!0};r.prototype.rbi=function(){var K=this,ba=!1;sb.g(this.Rc).Ea.rcd(function(ua){ua.state&1&&K.Rc.ea.af===ua.je.Revision&&(K.fGe(ua),ba=!0)});return ba};r.prototype.fEe=function(K,ba){var ua=K.getRowNumbers(),La=K.getColumnNumbers();K=ua[0]-1;ua=ua[ua.length-1]-1;var ub=La[0]-1;La=La[La.length-1]-1;(ba=this.Mwb(ba))||Q.ULS.sendTraceTag(537170120,0,15,"CalcAsyncEngine::CreateBlockRangeLocation SheetName not found. Number of existing sheets {0}",
this.$e.xb(this.currentStateId)&&this.$e.oa(this.currentStateId).Kj?this.$e.oa(this.currentStateId).Kj.length:0);return r.eV("CreateBlockRangeLocation",ba,K,ub,ua,La)};r.prototype.VCg=function(K,ba,ua){if(ua=this.fEe(K,ua)){var La=r.V4b(K.getRowNumbers());K=r.V4b(K.getColumnNumbers());ba=excelOnlineCalc.calc.rangePromote(ua,ba,La,K);this.saa[this.saa.length]=ba}};r.prototype.XCg=function(K,ba){if(ba=this.fEe(K,ba)){var ua=r.V4b(K.getRowNumbers());K=r.V4b(K.getColumnNumbers());K=excelOnlineCalc.calc.rangeWrite(ba,
null,ua,K);this.saa[this.saa.length]=K}};r.prototype.Q0g=function(K,ba,ua){var La=null,ub=0,Va=0;switch(ba.valueType){case 2:La=this.nid(ba);var tb=this.nid(ua);tb=wa.a.equals(tb,La,!1);break;case 1:null===ba.value&&null===ua.value?tb=!0:(ub=parseFloat(ba.value),tb=parseFloat(ua.value)===ub);break;default:null===ba.value&&null===ua.value?tb=!0:(Va=parseFloat(ba.value),tb=Va===parseFloat(ua.value))}tb&&ba.valueType===ua.valueType&&ba.ifmt===ua.ifmt&&ba.formulaType===ua.formulaType&&wa.a.equals(ua.formula,
ba.formula,!1)||(void 0!==ba.formula&&null!==ba.formula||void 0!==ba.value&&null!==ba.value||void 0!==ba.text&&null!==ba.text?this.nZb(K,ba,La,ub,Va):this.gne(K,ba))};r.prototype.tCg=function(K){if(this.Rc.Hb&&this.Rc.Hb.items)for(var ba=0;ba<this.Rc.Hb.count;ba++){var ua=this.Rc.Hb.items[ba];if(2===ua.type||3===ua.type){var La=0,ub=ua.name,Va=ub.lastIndexOf("!");if(0<Va){La=ub.substr(0,Va);"'"===La.charAt(0)&&(La=La.substr(1,La.length-2));La=this.xhd(La,this.currentStateId);if(-1===La){Q.ULS.sendTraceTag(595096334,
0,15,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.$e.xb(this.currentStateId)&&this.$e.oa(this.currentStateId).Kj?this.$e.oa(this.currentStateId).Kj.length:0);continue}ub=ub.substr(Va+1)}La=this.$e.oa(this.currentStateId).Kj[La].z6;var tb=ua.usedRange;2===ua.type&&(tb=pc.a(ua));if(La.xb(ub)){if(Va=La.oa(ub),Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:5502630_AddNamedObjectsInBlock_updateRange")&&(Va.range=tb,Va.attributes=ua.attributes),2===Va.type&&
(ub=r.AUe(ua.name,K),ua=(La=Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc"))?ua.$O:null===ub||void 0===ub?void 0:ub.ColHeadersList,ub||La))if(!Va.JE)Va.JE=new x(ua);else if(ua)for(ua=Cl(ua.HeadersList),ub=ua.next();!ub.done;ub=ua.next())ub=ub.value,Va.JE.Z$.ia(ub.Index,ub.Name)}else if(Va=this.Mwb(ua.sheetName)){Va=new v(ua.type,ua.name,tb,Va,ua.attributes);if(2===Va.type)if(Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc")&&ua.$O)Va.JE=
new x(ua.$O);else if(ua=r.AUe(ua.name,K))Va.JE=new x(ua.ColHeadersList);La.ia(ub,Va)}else Q.ULS.sendTraceTag(537170117,0,50,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.$e.xb(this.currentStateId)&&this.$e.oa(this.currentStateId).Kj?this.$e.oa(this.currentStateId).Kj.length:0)}}};r.prototype.nZb=function(K,ba,ua,La,ub){var Va=K.getRowNumbers()[ba.row]-1;K=K.getColumnNumbers()[ba.col]-1;Va=r.eV("AddRangeUpdateCommand",this.gsb,Va,K,Va,K);K=null;var tb=
ba.formula||ba.text,Cb=excelOnlineCalc.calc.blankValue,nb=null;void 0!==ba.text&&null!==ba.text||void 0!==ba.value&&null!==ba.value||(ua="",nb="This cell contains blanks only",0===ba.formulaType&&(tb=""));switch(ba.valueType){case 2:null!==ua&&(0===ba.formulaType&&(K=excelOnlineCalc.calc.valueCellData(tb,ua,ba.ifmt,nb)),1===ba.formulaType&&(K=excelOnlineCalc.calc.cellFormulaCellData(tb,ua,ba.ifmt,nb)),2===ba.formulaType&&(K=excelOnlineCalc.calc.valueCellData("",Cb,0,"This cell is a part of an array")));
break;case 1:isNaN(La)?Q.ULS.sendTraceTag(537170116,0,50,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid numeric value",ba.row,ba.col):(0===ba.formulaType&&(K=excelOnlineCalc.calc.valueCellData(tb,La,ba.ifmt,null)),1===ba.formulaType&&(K=excelOnlineCalc.calc.cellFormulaCellData(tb,La,ba.ifmt,null)),2===ba.formulaType&&(K=excelOnlineCalc.calc.valueCellData("",Cb,0,"This cell is a part of an array")));break;case 3:isNaN(ub)?Q.ULS.sendTraceTag(537170115,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid boolean value",
ba.row,ba.col):(ua=1===ub?!0:!1,0===ba.formulaType&&(K=excelOnlineCalc.calc.valueCellData(tb,ua,ba.ifmt,null)),1===ba.formulaType&&(K=excelOnlineCalc.calc.cellFormulaCellData(tb,ua,ba.ifmt,null)),2===ba.formulaType&&(K=excelOnlineCalc.calc.valueCellData("",Cb,0,"This cell is a part of an array")));break;case 4:isNaN(ub)?Q.ULS.sendTraceTag(537170114,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid error value",ba.row,ba.col):(ua=excelOnlineCalc.calc.errorValue(ub),0===ba.formulaType&&
(K=excelOnlineCalc.calc.valueCellData(tb,ua,ba.ifmt,null)),1===ba.formulaType&&(K=excelOnlineCalc.calc.cellFormulaCellData(tb,ua,ba.ifmt,null)),2===ba.formulaType&&(K=excelOnlineCalc.calc.valueCellData("",Cb,0,"This cell is a part of an array")));break;default:K=excelOnlineCalc.calc.valueCellData("",Cb,ba.ifmt,null)}K&&(ba=excelOnlineCalc.calc.rangeWrite(Va,K,null,null),this.saa[this.saa.length]=ba)};r.prototype.WCg=function(K,ba){switch(ba.valueType){case 2:this.nZb(K,ba,this.nid(ba),null,0);break;
case 1:this.nZb(K,ba,null,parseFloat(ba.value),0);break;default:this.nZb(K,ba,null,null,parseFloat(ba.value))}};r.prototype.gne=function(K,ba){var ua=K.getRowNumbers()[ba.row]-1;K=K.getColumnNumbers()[ba.col]-1;ua=r.eV("AddRangeUpdateCommandEmptyCell",this.gsb,ua,K,ua,K);ba=excelOnlineCalc.calc.valueCellData("",excelOnlineCalc.calc.blankValue,ba.ifmt,null);ba=excelOnlineCalc.calc.rangeWrite(ua,ba,null,null);this.saa[this.saa.length]=ba};r.prototype.Mwb=function(K){K=this.xhd(K,this.currentStateId);
return 0<K?this.$e.oa(this.currentStateId).Kj[K].V7.sheetId:null};r.prototype.xhd=function(K,ba){if(!this.$e.xb(ba))return Q.ULS.sendTraceTag(537170113,0,15,"CalcAsyncEngine.GetSheetInternalIndex StateId:{0} does not exist in GridCache",ba),-1;var ua=this.$e.oa(ba);return ua.Kj?ua.getSheetIndex(K):(Q.ULS.sendTraceTag(537170112,0,15,"CalcAsyncEngine.GetSheetInternalIndex sheetsInformation == null for StateId:{0}",ba),-1)};r.prototype.Qtj=function(){if(!this.$e.xb(this.currentStateId)||!this.$e.oa(this.currentStateId).Kj.length)return Q.ULS.sendTraceTag(537170083,
0,15,"CalcAsyncEngine::SetSheetNamesAndUsedRanges() No sheets information for StateId:{0} or StateId does not exist in GridCache",this.currentStateId),!1;for(var K=[],ba=1;ba<this.$e.oa(this.currentStateId).Kj.length;ba++){var ua=this.$e.oa(this.currentStateId).Kj[ba];ua&&K.push(ua.V7)}this.Ym.updateSheetNames(this.currentStateId,K);this.Ym.updateUnusedCells(this.currentStateId,this.$e.oa(this.currentStateId).Ncg);return!0};r.prototype.setNumberFormats=function(){if(this.instantaneousSupportInformationManager){for(var K=
[],ba=Cl(this.instantaneousSupportInformationManager.Kca),ua=ba.next();!ua.done;ua=ba.next())ua=ua.value,ua=excelOnlineCalc.calc.numberFormat(ua.IfmtIndex,ua.FormatString,ua.Builtin),K.push(ua);this.Ym.setNumberFormats(K,!0)}};r.prototype.oqj=function(){if(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Ge){var K=this.ubi();if(!this.Iud||K)this.U4b(),this.instantaneousSupportInformationManager.Ge.TrueValueString&&(this.trueName=this.instantaneousSupportInformationManager.Ge.TrueValueString),
this.instantaneousSupportInformationManager.Ge.FalseValueString&&(this.falseName=this.instantaneousSupportInformationManager.Ge.FalseValueString),K=Oa.CalcHelper.ZEe(this.instantaneousSupportInformationManager,K),this.Ym.setLocale(K),this.Iud=!0}};r.prototype.Euj=function(){var K=null;if(void 0!==this.Rc.workbookContext.TimeZoneInformation&&null!==this.Rc.workbookContext.TimeZoneInformation){K=null;this.Rc.workbookContext.TimeZoneInformation.StandardDate.Month&&(K=excelOnlineCalc.date.dateTime(this.Rc.workbookContext.TimeZoneInformation.StandardDate.Year,
this.Rc.workbookContext.TimeZoneInformation.StandardDate.Month,this.Rc.workbookContext.TimeZoneInformation.StandardDate.Day,this.Rc.workbookContext.TimeZoneInformation.StandardDate.Hour,this.Rc.workbookContext.TimeZoneInformation.StandardDate.Minute,this.Rc.workbookContext.TimeZoneInformation.StandardDate.Second,this.Rc.workbookContext.TimeZoneInformation.StandardDate.DayOfWeek+1,this.Rc.workbookContext.TimeZoneInformation.StandardDate.Milliseconds,3));var ba=null;this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Month&&
(ba=excelOnlineCalc.date.dateTime(this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Year,this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Month,this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Day,this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Hour,this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Minute,this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Second,this.Rc.workbookContext.TimeZoneInformation.DaylightDate.DayOfWeek+1,this.Rc.workbookContext.TimeZoneInformation.DaylightDate.Milliseconds,
3));K=excelOnlineCalc.date.tzData(this.Rc.workbookContext.TimeZoneInformation.Bias,K,this.Rc.workbookContext.TimeZoneInformation.StandardBias,ba,this.Rc.workbookContext.TimeZoneInformation.DaylightBias)}else Q.ULS.sendTraceTag(537170082,0,15,"CalcAsyncEngine.SetWorkbookProperties: TimeZoneInformation is null");K=excelOnlineCalc.calc.workbookProps(this.Rc.workbookContext.F1904,this.Rc.workbookContext.FDateCompatibility,K);this.Ym.setWorkbookProps(K)};r.prototype.Roa=function(){var K=this;Aa.EwaSettings.ma(306)&&
eb.c(excelOnlineCalc.worker.runSmokeTest(1/0,this.b6f,!0)).continueWith(function(ub){ub.exception?Q.ULS.sendTraceTag(537170079,0,15,"CalcAsyncEngine.TryInitialize: calc smoke test failed: {0}",ub.exception.toString()):Q.ULS.sendTraceTag(537170080,0,50,"CalcAsyncEngine.TryInitialize: calc smoke test ended - a new one should start")});var ba=Aa.EwaSettings.ma(663)?t.local:t.HJj;if(Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:6311687_instantiateX10SingletonsInEwa")){var ua=Cl(Db.a.IR()?[excelOnlineCalc.x10.PluginSchedulerSingleton.instance(),
excelOnlineCalc.x10.GridImportManagerSingleton.instance()]:[void 0,void 0]),La=ua.next().value;ua=ua.next().value;this.Urc=eb.c(excelOnlineCalc.calc.createRecalcService(ba,La,ua))}else this.Urc=eb.c(excelOnlineCalc.calc.createRecalcService(ba,Db.a.IR()));this.Urc.continueWith(function(ub){ub.exception?Q.ULS.sendTraceTag(537170075,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker failed: {0}",ub.exception.toString()):(Q.ULS.sendTraceTag(537170078,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker is working as expected"),
K.Ym=K.Urc.result,K.Ym?K.Efb(0)?K.tsj():Q.ULS.sendTraceTag(537170077,0,15,"CalcAsyncEngine.TryInitialize: UpdateData failed to initialize"):Q.ULS.sendTraceTag(537170076,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker result is null"))})};r.prototype.ubi=function(){var K=this.instantaneousSupportInformationManager.Hja;if(!K||this.$Fd===K.length)return null;this.$Fd=K.length;return Oa.CalcHelper.MEe(K)};r.prototype.U4b=function(){this.errorTypeNames=Oa.CalcHelper.U4b()};r.prototype.wbi=function(){if(!(this.$e.xb(this.currentStateId)&&
0<this.$e.oa(this.currentStateId).Kj.length)){this.$e.ia(this.currentStateId,new B(this.vji));this.$e.oa(this.currentStateId).J0f(0,new u(null));for(var K=this.Rc.xa,ba=0;ba<K.count;ba++){var ua=Object(gb.a)(lc.a,K.getItem(ba));if(ua){void 0!==ua.sheetId&&null!==ua.sheetId&&void 0!==ua.name&&null!==ua.name&&ua.sheetId.length&&ua.sheetName.length||Q.ULS.sendTraceTag(537170074,0,15,"CalcAsyncEngine::InitializeGridForStateId() invalid sheet - index:{0} Id:{1} Hash:{2} NameLength:{3}",ba,ua.sheetId,ua.hash,
ua.name?ua.name.length:-1);var La=excelOnlineCalc.calc.sheetName(ua.sheetId,ua.name);this.$e.oa(this.currentStateId).J0f(ba+1,new u(La));La=ua.usedRange.iT();La=excelOnlineCalc.calc.rangeLocation(0,0,La.LastRow,La.LastColumn);ua=excelOnlineCalc.calc.unusedCellsUpdate(ua.sheetId,La);Array.add(this.$e.oa(this.currentStateId).Ncg,ua)}else Q.ULS.sendTraceTag(537170073,0,15,"CalcAsyncEngine.InitializeGridForStateId(): not sheet item for StateId:{0} sheet-index:{1}",this.currentStateId,ba)}}};r.prototype.rYg=
function(){for(var K=Cl(this.$e),ba=K.next();!ba.done;ba=K.next())ba=ba.value,ba.key<this.kq&&this.$e.remove(ba.key)};r.prototype.nid=function(K){K=K.value||K.text;if(void 0===K||null===K)K="";return K};r.prototype.Acg=function(){if(!this.$e.xb(this.currentStateId))return!1;var K=!1;Na.a.forEach(this.$e.oa(this.currentStateId).O_a,function(ba,ua){ua.Yvc||(K=!0)},null);return K};r.prototype.w4c=function(K){var ba={};ba.reason=K;ba.kind=1;return ba};r.prototype.Ehc=function(){return this.$e.xb(this.currentStateId)&&
this.$e.oa(this.currentStateId).Kj&&this.$e.oa(this.currentStateId).Kj[0]&&this.$e.oa(this.currentStateId).Kj[0].z6?!0:!1};r.P5g=function(K){var ba=[];if(null===K||void 0===K?0:K.Z$){K=Cl(K.Z$);for(var ua=K.next();!ua.done;ua=K.next())ua=ua.value,ua=excelOnlineCalc.calc.columnData(ua.key,ua.value),ba.push(ua)}return ba};r.jEi=function(K,ba){if(K.type!==ba.type||K.attributes!==ba.attributes||!wa.a.equals(K.fullName,ba.fullName,!1)||!K.range.equals(ba.range))return!1;if(!K.JE&&!ba.JE)return!0;if(!K.JE||
!ba.JE||K.JE.Z$.count!==ba.JE.Z$.count)return!1;var ua={};K=Cl(K.JE.Z$);for(var La=K.next();!La.done;ua={Lgb:ua.Lgb,Sgb:ua.Sgb},La=K.next())if(ua.Lgb=La.value,ua.Sgb=void 0,!(ua.Lgb.value&&function(ub){return function(){var Va=ba.JE.Z$.Nc(ub.Lgb.key);ub.Sgb=Va.value;return Va}}(ua)().returnValue&&ua.Sgb&&wa.a.equals(ua.Lgb.value,ua.Sgb,!1)))return!1;return!0};r.gVc=function(K,ba,ua){var La=r.eV("NamedObject",ba.sheetId,ba.range.top-1,ba.range.left-1,ba.range.bottom-1,ba.range.right-1);if(2===ba.type){var ub=
!!(ba.attributes&16),Va=!!(ba.attributes&8);ba=r.P5g(ba.JE);La=excelOnlineCalc.calc.namedTableData(La,ub,Va,ba);K=excelOnlineCalc.calc.namedObject(K,La)}else La=excelOnlineCalc.calc.namedRangeData(La),K=excelOnlineCalc.calc.namedObject(K,La);ua.push(K)};r.tYe=function(K){var ba=Sys.Serialization.JavaScriptSerializer.serialize(K.getRowNumbers());K=Sys.Serialization.JavaScriptSerializer.serialize(K.getColumnNumbers());return ba+K};r.V4b=function(K){var ba=null;if(1<K.length)for(var ua=1;ua<K.length;ua++)for(var La=
0;K[ua-1]+1+La<K[ua];)ba=ba||[],ba.push(K[ua-1]+La),La++;return ba};r.AUe=function(K,ba){if(!ba)return null;for(var ua=0,La=ba.length;ua<La;++ua)if(wa.a.equals(K,ba[ua].Name,!1))return ba[ua];return null};r.eV=function(K,ba,ua,La,ub,Va){function tb(Cb,nb,Ib,hb){(0>Ib||Ib>=hb)&&Q.ULS.sendTraceTag(537170072,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} invalid {1}:{2}",Cb,nb,Ib)}void 0!==ba&&null!==ba||Q.ULS.sendTraceTag(537170071,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} sheetId is null",
K);tb(K,"top",ua,r.yqf);tb(K,"left",La,r.$wd);tb(K,"bottom",ub,r.yqf);tb(K,"right",Va,r.$wd);return excelOnlineCalc.calc.sheetRangeLocation(ba,ua,La,ub,Va)};r.yqf=1048576;r.$wd=16384;Object(E.a)(r,"CalcAsyncEngine",null,[2]);Object(E.a)(y,"AbsoluteRelativeReferenceInfo",null,[]);var ib=b(1198),cc=b(25);h.yIf="#";Object(E.a)(h,"Operators",null,[]);var Pa=b(1199);w.sheet="Sheet";w.sheetRange="SheetRange";w.document="Document";w.h9h="Ident";Object(E.a)(w,"TraverseFormulaQualifierTypes",null,[]);var nc=
b(1200),pb=b(1088),rb=b(1002),Ya=b(55),ec=b(61),yd=b(567);n.prototype.dispose=function(){var K=this;Q.ULS.sendTraceTag(537170064,0,50,"CalcManager.Dispose called");this.$.da.$a(268,function(ba){ba.mKd(K.$nc);ba.dKd(K.Gnc)});this.gridView&&(this.gridView.gx(this.onContentReady),this.gridView.Ea&&this.gridView.Ea.FQf(this.qvf),this.cw=null);this.Ktf=this.Itf=this.FGc=null};n.prototype.gUg=function(K,ba,ua,La){La=void 0===La?null:La;this.Il&&(Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:5470583_Calculate_Formula_Refactoring")?
this.Il.dUg(K,ba,ua,La):this.Il.fUg(K,ba,ua,La))};n.prototype.evalFormula=function(K){return this.Il?this.Il.evalFormula(K):Promise.reject("calc engine not initialized")};n.prototype.evalFormulaRange=function(K,ba,ua){return this.Il?this.Il.evalFormulaRange(K,ba,ua):Promise.reject("calc engine not initialized")};n.prototype.Jtb=function(K,ba,ua,La){return this.Il?this.Il.Jtb(K,ba,ua,La):Promise.reject("CalcEngine is null")};n.prototype.V4a=function(K){return this.Il?(Q.ULS.shipAssertTag(537170059,
0,2===K.type,"CalcManager.GetTableHeaders() - ActiveItem is not a table"),this.Il.V4a(K)):null};n.prototype.xJg=function(K,ba){if(!ba||2!==K.type)return!1;K=pc.a(K);return K.right-K.left+1===ba.count};n.prototype.aTe=function(K){if(!this.eGb)return this.Tgg||Q.ULS.sendTraceTag(537170057,0,15,"CalcManager.ExtractReferenceWrappers - parser not initialized"),null;var ba=this.zta(cc.Range.hd(1,1));ba=this.eGb.parseFormula(excelOnlineCalc.parse.parseLocals(1,ba.range),K);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(ba))return Q.ULS.sendTraceTag(537170056,
0,10,"CalcManager.ExtractReferenceWrappers - ParseFormula failed"),null;try{if(Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesHighlighting",!1)){var ua=this.gridView.ha.ta.activeCell,La=excelOnlineCalc.location.gridCell(ua.top-1,ua.left-1),ub=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName),Va=excelOnlineCalc.location.sheetIndex(ub,this.$.xa.qa.sheetId),tb=this.i$g(La,Va);this.kMd||(this.kMd=excelOnlineCalc.util.createResolver(this.h$g()));
var Cb=excelOnlineCalc.parse.parseResultHelper.extractReferences(ba,this.Ur.config.localeInfo,Aa.EwaSettings.ma(603),tb,this.kMd)}else Cb=excelOnlineCalc.parse.parseResultHelper.extractReferences(ba,this.Ur.config.localeInfo,Aa.EwaSettings.ma(603));Aa.EwaSettings.ma(103)&&this.xTj(Cb,K);return Cb}catch(nb){return Q.ULS.sendTraceTag(537170055,0,10,"CalcManager.ExtractReferenceWrappers - exception: {0}",nb.message),null}};n.prototype.extractLetVariables=function(K,ba){if(!this.eGb)return this.Tgg||
Q.ULS.sendTraceTag(537170054,0,15,"CalcManager.ExtractLetVariables - parser not initialized"),null;var ua=this.zta(cc.Range.hd(1,1));K=this.eGb.parseFormula(excelOnlineCalc.parse.parseLocals(1,ua.range),K);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(K))return Q.ULS.sendTraceTag(537170053,0,10,"CalcManager.ExtractLetVariables - ParseFormula failed"),null;try{return excelOnlineCalc.parse.parseResultHelper.extractLetVariables(K,ba,this.Ur.config.localeInfo)}catch(La){return Q.ULS.sendTraceTag(537170052,
0,10,"CalcManager.ExtractLetVariables - exception: {0}",La.message),null}};n.prototype.extractReferences=function(K,ba,ua,La){if(!ba)return Q.ULS.sendTraceTag(537170051,0,10,"CalcManager.ExtractReferences - sheetName is null"),null;if(!ua)return Q.ULS.sendTraceTag(537170050,0,10,"CalcManager.ExtractReferences - documentName is null"),null;var ub=this.aTe(K);if(!ub)return Q.ULS.sendTraceTag(537170049,0,15,"CalcManager.ExtractReferences - ExtractReferenceWrappers returned null"),null;try{return this.h9g(ub,
ba,ua,K,La)}catch(Va){return Q.ULS.sendTraceTag(537170048,0,10,"CalcManager.ExtractReferences - exception: {0}",Va.message),null}};n.prototype.WZh=function(K,ba,ua,La){if(!K)return Q.ULS.sendTraceTag(537170019,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - range is null"),null;if(!ba||0>=ba.length)return Q.ULS.sendTraceTag(537170018,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - formula is null/empty"),null;K=this.zta(K);if(!this.Ur||!K)return null;var ub=
this.yvb(K).returnValue;if(!ub||ub.J6a)return null;ua=excelOnline.utils.getCharIndexInTextFromPoint(ua,La,Aa.EwaSettings.ma(603));return 0>ua?null:excelOnlineCalc.runtime.getSubExpressionFromFormulaCharacterIndex(this.Ur.config,ua,ba,K)};n.prototype.VTg=function(K,ba,ua,La){var ub=this;if(!K)return Q.ULS.sendTraceTag(537170017,0,10,"CalcManager.CalcPartialResultsForFormula - range is null"),null;var Va=null;return this.evalFormula(ba).then(function(tb){var Cb=ub.Ur.Smh(tb,ua),nb=Cb.returnValue;8!==
Cb.kind||nb.length&&nb!==Oa.CalcHelper.unknownError?tb=0:(Q.ULS.sendTraceTag(537170016,0,50,"EvalSession.GetPartialResultValueForFormula - EvalResultToString error"),tb=excelOnlineCalc.calc.getEvalFailureReason(tb),void 0!==tb&&null!==tb||Q.ULS.shipAssertTag(537170015,0,!1,"CalcHelper.GetEvalFailureReason() - result is not a failure, function should not be called"),tb=1);return Va=La?new ib.a(nb,La.start,La.end,tb):new ib.a(nb,-1,-1,tb)},function(tb){Q.ULS.sendTraceTag(537170014,0,10,"EvalSession.GetPartialResultValueForFormula - exception: {0}",
tb);return Promise.resolve(Va)})};n.prototype.getSubExpressionSpan=function(K){return this.Ur&&K?excelOnlineCalc.runtime.getSubExpressionSpan(K):null};n.prototype.getFormulaSubExpressionObject=function(K,ba,ua){return this.Ur&&K&&ba&&ua?excelOnlineCalc.runtime.getFormulaSubExpressionObject(this.Ur.config,ba,ua,this.zta(K)):null};n.prototype.ZZh=function(K,ba,ua){return this.Ur&&K&&ba?excelOnlineCalc.runtime.getSubstitutedSubExpressionString(this.Ur.config,ba,ua,this.zta(K)):null};n.prototype.XZh=
function(K,ba,ua){return this.Ur&&K&&ba?excelOnlineCalc.runtime.getSubExpressionSubspans(this.Ur.config.localeInfo,ba,ua):null};n.prototype.nTh=function(){return this.Ur?this.Ur.config.localeInfo.listSeparator:null};n.prototype.isFormulaSubExpressionVolatile=function(K){return this.Ur?excelOnlineCalc.runtime.isFormulaSubExpressionVolatile(this.Ur.config.localeInfo,K):!1};n.prototype.zta=function(K,ba){ba=void 0===ba?!0:ba;return K&&this.Ur?this.Ur.G$g(this.Ur.sbh(),K.top-1,K.left-1,ba):null};n.prototype.kji=
function(K,ba){K=this.lcc(K);if(void 0===K||null===K)return null;K=this.Eo.createFormat(K.FormatString,K.Builtin);if(!excelOnlineCalc.util.isSuccess(K))return null;ba=this.Eo.parseEdit(ba,K.value);return excelOnlineCalc.util.isSuccess(ba)?ba.value.kind===pb.a.formula:null};n.prototype.sgd=function(K){if(!K.isValid())return Q.ULS.sendTraceTag(537170013,0,50,"CalcManager.GetNumberFormat: invalid format was given! ifmt: {0}, format string: {1}, format obj: {2}",null!=K.eR?K.eR.toString():"null",K.formatString?
wa.a.HJ(K.formatString):"null",K.numberFormat?"!null":"null"),null;var ba=K.XRh();if("String"===Object.getType(ba).getName())var ua=this.Ktf;else if("Number"===Object.getType(ba).getName())ua=this.Itf;else return Q.ULS.sendTraceTag(537170012,0,10,"CalcManager.GetNumberFormat: key is of unknown type!"),null;ba=ba.toString();if(ba in ua)return ua[ba].numberFormat;ua[ba]=K;return K.numberFormat};n.prototype.jcc=function(K){if(null==this.Eo)return Object(yd.a)("Number formatter is null");if(null==this.instantaneousSupportInformationManager)return Object(yd.a)("Instantaneous manager is null");
if(this.Hzd.has(K))return Object(yd.d)(this.Hzd.get(K));if("number"===typeof K){var ba=this.lcc(K);if(null==ba)return Object(yd.a)("Invalid ifmt="+K);var ua=ba.FormatString;ba=ba.Builtin}else ua=K,ba=!1;ua=this.Eo.createFormat(ua,ba);return excelOnlineCalc.util.isSuccess(ua)?(this.Hzd.set(K,ua.value),Object(yd.d)(ua.value)):Object(yd.a)("Could not create number format")};n.prototype.getWorksheetFuncId=function(K){return this.localeInfo.getWorksheetFuncId(K)};n.prototype.h9g=function(K,ba,ua,La,ub){for(var Va=
{Items:[]},tb=0;tb<K.length;tb++){var Cb=K[tb],nb={};nb.Start=Cb.span.start;nb.End=Cb.span.end;if(ub||Cb.kind!==Pa.a.func)if(ub||Cb.kind!==Pa.a.tti){if(this.hih(Cb,ba,ua)){var Ib=new y,hb=this.UWh(Cb,ba,Ib,La);if(Aa.EwaSettings.ma(603)){var zb=this.dTh(Cb),Gc=this.cTh(Cb);if(hb||Gc&&0<=zb)nb={Span:nb,LetNumber:zb,LetName:Gc,Range:hb},nb.IsRangeRef=Ib.t7a,nb.IsAbsoluteFirstRow=Ib.Qwa,nb.IsAbsoluteFirstColumn=Ib.Pwa,nb.IsAbsoluteSecondRow=Ib.jMa,nb.IsAbsoluteSecondColumn=Ib.iMa,nb.IsStructRef=Cb.kind===
Pa.a.dVd,Va.Items.push(nb)}else hb&&(nb={Span:nb,Range:hb},nb.IsRangeRef=Ib.t7a,nb.IsAbsoluteFirstRow=Ib.Qwa,nb.IsAbsoluteFirstColumn=Ib.Pwa,nb.IsAbsoluteSecondRow=Ib.jMa,nb.IsAbsoluteSecondColumn=Ib.iMa,nb.IsStructRef=Cb.kind===Pa.a.dVd,Va.Items.push(nb))}}else Cb=Cb.ref.value.oper.kind,Va.Items.push({Span:nb,IsString:2===Cb,IsBoolean:4===Cb,IsNumber:1===Cb});else nb.End=Cb.span.start+Cb.ref.name.length,Cb={Span:nb,IsFunction:!0},Cb.FunctionId=this.getWorksheetFuncId(La.substring(nb.Start,nb.End)),
Va.Items.push(Cb)}Va.Items.sort(function(Fc,Ed){return Fc.Span.Start-Ed.Span.Start});return Va};n.prototype.dTh=function(K){return K.kind===Pa.a.qlf?K.ref.number:-1};n.prototype.cTh=function(K){return K.kind===Pa.a.qlf?K.ref.name:null};n.prototype.UWh=function(K,ba,ua,La){if(K.kind===Pa.a.range)return ua.t7a=!0,this.cDe(K,ba,ua,La);if(K.kind===Pa.a.namedRange){ua=K.ref;(K=this.$.Hb.getItemByName(ua.name))||(K=this.$.Hb.getItemByName(ba+"!"+ua.name));if(!(K&&K.sheetName&&K.usedRange&&wa.a.equals(K.sheetName,
ba,!0)))return null;ba=2===K.type?pc.a(K):K.usedRange;return Wa.m(ba,K)}if(K.kind===Pa.a.dVd){var ub=K.ref,Va;ub.name?(Va=this.$.Hb.getItemByName(ub.name))||(Va=this.$.Hb.getItemByName(ba+"!"+ub.name)):Va=this.gridView.Rb.Qj(this.gridView.ha.ta.activeCell);if(!(Va&&Va.sheetName&&Va.usedRange&&wa.a.equals(Va.sheetName,ba,!0)))return null;ua.t7a=!1;return this.cDe(K,ba,ua,La)}return null};n.prototype.cDe=function(K,ba,ua,La){K=K.ref;if(K.type){if(K.type===nc.a.column){var ub=K.startIndex;K=K.endIndex;
ua.Pwa=ub.kind===rb.a.abs;ua.iMa=K.kind===rb.a.abs;return this.createRange(0,ub.index,H.a.Ih,K.index,ba)}if(K.type===nc.a.row)return ub=K.endIndex,ua.Qwa=K.startIndex.kind===rb.a.abs,ua.jMa=ub.kind===rb.a.abs,this.createRange(K.startIndex.index,0,K.endIndex.index,H.a.Qh,ba);if(K.type===nc.a.cell){ub=K.row;var Va=K.col;ua.Qwa=ua.jMa=ub.kind===rb.a.abs;ua.Pwa=ua.iMa=Va.kind===rb.a.abs;return this.l2b(K.span.end,La)&&(ua=cc.Range.hd(ub.index+1,Va.index+1),ua=this.gridView.Rb.Q3e(ua))?Wa.n(ua,ba):this.createRange(ub.index,
Va.index,ub.index,Va.index,ba)}if(K.type===nc.a.range){ub=K.top;Va=K.left;La=K.bottom;K=K.right;var tb=Math.min(ub.index,La.index),Cb=Math.min(Va.index,K.index),nb=Math.max(ub.index,La.index),Ib=Math.max(Va.index,K.index);ua.Qwa=ub.kind===rb.a.abs;ua.jMa=La.kind===rb.a.abs;ua.Pwa=Va.kind===rb.a.abs;ua.iMa=K.kind===rb.a.abs;return this.createRange(tb,Cb,nb,Ib,ba)}Q.ULS.sendTraceTag(537170010,0,10,"CalcManager.CovertFormulaRefToRange: Unsupported formula ref type '{0}'",K.type);return null}Q.ULS.sendTraceTag(537170011,
0,15,"CalcManager.CovertFormulaRefToRange: traverseFormulaRef.Type is null");return null};n.prototype.l2b=function(K,ba){return ba.length>=K&&0<K&&ba.charAt(K-1)===h.yIf};n.prototype.aUg=function(K,ba,ua){this.Il&&this.Il.eUg(K,ba,ua)};n.prototype.lcc=function(K){return this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Kca&&this.instantaneousSupportInformationManager.Kca[K]&&this.Eo?this.instantaneousSupportInformationManager.Kca[K]:null};n.prototype.toXLNumber=
function(K){if(!this.Eo)return null;K=excelOnlineCalc.numfmt.toXLNumber(this.config.mathpack,this.Eo,K);return excelOnlineCalc.util.isSuccess(K)?K.value:null};n.prototype.xTj=function(K,ba){if(K){K=Cl(K);for(var ua=K.next();!ua.done;ua=K.next())if(ua=ua.value,ua.ref.type&&ua.ref.type===nc.a.cell){var La=ua.ref;n.$_i(La,ba)&&(La.span.end+=1,ua.span.end+=1)}}};n.prototype.createRange=function(K,ba,ua,La,ub){var Va={};Va.FirstRow=K;Va.FirstColumn=ba;Va.LastRow=ua;Va.LastColumn=La;Va.SheetName=ub;return Va};
n.prototype.hih=function(K,ba,ua){var La=K.ref.qualifier;if(!La)return!0;switch(K.ref.qualifier.type){case w.sheet:return K=La.document,wa.a.equals(La.sheet,ba,!0)&&(!K||wa.a.equals(K.document,ua,!0));case w.sheetRange:return ba=this.$.xa.getItemByName(ba),ua=this.$.xa.getItemByName(La.sheet1),La=this.$.xa.getItemByName(La.sheet2),!!ba&&!!ua&&!!La&&(ua.index<=ba.index&&ba.index<=La.index||La.index<=ba.index&&ba.index<=ua.index);case w.document:return wa.a.equals(La.document,ua,!0);case w.h9h:return La=
La.name,wa.a.equals(La,ba,!0)||wa.a.equals(La,ua,!0);default:return Q.ULS.sendTraceTag(537170009,0,10,"CalcManager.GetQualifierData: Unsupported formula qualifier type '{0}'",La.type),!1}};n.prototype.fOj=function(K){this.instantaneousSupportInformationManager=K;K.Kca.length&&K.Hja.length?(this.FGc=new Oa.CalcHelper(this.gridView.$),this.eGb=this.Ur.createParser(),this.jde=this.Ur.createNumberFormatter(),this.Qcf=!0,Q.ULS.sendTraceTag(537170007,0,50,"CalcManager.TryInitializeInternal: calc initialized"),
this.Il||(Q.ULS.sendTraceTag(537170006,0,50,"CalcManager creating calc engine"),this.Il=new r(this.$))):Q.ULS.sendTraceTag(537170008,0,15,"CalcManager.TryInitializeInternal: IInstantaneousSupportInformationManager locale information missing, cannot initialize calc. number formats count = {0}, functions info count = {1}",K.Kca.length,K.Hja.length.toString())};n.prototype.yvb=function(K){if(!K)return{returnValue:null,emptyCell:!1};var ba=this.getSheetName(K.sheet.index);if(!ba)return Q.ULS.sendTraceTag(537169998,
0,50,"CalcManager.GetCellFromBlockCache: No sheet index {0}",K.sheet.index),{returnValue:null,emptyCell:!1};var ua=n.convertToRange(K);ba=this.gridView.yvb(ba,ua.top,ua.left);return ba?ba.cih?{returnValue:ba,emptyCell:!1}:(Q.ULS.sendTraceTag(537169996,0,50,"CalcManager.GetCellFromBlockCache: cell {0} {1} is empty",K.range.row,K.range.col),{returnValue:null,emptyCell:!0}):(Q.ULS.sendTraceTag(537169997,0,50,"CalcManager.GetCellFromBlockCache: cellProxy is null for cell {0} {1}",K.range.row,K.range.col),
{returnValue:null,emptyCell:!1})};n.prototype.getSheetName=function(K){var ba=this.gridView.$.xa.getItem(K);return ba?ba.sheetName:(Q.ULS.sendTraceTag(537169995,0,50,"CalcManager.GetSheetName - no sheet in index {0}",K),null)};n.prototype.i$g=function(K,ba){var ua={allowUnqualifiedCell:!0,wrapCellReferences:!0};ua.config=this.Ur.config;ua.originGridCell=excelOnlineCalc.util.success(K);ua.originSheet=excelOnlineCalc.util.success(ba);return ua};n.prototype.h$g=function(){var K={};K.config=this.Ur.config;
K.getNameLoc=Object(ra.a)(this.Il,this.Il.getNameLoc,"getNameLoc");K.getContainingTable=Object(ra.a)(this.Il,this.Il.getContainingTable,"getContainingTable");K.getStructRefColumn=Object(ra.a)(this.Il,this.Il.getStructRefColumn,"getStructRefColumn");K.getStructRefSpecialRef=Object(ra.a)(this.Il,this.Il.getStructRefSpecialRef,"getStructRefSpecialRef");K.getDocumentLoc=Object(ra.a)(this.Il,this.Il.getDocumentLoc,"getDocumentLoc");K.getSheetIndex=Object(ra.a)(this.Il,this.Il.getSheetIndex,"getSheetIndex");
K.getSheetName=Object(ra.a)(this.Il,this.Il.getSheetName,"getSheetName");K.getUserDefinedFuncLoc=Object(ra.a)(this.Il,this.Il.getUserDefinedFuncLoc,"getUserDefinedFuncLoc");K.getSheetRangeIndexes=Object(ra.a)(this.Il,this.Il.getSheetRangeIndexes,"getSheetRangeIndexes");return K};n.$_i=function(K,ba){return ba.length>K.span.end&&ba.charAt(K.span.end)===h.yIf};n.convertToRange=function(K){return cc.Range.hd(K.range.row+1,K.range.col+1)};Ck.Object.defineProperties(n.prototype,{Ur:{configurable:!0,enumerable:!0,
get:function(){return this.FGc}},gridView:{configurable:!0,enumerable:!0,get:function(){return this.cw}},$:{configurable:!0,enumerable:!0,get:function(){return this.wb}},Eo:{configurable:!0,enumerable:!0,get:function(){return this.jde}},localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.Ur?this.Ur.config.localeInfo:null}},config:{configurable:!0,enumerable:!0,get:function(){return this.Ur.config}}});Object(E.a)(n,"CalcManager",null,[786,2]);var Ub=b(36),Ob=b(54),Yb=ea.a;Am(m,Yb);
m.prototype.create=function(){var K=this;if(this.$){Q.ULS.sendTraceTag(537169993,0,50,"CalcManagerFactory.Create: Start loading script");if(Aa.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")){var ba=53;var ua="Current"}else ba=56,ua="Stable";Q.ULS.sendTraceTag(537169992,0,50,"CalcManagerFactory.Create: Calc {0} JS was loaded",ua);Ub.TaskExtensions.Ba(Ob.a.loadScript(ba,4,this.ub,void 0,void 0,265),function(){Q.ULS.sendTraceTag(537169991,0,50,"CalcManagerFactory.Create: Raised create service event");
var La=K.$.da.Aa(266,!1);La||(Q.ULS.sendTraceTag(537169990,0,50,"CalcManagerFactory.Create: CalcManager is not registered, creating new CalcManager"),La=new n(K.$));K.Eb(La)},this.la,3)}else Q.ULS.sendTraceTag(537169994,0,50,"CalcManagerFactory.Create: ewaControl is null, cann't create the service")};m.ka=function(K){K&&K.da&&K.da.Ga(265,new m(K))};Object(E.a)(m,"CalcManagerFactory",ea.a,[]);var xb=b(7),Sa=b(5),Tb=b(338);Object(E.a)(f,"MarqueeMetadata",null,[]);var Cc=b(142),Fb=b(697),hc=b(354);e.prototype.$X=
function(K,ba){this.Cki&&K.textBox.addEventLogRecord("ColoredReferencesManager.TryUpdateColoredReferences");if(this.F8f||K.AK)return!1;var ua=void 0===ba||null===ba?K.text:ba;if(this.calcManager&&1<ua.length&&db.e(ua)){var La=this.Ggd(),ub=this.V1e(),Va=this.Rc.workbookContext.WorkbookFileName,tb=!1,Cb=.01>Math.random()?Object(gb.a)(Cc.a,this.Rc.Ob.Hc("LoadingUIShown","ColoredReferencesManager")):null;try{var nb=this.calcManager.extractReferences(ua,ub,Va,!this.ucf);if(!nb)return Q.ULS.sendTraceTag(524039689,
0,50,"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),!1;ub=[];Va=[];for(var Ib=[],hb=[],zb=0,Gc=0,Fc=new xa.a(!1),Ed="",Jc=Cl(nb.Items),Ca=Jc.next();!Ca.done;Ca=Jc.next()){var bb=Ca.value;tb=bb.IsStructRef||tb;if(bb.IsBoolean||bb.IsNumber||bb.IsString){var dc=bb.IsBoolean?e.sPg:bb.IsNumber?e.EFi:e.PGj;this.bGa(Va,ua,zb,bb.Span.Start,null);this.bGa(Va,ua,bb.Span.Start,bb.Span.End,dc);zb=bb.Span.End}else if(Aa.EwaSettings.ma(603)){if(bb.Range||
bb.LetName&&0<=bb.LetNumber){nb=null;if(bb.Range){var Ac=Wa.D(bb.Range);nb=this.Evb(Ac,Fc,1);ub.push(new hc.a(Ac,La))}else bb.LetName&&0<=bb.LetNumber&&(nb=Ed=this.vMh(bb.LetName,bb.LetNumber,Fc,Ed),Gc!==Fc.count&&K.colors.add(bb.Span.Start+"-"+bb.Span.End,this.colors[(Fc.count-1)%this.colors.length]));this.bGa(Va,ua,zb,bb.Span.Start,null);this.bGa(Va,ua,bb.Span.Start,bb.Span.End,nb);zb=bb.Span.End;Ib.push(bb.Span);var nd=Va.length-1;hb.push(new f(nd,Va[nd].text,bb));Gc=Fc.count}}else if(bb.Range){var qd=
Wa.D(bb.Range),Gb=this.Evb(qd,Fc,1);this.bGa(Va,ua,zb,bb.Span.Start,null);this.bGa(Va,ua,bb.Span.Start,bb.Span.End,Gb);ub.push(new hc.a(qd,La));zb=bb.Span.End;Ib.push(bb.Span);var Oc=Va.length-1;hb.push(new f(Oc,Va[Oc].text,bb))}}this.bGa(Va,ua,zb,ua.length,null);this.luj(K,Va,!!ba);var he=K.textBox.text;if(!wa.a.equals(he,ua,!1)){Q.ULS.shipAssertTag(38114182,0,!1,"ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [{0}], originalTextLength [{1}]",
he.length,ua.length);var Wd=K.textBox.caretPosition;K.textBox.text=ua;K.textBox.caretPosition=Wd;return!0}this.Dec(ub,Fc,hb);Aa.EwaSettings.ma(603)&&0<ub.length&&Q.ULS.sendTraceTag(524039688,0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored");Aa.EwaSettings.ma(603)&&0<K.colors.count&&Q.ULS.sendTraceTag(524039687,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored");return this.e6a=!0}finally{Cb&&Cb.sBa(function(){tb&&Q.ULS.sendTraceTag(524039686,
0,50,"ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in {0} ms",Cb.zc)})}}else return this.Dec(null,null),this.e6a&&(this.e6a=!1,La=K.textBox.caretPosition,K.textBox.setPlainText(ua),K.textBox.caretPosition=Math.min(La,ua.length),ba)?!0:!1};e.prototype.Frf=function(K,ba,ua){if(!K||!ba||!ua)return Q.ULS.shipAssertTag(524039685,0,!!K,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),Q.ULS.shipAssertTag(524039684,0,!!ba,"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),
Q.ULS.shipAssertTag(524039683,0,!!ua,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),!1;var La=Object(gb.a)(f,ba.metadata);if(!La)return Q.ULS.shipAssertTag(524039682,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),!1;var ub=La.rJj,Va=La.K9f,tb=this.gridView.Rb.Qdf(ua)?ua.sbc(La.Pwa,La.Qwa):ua.N4a(La.Pwa,La.Qwa,La.iMa,La.jMa);if(!tb)return Q.ULS.shipAssertTag(524039681,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),!1;var Cb=Va.indexOf("!");
-1!==Cb&&(tb=Va.substring(0,Cb+1)+tb);if(!K.textBox.changeTextInExistingTextPart(ub,Va,tb))return Q.ULS.shipAssertTag(38926105,0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;La.K9f=tb;ub=!0;for(Va=1;4>=Va;Va++)(tb=sb.g(this.Rc).Cb.Jw(3,Va,ba.aaa))?(tb.range=ua,tb.metadata=La):(Q.ULS.shipAssertTag(524039680,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null"),ub=!1);this.gridView.Cb.update(!1,!1);this.gridView.Fj&&(this.gridView.Ac.textBox.text=
K.text);this.gridView.Ac.fHb(new Tb.a({pzb:!0}));return ub};e.prototype.Gki=function(K){if(3!==K.ur)return Q.ULS.shipAssertTag(524039651,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;K=Object(gb.a)(f,K.metadata);return K?K.t7a&&!K.cic:(Q.ULS.shipAssertTag(524039650,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)};e.prototype.Ceb=function(K,ba){Q.ULS.sendTraceTag(524039649,0,50,"ColoredReferencesManager.SuspendResumeColoredReferences: "+
(ba?"suspending":"resuming")+" colored references");ba&&this.e6a&&(this.e6a=!1,this.Dec(null,null),K.textBox.OYg());this.F8f=ba};e.prototype.dispose=function(){this.gridView&&this.gridView.rc&&this.gridView.rc.Zn(this.gEb)};e.prototype.e8h=function(K){var ba=this.Ggd(),ua=this.V1e(),La=this.Rc.workbookContext.WorkbookFileName,ub=[],Va=new xa.a(!1),tb=[];if(ua=this.calcManager.extractReferences(K,ua,La,!this.ucf)){ua=Cl(ua.Items);for(La=ua.next();!La.done;La=ua.next())if(La=La.value,La.Range){var Cb=
Wa.D(La.Range);ub.push(new hc.a(Cb,ba));this.Evb(Cb,Va,1);tb.push(new f(La.Span.Start,K.substring(La.Span.Start,La.Span.End),La,!0))}this.Dec(ub,Va,tb)}};e.prototype.Evb=function(K,ba,ua){var La=ba.getItem(K.toString());La||(La=this.colors[ba.count%this.colors.length],ba.add(K.toString(),La));return String.format(La,ua)};e.prototype.vMh=function(K,ba,ua,La){K="["+K+", "+ba+"]";ba=ua.getItem(K);ba||(ba=ua.count%this.colors.length,ba=this.colors[ba],La===String.format(ba,1)&&(ua.add("skip-"+K,ba),ba=
ua.count%this.colors.length,ba=this.colors[ba]),ua.add(K,ba));return String.format(ba,1)};e.prototype.bGa=function(K,ba,ua,La,ub){Q.ULS.shipAssertTag(524039648,0,ua<=La,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex");ua<La&&(ba=ba.substring(ua,La),K.push(Object(xb.a)(new Fb.a,{text:ba,color:ub})))};e.prototype.Dec=function(K,ba,ua){var La=this;ua=void 0===ua?null:ua;K&&K.length?(Q.ULS.sendTraceTag(524039647,0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+
K.length),K.reverse(),ua.reverse(),this.gridView.Cb.lx(K,[3],!0,function(ub,Va){if(ub&&ub.range&&Va){Q.ULS.shipAssertTag(524039643,0,ba.xb(ub.range.toString()),"ColoredReferencesManager.HighlightRanges: The range '{0}' doesn't exist in the range to color dictionary",ub.range.toString());var tb=La.Evb(ub.range,ba,.1),Cb=La.Evb(ub.range,ba,1);La.Rc.frame&&La.Rc.frame.OH&&La.Rc.frame.OH.$ka||(Va.style.background=tb);Va.style.borderColor=Cb;ua&&(Va.setAttribute(Sa.a.ryb,ub.aaa.toString()),ub.metadata=
ua[ub.aaa])}else Q.ULS.shipAssertTag(524039646,0,!!ub,"ColoredReferencesManager.HighlightRanges: state is null"),Q.ULS.shipAssertTag(524039645,0,!!ub.range,"ColoredReferencesManager.HighlightRanges: state.Range is null"),Q.ULS.shipAssertTag(524039644,0,!!Va,"ColoredReferencesManager.HighlightRanges: div is null")})):(K=this.Rc.Ob.Hc("UserAction","HideRangesHighlightsStopwatch"),this.gridView.Cb.Xh([3]),this.gridView.Cb.TKb(new hc.a(null,this.Ggd()),[3]),K.stop())};e.prototype.luj=function(K,ba,ua){var La=
K.textBox;La.tK=!0;var ub=La.selection,Va=ub.index;ub=Va+ub.length;La.setTextFromTextParts(ba);ba=La.text.length;La.selectRange(Math.min(Va,ba),Math.min(ub,ba));ua&&K.fHb(new Tb.a);La.tK=!1};e.prototype.Ggd=function(){return this.U1e().sheetId};e.prototype.V1e=function(){return this.U1e().sheetName};e.prototype.U1e=function(){return this.gridView.ut&&this.gridView.ut.cL?this.gridView.ut.cL:this.Rc.qa};e.EFi="rgba(9, 134, 88, 1)";e.sPg="rgba(0, 0, 255, 1)";e.PGj="rgba(163, 21, 21, 1)";Object(E.a)(e,
"ColoredReferencesManager",null,[783,2]);var cd=ea.a;Am(c,cd);c.prototype.create=function(){var K=this;this.$.da.$a(266,function(ba){ba=Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ServiceInit",!1)?K.$.da.Aa(281)||K.$.da.Ga(281,new e(K.$,ba)):new e(K.$,ba);K.Eb(ba)})};c.ka=function(K){K.da.Ga(282,new c(K))};Object(E.a)(c,"ColoredReferencesManagerFactory",ea.a,[]);var mb=b(1013),$a=ea.a;Am(a,$a);a.prototype.create=function(){var K=this;this.$.da.$a(266,function(ba){ba=Aa.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ServiceInit",
!1)?K.$.da.Aa(294)||K.$.da.Ga(294,new mb.RelativeAndAbsoluteReferencesManager(ba)):new mb.RelativeAndAbsoluteReferencesManager(ba);K.Eb(ba)})};a.ka=function(K){K.da.Ga(295,new a(K))};Object(E.a)(a,"RelativeAndAbsoluteReferencesManagerFactory",ea.a,[]);Type.registerNamespace("_Ewa");z.a.Fa(A.ka);z.a.Fa(m.ka);z.a.Fa(c.ka);z.a.Fa(a.ka)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.calc.js.map/9a34b47d1ddbcdfd63253c104d0afced/EwaDS.calc.js.map