(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1050:function(z,E,b){function a(qa){var wa=this;qa=void 0===qa?null:qa;this.yT=0;this.xP=null;this.xvg=0;var Ta=ka.a.Ae();this.Vqg=this.Seh(qa).then(function(sb){return sb?wa.t$h():(u.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",wa.ov(),Math.floor(ka.a.Ae()-Ta)),sb=ha.a.Yr(),void 0!==sb&&null!==sb&&(sb.set("AuthLibrary",wa.ov()),sb=Object.assign(new va.a,
{durationMs:Math.floor(ka.a.Ae()-Ta),extendedProperties:sb}),na.Health.instance.recordKpiFailure(a.kpiName,"StrategyPickFailed",!1,!0,sb)),Promise.resolve(1))}).then(function(sb){return 0!==sb?Promise.resolve(sb):wa.yti()})}function c(qa){this.fQc=qa;this.hYa="UnsupportedAuthTokenStrategy Reason="+v.a[this.fQc]}function e(){this.Ms=null;this.qTb=0;this.xkb=this.vYa=this.UFc=this.hEa=this.qM=this.Dje=null;this.Zv=new aa.a(null,null);this.YXb=M.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",
!1);this.hYa="SharedAuthTokenStrategy "+(this.YXb?"BrowserAuth 1.20210701.2/MSAL 2.11.0":"BrowserAuth 1.20210426.1/MSAL 2.11.0");this.PY=T.a.Yvj;this.Dhe=T.a.Xvj;this.Z6d=T.a.enableConsoleLogging;this.Eog=M.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.gxg=M.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.YXb);this.rra={};this.frg=new n(1500)}function f(qa,wa,Ta,sb,db,kb,ac){var ta=
fa.call(this,!1,!1,!0)||this;ta.d2=null;ta.n6d=null;ta.PY=qa;ta.Oug=Ta;ta.Zv=sb;ta.Iyg=db;ta.hEa=kb;ta.Ms=document.createElement("iframe");ta.Ms.id="SharedAuthInteractiveFrame";ta.Ms.setAttribute("name","SharedAuthInteractiveFrame");ta.Ms.setAttribute("title","SharedAuthInteractiveFrame");ta.Ms.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");ta.Ms.style.border="0";ta.Ms.style.height="48px";ta.Ms.style.width="190px";$addHandler(ta.Ms,"error",Object(ea.a)(ta,ta.PSi,
"onSharedAuthFrameError"));qa=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",ta.PY,wa,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",M.AFrameworkApplication.userType);ac&&(qa+="&vnext=1");ta.Ms.src=qa;ta.jog=new Promise(function(ra){ta.n6d=ra});ta.o6d=!1;return ta}function m(){this.correlationId=this.resolve=null}function n(qa){qa=void 0===qa?0:qa;this.$B=0;this.nlb=!1;this.Fm=new ca.a;this._timeout=qa}function w(){this.reject=this.resolve=null;this.startTime=
0;this.AKf=this.kue=null}function h(){this.Cke=null;var qa=M.AFrameworkApplication.ga.Va(M.AFrameworkApplication.Qea),wa=M.AFrameworkApplication.ga.Va(M.AFrameworkApplication.Ibg);this.hYa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",qa&&""!==qa?qa:"Unspecified",wa&&""!==wa?wa:"Unspecified")}function y(qa,wa,Ta,sb,db){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=qa;this.scope=wa;this.silentLogin=Ta;this.options=
sb;this.correlationId=db}function r(){}function x(qa){this.htg=qa}function t(){}b.r(E);z=b(0);var u=b(14),B=b(902),v=b(1125),C;(function(qa){qa[qa.external=0]="external";qa[qa.msa=1]="msa";qa[qa.aad=2]="aad"})(C||(C={}));Object(z.b)("AuthorityType",C);Object(z.a)(t,"OAuthResult",null,[]);x.prototype.initialize=function(){return Promise.resolve(0)};x.prototype.okc=function(){return Promise.resolve(0)};x.prototype.jT=function(){u.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");
return Promise.resolve(Object.assign(new t,{IsSuccess:!0,Token:this.htg}))};x.prototype.tBc=function(){return Promise.resolve(Object.assign(new t,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};x.prototype.Qzc=function(){return!1};x.prototype.Nwb=function(){return"MockAuthTokenStrategy"};Object(z.a)(x,"MockAuthTokenStrategy",null,[743]);var A=b(1151);r.get=function(qa,wa,Ta){if(!Ta)return qa;
var sb=0;return Promise.race([qa,new Promise(function(db){sb=window.setTimeout(function(){db(wa)},Ta)})]).then(function(db){window.clearTimeout(sb);return Promise.resolve(db)}).catch(function(){window.clearTimeout(sb);return Promise.resolve(wa)})};Object(z.a)(r,"PromiseWithTimeout",null,[]);var M=b(4),T=b(941);Object(z.a)(y,"TokenRequestParameters",null,[756]);var R=b(24),Q=b(85);h.prototype.initialize=function(){var qa=this;return new Promise(function(wa){Q.a.instance.lc("Common.App.WopiIdentity.IWopiIdentity").execute(function(Ta){qa.Cke=
Ta;wa(0)})})};h.prototype.Ai=function(qa){for(var wa=!1,Ta=qa.toLocaleUpperCase(),sb=Cl(["HTTPS:","API:"]),db=sb.next();!db.done;db=sb.next())if(Ta.startsWith(db.value)){wa=!0;break}return wa||this.Eji(qa)?qa+"/.default":qa};h.prototype.Eji=function(qa){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(qa)};h.prototype.okc=function(){return Promise.resolve(0)};h.prototype.jT=function(qa,wa,Ta,sb,db,kb,ac){if(R.a.nla){db=T.a.lXj;if(!db)return wa=Object.assign(new t,
{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(wa);if(!Array.contains(db,qa))return wa=Object.assign(new t,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+qa}),Promise.resolve(wa)}qa=this.Ai(Ta);Ta=new y(Ta,qa,!sb,null,M.AFrameworkApplication.userSessionId);return this.Cke.getAccessToken(Ta,wa,ac).then(function(ta){return Object.assign(new t,{IsSuccess:!0,Token:ta.accessToken})},function(ta){return Object.assign(new t,
{IsSuccess:!1,ErrorCode:ta})})};h.prototype.tBc=function(){return Promise.resolve(Object.assign(new t,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};h.prototype.Qzc=function(){return!1};h.prototype.Nwb=function(){return this.hYa};Object(z.a)(h,"ParentFrameTokenStrategy",null,[743]);var ea=b(82),Z=b(1057),ca=b(201);Object(z.a)(w,"PromiseWrapper",null,[]);n.prototype.enqueue=function(qa){var wa=
this;return new Promise(function(Ta,sb){wa.Fm.add(Object.assign(new w,{AKf:qa,resolve:Ta,reject:sb}));wa.process()})};n.prototype.process=function(){var qa=this;if(this.nlb||this.$B===this.Fm.count)return!1;var wa=this.Fm.oa(this.$B++);try{this.nlb=!0,wa.AKf().then(function(Ta){qa.nlb=!1;qa.C2c(wa,Ta,null,!0)}).catch(function(Ta){qa.nlb=!1;qa.C2c(wa,null,Ta,!1)})}catch(Ta){this.nlb=!1,this.C2c(wa,null,Ta,!1)}return!0};n.prototype.C2c=function(qa,wa,Ta,sb){var db=this;sb?0<this._timeout?window.setTimeout(function(){qa.resolve(wa);
db.process()},this._timeout):(qa.resolve(wa),db.process()):0<this._timeout?window.setTimeout(function(){qa.reject(Ta);db.process()},this._timeout):(qa.reject(Ta),db.process())};Object(z.a)(n,"PromiseQueue",null,[]);Object(z.a)(m,"ResolveWithCorrelation",null,[]);var I=b(83),H=b(149),L=b(1033),U=b(167),fa=H.a;Am(f,fa);f.prototype.eyc=function(){var qa={};qa=(qa.promptMessage=this.Oug,qa.errorText=CommonUIStrings.l_InternalError,qa.rtl=M.AFrameworkApplication.isRtl,qa.frameLoaded=!1,qa.createFrame=
Object(ea.a)(this,this.l7g,"createFrame"),qa.resolveDialogStyles=this.n6d,qa);var wa={};this.d2=(wa.id="SharedAuthConsentDialog",wa.bodyControls=qa,wa);this.jc=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(ea.a)(this,this.Wvj,"sharedAuthConsentDialogHandler"),this.d2)};f.prototype.reg=function(qa,wa){var Ta=!0;Ta=void 0===Ta?!1:Ta;qa=void 0===qa?!1:qa;wa=void 0===wa?5:wa;this.d2&&this.d2.bodyControls&&(Ta!==Object(I.a)(Object,this.d2.bodyControls).frameLoaded&&(Object(I.a)(Object,this.d2.bodyControls).frameLoaded=
Ta),qa!==Object(I.a)(Object,this.d2.bodyControls).frameLoadSuccess&&(Object(I.a)(Object,this.d2.bodyControls).frameLoadSuccess=qa),wa!==this.d2.dialogButtonsOption&&(this.d2.dialogButtonsOption=null,this.jc=wa),this.update(this.d2))};f.prototype.mCj=function(qa,wa){var Ta=new L.a(U.a.$vj),sb={};qa=(sb.signInLabel=CommonUIStrings.l_SignIn,sb.cancelLabel=CommonUIStrings.l_DialogCancel,sb.rtl=M.AFrameworkApplication.isRtl,sb.messageCorrelationId=qa,sb.dialogStyles=wa,sb);Ta.Values=qa;this.Zv.MRa(Ta,
this.Ms.contentWindow,this.PY)};f.prototype.VVe=function(){this.reg(!1,6)};f.prototype.PSi=function(){this.VVe()};f.prototype.l7g=function(){return this.Ms};f.prototype.Wvj=function(qa){0===qa&&(this.Iyg.reject(Object.assign(new t,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.hEa(null))};Ck.Object.defineProperties(f.prototype,{Q1f:{configurable:!0,enumerable:!0,get:function(){return this.Ms}},Ffh:{configurable:!0,enumerable:!0,get:function(){var qa=
this;return this.jog.then(function(wa){qa.o6d=!0;return wa})}},Gfh:{configurable:!0,enumerable:!0,get:function(){return this.o6d}}});Object(z.a)(f,"SharedAuthConsentDialog",H.a,[755]);var aa=b(1314),na=b(100),ha=b(134),ka=b(39),xa=b(177),va=b(356);e.prototype.Nwb=function(){return this.hYa};e.prototype.initialize=function(){var qa=b(1050).OAuthManager;if("loadFrame"in this.rra)return this.rra.loadFrame.kue;if(!this.PY)return na.Health.instance.recordKpiFailure(qa.kpiName,"SharedAuthFrameOriginNotSet",
!1,!1,null),u.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);qa=this.zzc("loadFrame");this.qTb=ka.a.Ae();var wa=this.PY+this.Dhe+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+M.AFrameworkApplication.userSessionId+"&WacUserType="+M.AFrameworkApplication.userType;this.YXb&&(wa+="&vnext=1");this.Ms=document.createElement("iframe");this.$ai(this.Ms);this.Ms.style.cssText="height:0;width:0;display:none;";
this.Ms.id="SharedAuthFrame";this.Ms.setAttribute("name","SharedAuthFrame");this.Ms.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Ms.setAttribute("title","SharedAuthFrame");this.Ms.src=wa;document.body.appendChild(this.Ms);wa=ka.a.Ae()-this.qTb;u.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",wa,this.Ms.src);return qa};e.prototype.okc=function(qa){this.UFc=qa;var wa=new L.a(U.a.T1f);
wa.Values=this.Mte(qa);qa=this.zzc("initFrame");this.Zv.MRa(wa,this.Ms.contentWindow,this.PY);u.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");return qa};e.prototype.jT=function(qa,wa,Ta,sb,db,kb){var ac=this,ta=new L.a(U.a.awj),ra=this.T2e();ta.Values=this.cbg(qa,wa,Ta,sb,db,kb,ra);qa=this.zzc(ra);sb&&M.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.frg.enqueue(function(){return new Promise(function(Na){ac.dOj(kb,
ta,Na,ra)})}):(this.Zv.MRa(ta,this.Ms.contentWindow,this.PY),u.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",wa));return qa};e.prototype.dOj=function(qa,wa,Ta,sb){var db=this.rra[sb];db&&(this.vYa=wa,this.hEa=Object.assign(new m,{resolve:Ta,correlationId:sb}),this.qM=new f(this.PY,this.Dhe,qa,this.Zv,db,Ta,this.YXb),this.qM.eyc())};e.prototype.T2e=function(){return xa.a.create().toString()};e.prototype.cbg=function(qa,wa,Ta,sb,db,kb,ac){var ta=
{};ta.appName=qa;ta.appId=wa;ta.target=Ta;ta.withPopup=sb;ta.claims=db;ta.promptMessage=kb;ta.messageCorrelationId=ac;return ta};e.prototype.$ai=function(qa){$addHandler(qa,"load",Object(ea.a)(this,this.PNi,"onIFrameLoaded"));$addHandler(qa,"error",Object(ea.a)(this,this.Nnc,"onIFrameError"));this.Zv.XFa(this.PY);this.Zv.mo(U.a.W1f);this.Zv.Tl(U.a.W1f,Object(ea.a)(this,this.iSi,"onScriptLoaded"));this.Zv.mo(U.a.V1f);this.Zv.Tl(U.a.V1f,Object(ea.a)(this,this.hSi,"onScriptInitialized"));this.Zv.mo(U.a.R1f);
this.Zv.Tl(U.a.R1f,Object(ea.a)(this,this.rNi,"onGetTokenResponse"));this.Zv.mo(U.a.X1f);this.Zv.Tl(U.a.X1f,Object(ea.a)(this,this.hPi,"onLoginResponse"));this.Zv.mo(U.a.U1f);this.Zv.Tl(U.a.U1f,Object(ea.a)(this,this.iOi,"onInteractiveFlowReady"));this.Zv.mo(U.a.S1f);this.Zv.Tl(U.a.S1f,Object(ea.a)(this,this.INi,"onHideDialog"));this.Zv.mo(U.a.P1f);this.Zv.Tl(U.a.P1f,Object(ea.a)(this,this.OIi,"onCloseDialog"))};e.prototype.zzc=function(qa){var wa=new w;wa.startTime=ka.a.Ae();var Ta=new Promise(function(sb,
db){wa.resolve=sb;wa.reject=db});wa.kue=Ta;this.rra[qa]=wa;return Ta};e.prototype.PNi=function(){var qa=ka.a.Ae()-this.qTb;u.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",qa)};e.prototype.Nnc=function(qa){var wa=b(1050).OAuthManager,Ta=ka.a.Ae()-this.qTb,sb=Object.assign(new va.a,{durationMs:Ta});na.Health.instance.recordKpiFailure(wa.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,sb);u.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",
Ta,this.Z6d?JSON.stringify(qa):"")};e.prototype.iSi=function(qa){var wa=b(1050).OAuthManager,Ta=this.rra.loadFrame,sb=ka.a.Ae()-Ta.startTime,db=qa.Values.AuthLibrary.toString();qa=qa.Values.Success.toString();u.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",qa,db,sb);db&&(this.hYa="SharedAuthTokenStrategy "+db);db=Boolean.parse(qa);db||(qa=ha.a.Yr(),void 0!==qa&&null!==qa&&(qa.set("AuthLibrary",this.Nwb()),sb=Object.assign(new va.a,
{durationMs:sb,extendedProperties:qa}),na.Health.instance.recordKpiFailure(wa.kpiName,"SharedAuthStrategyInitFailed",!1,!0,sb)));Ta.resolve(db?0:1)};e.prototype.hSi=function(qa){var wa=this;if(qa.Values.interactive&&this.vYa&&this.vYa.Values.messageCorrelationId){var Ta=this.vYa.Values.messageCorrelationId.toString();if(qa.Values.interactive&&this.qM){this.qM.Ffh.then(function(db){wa.Zv.MRa(wa.vYa,wa.qM.Q1f.contentWindow,wa.PY);wa.qM.mCj(Ta,db);wa.qM.reg(!0);wa.vYa=null});return}}qa=this.rra.initFrame;
var sb=ka.a.Ae()-qa.startTime;u.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",sb);qa.resolve(0)};e.prototype.rNi=function(qa){if(qa.Values.messageCorrelationId&&qa.Values.messageCorrelationId.toString()){var wa=qa.Values.messageCorrelationId.toString(),Ta=this.rra[wa];if(Ta){var sb=ka.a.Ae()-Ta.startTime;u.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",sb);qa.Values.isSuccess&&qa.Values.isSuccess?Ta.resolve(qa.Values.response):
Ta.reject(qa.Values.response);this.rbg(wa)}else u.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else u.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")};e.prototype.iOi=function(){if(this.qM.Gfh)this.qM.VVe();else if(this.UFc&&this.qM){var qa=new L.a(U.a.T1f);qa.Values=this.Mte(this.UFc,!0);this.Zv.MRa(qa,this.qM.Q1f.contentWindow,this.PY)}};e.prototype.INi=
function(){this.qM&&this.qM.Sxb()};e.prototype.OIi=function(qa){qa.Values.cancelled&&qa.Values.cancelled&&qa.Values.messageCorrelationId&&this.rbg(qa.Values.messageCorrelationId.toString());this.qM&&this.qM.hide()};e.prototype.Mte=function(qa,wa){wa=void 0===wa?!1:wa;var Ta={};Ta.appIds=this.XJh();Ta.upn=qa.loginHint;Ta.authority=qa.authority;Ta.authorityType=Object(B.a)(C,qa.authorityType);Ta.tenantId=qa.tenantId;Ta.correlationId=M.AFrameworkApplication.userSessionId;Ta.enableConsoleLogging=this.Z6d;
Ta.enablePopupFlash=this.Eog;Ta.skipUpnCheck=this.gxg;Ta.interactive=wa;return Ta};e.prototype.XJh=function(){var qa=[],wa=T.a.cXc,Ta;for(Ta in wa)Array.add(qa,wa[Ta]);return qa};e.prototype.tBc=function(qa,wa,Ta,sb,db,kb){var ac=new L.a(U.a.Zvj),ta=this.T2e();ac.Values=this.cbg(qa,wa,Ta,sb,db,kb,ta);this.Dje=ac;qa=this.zzc(ta);u.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",wa);this.Uzj();return qa};e.prototype.Qzc=function(){return!0};e.prototype.Uzj=
function(){var qa=this;this.xkb||(this.xkb=new Z.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.xkb.id=16,this.xkb.Yff=!1,this.xkb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,function(){u.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");qa.Zv.MRa(qa.Dje,qa.Ms.contentWindow,qa.PY)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),u.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))};
e.prototype.hPi=function(qa){if(qa.Values.messageCorrelationId&&qa.Values.messageCorrelationId.toString()){var wa=this.rra[qa.Values.messageCorrelationId.toString()];if(wa){var Ta=ka.a.Ae()-wa.startTime;u.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",Ta);qa.Values.isSuccess&&qa.Values.isSuccess?wa.resolve(qa.Values.response):wa.reject(qa.Values.response)}else u.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else u.ULS.sendTraceTag(555049439,
3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")};e.prototype.rbg=function(qa){this.hEa&&this.hEa.correlationId===qa&&(this.hEa.resolve(null),this.hEa=null)};Object(z.a)(e,"SharedAuthTokenStrategy",null,[743]);c.prototype.initialize=function(){return Promise.resolve(0)};c.prototype.okc=function(){return Promise.resolve(0)};c.prototype.jT=function(){return Promise.resolve(Object.assign(new t,{IsSuccess:!1,ErrorCode:v.a[this.fQc],ErrorMessage:"Unable to get a token. Reason: ["+
v.a[this.fQc]+"]"}))};c.prototype.tBc=function(){return Promise.resolve(Object.assign(new t,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};c.prototype.Qzc=function(){return!1};c.prototype.Nwb=function(){return this.hYa};Object(z.a)(c,"UnsupportedAuthTokenStrategy",null,[743]);var Aa=b(929);b.d(E,"OAuthManager",function(){return a});a.prototype.Teh=function(){var qa=T.a.OBi;qa&&0<qa.length?
(this.yT=1,this.xP=new x(qa)):M.AFrameworkApplication.ga.ra("IsO365ConsumerHost")||M.AFrameworkApplication.ga.ra("IsO365CommercialHost")?M.AFrameworkApplication.ga.ra("IsAnonymousUser")?(this.yT=2,this.xP=new c(this.yT)):(qa=A.a.getAuthContext().loginHint)&&qa.length?T.a.Wxb?(this.yT=1,this.xP=new h):(this.yT=1,this.xP=new e):(this.yT=3,this.xP=new c(this.yT)):(this.yT=4,this.xP=new c(this.yT))};a.prototype.ov=function(){return this.xP?this.xP.Nwb()||"Unknown":"None"};a.prototype.Seh=function(qa){var wa=
this;qa=void 0===qa?null:qa;u.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");var Ta=ka.a.Ae();return M.AFrameworkApplication.ga.wfd().then(function(sb){sb?(wa.Teh(),qa&&(wa.xP=qa),u.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",T.a.clientVersion,T.a.appVersion,T.a.Xhh,wa.ov(),Math.floor(ka.a.Ae()-Ta))):u.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",
Math.floor(ka.a.Ae()-Ta));return Promise.resolve(sb)},function(){u.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(ka.a.Ae()-Ta));return Promise.resolve(!1)})};a.prototype.t$h=function(){var qa=this;u.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.ov());var wa=ka.a.Ae();return r.get(this.xP.initialize(),2,T.a.LGd).then(function(Ta){if(0===Ta)u.ULS.sendTraceTag(42084353,3E3,
50,"Initialization succeeded for {0} in {1} ms.",qa.ov(),Math.floor(ka.a.Ae()-wa));else if(1===Ta){u.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",qa.ov(),Math.floor(ka.a.Ae()-wa));var sb=ha.a.Yr();void 0!==sb&&null!==sb&&(sb.set("AuthLibrary",qa.ov()),sb=Object.assign(new va.a,{durationMs:Math.floor(ka.a.Ae()-wa),extendedProperties:sb}),na.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitFailed",!1,!0,sb))}else 2===
Ta&&(u.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",qa.ov(),Math.floor(ka.a.Ae()-wa)),sb=ha.a.Yr(),void 0!==sb&&null!==sb&&(sb.set("AuthLibrary",qa.ov()),sb=Object.assign(new va.a,{durationMs:Math.floor(ka.a.Ae()-wa),extendedProperties:sb}),na.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitTimedOut",!1,!0,sb)));return Promise.resolve(Ta)},function(){u.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",
qa.ov(),Math.floor(ka.a.Ae()-wa));return Promise.resolve(1)})};a.prototype.yti=function(){var qa=this;u.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.ov());var wa=ka.a.Ae();return r.get(this.xP.okc(A.a.getAuthContext()),2,T.a.LGd).then(function(Ta){if(0===Ta)u.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",qa.ov(),Math.floor(ka.a.Ae()-wa));else if(1===Ta){u.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",
qa.ov(),Math.floor(ka.a.Ae()-wa));var sb=ha.a.Yr();void 0!==sb&&null!==sb&&(sb.set("AuthLibrary",qa.ov()),sb=Object.assign(new va.a,{durationMs:Math.floor(ka.a.Ae()-wa),extendedProperties:sb}),na.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadFailed",!1,!0,sb))}else 2===Ta&&(u.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",qa.ov(),Math.floor(ka.a.Ae()-wa)),sb=ha.a.Yr(),void 0!==sb&&null!==sb&&(sb.set("AuthLibrary",qa.ov()),
sb=Object.assign(new va.a,{durationMs:Math.floor(ka.a.Ae()-wa),extendedProperties:sb}),na.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadTimedOut",!1,!0,sb)));return Promise.resolve(Ta)},function(){u.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",qa.ov(),Math.floor(ka.a.Ae()-wa));return Promise.resolve(1)})};a.prototype.jT=function(qa,wa,Ta){return this.rBc(qa,wa,!1,null,"",void 0===Ta?null:Ta)};a.prototype.dbg=function(qa,
wa,Ta,sb,db){return this.rBc(qa,wa,!0,Ta,sb,void 0===db?null:db)};a.prototype.rBc=function(qa,wa,Ta,sb,db,kb,ac){ac=void 0===ac?0:ac;ac+=1;u.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",qa,this.wRa(qa,wa),this.ov(),ac);var ta=ha.a.Yr();void 0!==ta&&null!==ta&&(ta.set("AuthLibrary",this.ov()),ta.set("AppName",qa),ta.set("Target",this.wRa(qa,wa)),na.Health.instance.recordKpiUsage(a.kpiName,0,"WacOAuthFC",ta));if(!T.a.isEnabled){var ra;
return this.bvd((ra=new t,ra.IsSuccess=!1,ra.Token=null,ra.ErrorCode="NotEnabled",ra.ErrorMessage="OAuthManager is disabled.",ra),qa)}var Na=T.a.cXc[qa];if(void 0===Na||null===Na){u.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",qa);var gb;return this.bvd((gb=new t,gb.IsSuccess=!1,gb.Token=null,gb.ErrorCode="DisallowedApp",gb.ErrorMessage="Disallowed appName: "+qa,gb),qa)}var ob=ka.a.Ae(),wb=this;ta=this.Vqg.then(function(Wa){return wb.dfi(qa,
Na,wa,Ta,sb,db,kb,Wa)});ra=Ta?0:T.a.LGd;var Oa;gb=(Oa=new t,Oa.IsSuccess=!1,Oa.Token=null,Oa.ErrorCode="authTokenStrategy_timeout",Oa.ErrorMessage="Auth Strategy timed out after ["+ra+"] ms when fetching token",Oa);var sa=this,Fa=this;return r.get(ta,gb,ra).then(function(Wa){return ac<=a.qAi&&(Wa.ErrorCode===a.r$f||Wa.ErrorCode===a.NGj)?(u.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",ac,Math.floor(ka.a.Ae()-ob)),sa.rBc(qa,wa,Ta,sb,db,kb,ac)):Wa.ErrorCode===
a.sjf&&!Ta&&(u.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",ac,a.YLe),a.dlh&&sa.xP.Qzc()&&sa.xP.tBc(qa,Na,wa,Ta,sb,db).then(function(Db){return Promise.resolve(sa.Gkc(Db,qa,wa,Na,ob))}).catch(function(){var Db,pc=(Db=new t,Db.IsSuccess=!1,Db.Token=null,Db.ErrorCode="authTokenStrategy_failure",Db.ErrorMessage="LoginPopup failed, GetToken could not be called",Db);return Promise.resolve(sa.Gkc(pc,qa,wa,Na,ob))}),a.YLe)?sa.rBc(qa,
wa,!0,sb,db,kb,ac):Promise.resolve(sa.Gkc(Wa,qa,wa,Na,ob))}).catch(function(){var Wa,Db=(Wa=new t,Wa.IsSuccess=!1,Wa.Token=null,Wa.ErrorCode="authTokenStrategy_failure",Wa.ErrorMessage="Auth Strategy failed with an unknown error",Wa);return Promise.resolve(Fa.Gkc(Db,qa,wa,Na,ob))})};a.prototype.dfi=function(qa,wa,Ta,sb,db,kb,ac,ta){var ra=this;return 1===ta||2===ta?this.bvd(Object.assign(new t,{IsSuccess:!1,Token:null,ErrorCode:1===ta?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),
qa):this.xP.jT(qa,wa,Ta,sb,db,kb,ac).then(function(Na){return Promise.resolve(ra.Vsf(Na,!0,qa))}).catch(function(Na){return Promise.resolve(ra.Vsf(Na,!1,qa))})};a.prototype.Gkc=function(qa,wa,Ta,sb,db){var kb={};db=ka.a.Ae()-db;kb.IsSuccess=qa.IsSuccess;kb.ErrorCode=qa.IsSuccess?"Success":qa.ErrorCode||"";kb.ErrorMessage=qa.IsSuccess?"Success":this.wRa(wa,qa.ErrorMessage||"");kb.Target=this.wRa(wa,Ta||"");kb.TimeInMS=Math.floor(db);kb.AuthLibrary=this.ov();kb.AppName=wa;kb.AuthorityType=Object(B.a)(C,
A.a.Eac());kb.UserType=this.V0h(A.a.getAuthContext());kb.IsAuthSupportedInSession=v.a[this.yT];kb.RequestCount=++this.xvg;kb.AppId=sb;u.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(kb));qa.IsSuccess||(Ta=ha.a.Yr(),void 0!==Ta&&null!==Ta&&(Ta.set("AppName",wa),Ta.set("AuthLibrary",this.ov()),Ta.set("ErrorCode",qa.ErrorCode),Ta.set("ErrorMessage",this.wRa(wa,qa.ErrorMessage)),wa=Object.assign(new va.a,{durationMs:db,extendedProperties:Ta}),na.Health.instance.recordKpiFailure(a.kpiName,"TryGetTokenFailure",
!1,!0,wa)));return qa};a.prototype.bvd=function(qa,wa){u.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",wa,this.wRa(wa,qa.ErrorMessage));var Ta=ha.a.Yr();void 0!==Ta&&null!==Ta&&(Ta.set("AppName",wa),Ta.set("AuthLibrary",this.ov()),Ta.set("ErrorCode",qa.ErrorCode),Ta.set("ErrorMessage",this.wRa(wa,qa.ErrorMessage)),wa=Object.assign(new va.a,{extendedProperties:Ta}),na.Health.instance.recordKpiFailure(a.kpiName,"FailureBeforeGetToken",
!1,!0,wa));return Promise.resolve(qa)};a.prototype.Eef=function(qa){return qa===Aa.a.CAc};a.prototype.wRa=function(qa,wa){return this.Eef(qa)&&wa?"REDACTED":wa};a.prototype.V0h=function(qa){return M.AFrameworkApplication.ga.ra("IsAnonymousUser")?"anonymous":!qa.loginHint||1>qa.loginHint.length?"empty":-1<qa.loginHint.indexOf("guest#")?"guest":-1<qa.loginHint.indexOf("ext#")?"external":0>qa.upn.indexOf("@")?"no-at":"supported"};a.prototype.Twa=function(){return 1===this.yT};a.prototype.Vsf=function(qa,
wa,Ta){var sb=null,db=null,kb=null,ac=null;qa?qa.ErrorCode||qa.ErrorMessage?(db=qa.ErrorCode?qa.ErrorCode:a.lSe,kb=qa.ErrorMessage?qa.ErrorMessage:"No message"):qa.Token?wa?sb=qa.Token:(db=a.y$i,kb="A rejected promise returned a token."):(db=a.lSe,kb=JSON.stringify(qa)):(db=a.nEi,kb="No result came from Auth Token Strategy");qa&&qa.Telemetry&&!this.Eef(Ta)&&(ac=qa.Telemetry,u.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(ac)));if(db===a.$Bi||db===a.xLj)db=a.r$f,kb="Auth Library Timed Out";db===
a.rNg&&-1<kb.indexOf(a.yzg)&&(db=a.sjf);if(db||kb)sb=null;return Object.assign(new t,{IsSuccess:!!sb,Token:sb,ErrorCode:db,ErrorMessage:kb,Telemetry:ac})};Ck.Object.defineProperties(a,{YLe:{configurable:!0,enumerable:!0,get:function(){return M.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}},dlh:{configurable:!0,enumerable:!0,get:function(){return M.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",
!1)}}});a.xLj="token_renewal_error";a.lSe="Exception";a.nEi="NoResult";a.y$i="RejectToken";a.$Bi="monitor_window_timeout";a.r$f="Timeout";a.NGj="authTokenStrategy_timeout";a.rNg="login_required";a.yzg="AADSTS50058";a.sjf="Cookies Disabled";a.kpiName="OAuthManager";a.qAi=2;Object(z.a)(a,"OAuthManager",null,[585])},1125:function(z,E,b){b.d(E,"a",function(){return a});z=b(0);var a;(function(c){c[c.unknown=0]="unknown";c[c.supported=1]="supported";c[c.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";
c[c.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";c[c.hostUnsupported=4]="hostUnsupported"})(a||(a={}));Object(z.b)("SupportStatus",a)},1461:function(z,E,b){function a(ca){var I=Z.call(this)||this;I.$=ca;I.Tb();return I}function c(ca){this.oAuthManager=ca}function e(){}function f(ca){this.YUb=ca}function m(){}function n(){}b.r(E);z=b(0);var w=b(14),h=b(1050),y=b(1125),r=b(4),x=b(100),t=b(941),u=b(255),B=b(39),v=b(24),C=b(85),A=b(356);n.prototype.fi=function(ca){ca.register(585,"Common.App.OAuth.IOAuthManager").Ic().Oc(function(){return new h.OAuthManager})};
n.prototype.init=function(){var ca=C.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.OOj(ca)};n.prototype.OOj=function(ca){var I=r.AFrameworkApplication.ga.Va("FileSource");if(r.AFrameworkApplication.ga.ra("IsO365ConsumerHost")||r.AFrameworkApplication.ga.ra("IsO365CommercialHost")||"WopiTest"===I){var H=t.a.gGh,L=t.a.authority;if(void 0!==H&&null!==H&&H.length&&void 0!==L&&null!==L&&L.length){var U=y.a[ca.yT],fa=v.a.ZGa,aa=ca.ov();try{var na=new Map;void 0!==na&&null!==na?(na.set("SupportStatus",
U),na.set("Browser",fa),na.set("AuthStrategy",aa)):na=null}catch(ka){na=null}x.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",na);var ha=B.a.Ae();ca.jT("Core",H).then(function(ka){var xa=Math.floor(B.a.Ae()-ha);U=y.a[ca.yT];fa=v.a.ZGa;aa=ca.ov();w.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',xa,ka.IsSuccess,U,ka.ErrorCode,
I,fa,aa);na&&(na.set("SupportStatus",U),na.set("Browser",fa),na.set("AuthStrategy",aa));xa=Object.assign(new A.a,{durationMs:xa,extendedProperties:na});ka.IsSuccess?x.Health.instance.recordKpiSuccess("WacCorePFT",xa):x.Health.instance.recordKpiFailure("WacCorePFT",ka.ErrorCode,!1,!1,xa)})}}};n.prototype.dispose=function(){};n.main=function(){u.a.instance.hj(new n)};Ck.Object.defineProperties(n.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.OAuth.OAuthPackage"}}});
Object(z.a)(n,"OAuthPackage",null,[4,5]);var M=b(1151);Object(z.a)(m,"LokiTokenResult",null,[]);f.prototype.dgd=function(){var ca=this,I=this.wTh();return I?f.uqd?new Promise(function(H,L){ca.YUb.continueWith(function(){ca.YUb.Oh||ca.YUb.ig?L(Error.create("Error downloading auth library")):ca.YUb.result.jT("Loki",I).then(function(U){U=r.AFrameworkApplication.ga.ra("ForceLokiFallbackToACLPTokenIsEnabled")?ca.zTh():U.IsSuccess&&U.Token?Object.assign(new m,{isSuccess:!0,token:U.Token,errorMessage:null}):
Object.assign(new m,{isSuccess:!1,token:null,errorMessage:JSON.stringify(U)});H(U);return U})})}):Promise.resolve(Object.assign(new m,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new m,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",M.a.cYe())}))};f.prototype.zTh=function(){var ca=r.AFrameworkApplication.ga.Va("LokiUserDataSignature")||"";return Object.assign(new m,
{isSuccess:!0,token:ca,errorMessage:null})};f.prototype.wTh=function(){var ca=null,I=M.a.Eac();2===I?ca=r.AFrameworkApplication.ga.Va("LokiAADAppId"):1===I&&(ca=r.AFrameworkApplication.ga.Va("LokiMSAAppId"));return ca};Ck.Object.defineProperties(f,{uqd:{configurable:!0,enumerable:!0,get:function(){return r.AFrameworkApplication.ga.ra("IsO365CommercialHost")||r.AFrameworkApplication.ga.ra("IsO365ConsumerHost")}}});Object(z.a)(f,"LokiTokenManager",null,[599]);var T=b(566);e.prototype.init=function(){C.a.instance.resolve("Common.ILokiTokenManager")};
e.prototype.dispose=function(){};e.prototype.fi=function(ca){ca.register(f,"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").Ic().Oc(function(){return new f(T.a.dr(ca.lc("Common.App.OAuth.IOAuthManager")))})};e.main=function(){u.a.instance.hj(new e)};Ck.Object.defineProperties(e.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.LivePersonaUtils"}}});Object(z.a)(e,"LivePersonaUtilsPackage",null,[4,5]);var R=b(11);E=b(226);var Q=b(7),ea=b(1022);
c.prototype.jT=function(ca,I){return this.oAuthManager?this.oAuthManager.jT(ca,I).then(function(H){H.IsSuccess||w.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+H.ErrorMessage+" Error code: "+H.ErrorCode+" App name: "+ca);return Object(Q.a)(new ea.a,{IsSuccess:H.IsSuccess,Token:H.Token,ErrorCode:H.ErrorCode,ErrorMessage:H.ErrorMessage})}):(w.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object(Q.a)(new ea.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",
ErrorMessage:"Failed to resolve IOAuthManager from the container."})))};c.prototype.Twa=function(){return this.oAuthManager?this.oAuthManager.Twa():null};Object(z.a)(c,"OAuthManagerWrapper",null,[593]);var Z=E.a;Am(a,Z);a.prototype.create=function(){this.Eb(this.$.da.Aa(349)||new c(C.a.instance.resolve("Common.App.OAuth.IOAuthManager")))};a.ka=function(ca){ca.da.Ga(350,new a(ca))};Object(z.a)(a,"OAuthManagerFactory",E.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");
Type.registerNamespace("Common.App.OAuth");n.main();Type.registerNamespace("Common.App.LivePersonaUtils");e.main();(function(){R.a.Fa(function(ca){a.ka(ca)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.oauth.js.map/0938f242808bcbe60cbe612bee95e98a/EwaDS.oauth.js.map